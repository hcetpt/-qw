======================
spi_butterfly - 并口至Butterfly适配器驱动
======================

这是一个硬件和软件项目，包括构建并使用一个并行端口适配器线缆，结合一个“AVR Butterfly”来运行用户界面或传感器相关的固件。Butterfly是一张价值20美元的电池供电卡片，内置AVR微控制器以及众多组件：传感器、LCD显示屏、切换杆等。你可以使用AVR-GCC来为它开发固件，并通过这个适配器线缆将其烧录进去。
你可以从旧打印机线缆中制作这个适配器，并直接将部件焊接到Butterfly上。或者（如果你有相应的零件和技能），你可以设计更复杂的版本，为Butterfly和并行端口提供电路保护，或者提供比仅靠并行端口的两个信号引脚更好的电源供应。实际上，你也可以用类似的线缆与许多AVR板卡进行通信，甚至是一个面包板。
这比“ISP编程”线缆更强大，因为它允许内核中的SPI协议驱动程序与AVR交互，甚至可以让AVR向它们发出中断。之后，你的协议驱动应该能轻松地与“真正的SPI控制器”一起工作，而不仅仅是这个位操作（bitbanging）设备。
最初的线缆连接将把Linux连接到一个SPI总线上，该总线连接了AVR和DataFlash芯片；并且还连接到了AVR的复位线。这些就是你刷新固件所需要的全部内容，这些引脚是标准Atmel“ISP”连接器引脚（在非Butterfly的AVR板卡上也使用）。在并口这一侧，这类似于“sp12”编程线缆。
======	  =============	  ===================
	信号	  Butterfly	  并口 (DB-25)
	======	  =============	  ===================
	SCK	  J403.PB1/SCK	  第2针/D0
	RESET	  J403.nRST	  第3针/D1
	VCC	  J403.VCC_EXT	  第8针/D6
	MOSI	  J403.PB2/MOSI	  第9针/D7
	MISO	  J403.PB3/MISO	  第11针/S7,nBUSY
	GND	  J403.GND	  第23针/GND
	======	  =============	  ===================

然后要让Linux成为该总线的主控方并与DataFlash芯片通信，你需要：
(a) 刷新新的固件，其中禁用了SPI（设置PRR.2，并通过清除PORTB.[0-3]来禁用上拉电阻）；
(b) 配置mtd_dataflash驱动程序；
(c) 连接片选信号。
======	  ============	  ===================
	信号	  Butterfly	  并口 (DB-25)
	======	  ============	  ===================
	VCC	  J400.VCC_EXT	  第7针/D5
	SELECT	  J400.PB0/nSS	  第17针/C3,nSELECT
	GND	  J400.GND	  第24针/GND
	======	  ============	  ===================

或者你可以刷新使AVR成为SPI从机的固件（保持DataFlash处于复位状态），并对spi_butterfly驱动程序进行调整，使其与你自定义的SPI协议驱动程序绑定。
“USI”控制器（使用J405）也可以用于第二个SPI总线。
这将让你能够使用自定义的SPI-with-USI固件与AVR通信，同时让Linux或AVR使用DataFlash。有许多空闲的并行端口引脚可用于连接，例如：

	======	  =============	  ===================
	信号	  Butterfly	  并口 (DB-25)
	======	  =============	  ===================
	SCK	  J403.PE4/USCK	  第5针/D3
	MOSI	  J403.PE5/DI	  第6针/D4
	MISO	  J403.PE6/DO	  第12针/S5,nPAPEROUT
	GND	  J403.GND	  第22针/GND

	IRQ	  J402.PF4	  第10针/S6,ACK
	GND	  J402.GND(P2)	  第25针/GND
	======	  =============	  ===================
