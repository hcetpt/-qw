### 介绍
这是为3dfx的Voodoo Graphics（又名voodoo 1，又名sst1）和Voodoo²（又名Voodoo 2，又名CVG）视频板设计的帧缓冲设备驱动程序。这是一个高度实验性的代码，但在我自己的电脑上，使用我的“Maxi Gamer 3D”和“Maxi Gamer 3D²”板卡时可以正常工作，并且我自己在“椅子和键盘之间”也测试过。有些人测试了其他组合，似乎也能工作。
主页位于<http://sstfb.sourceforge.net>，如果你想获取最新版本，请查看CVS，因为这个驱动程序仍在开发中，我不愿意发布尚未完全完成的tarball包……不用担心，它仍然非常可用（我自己也在用）。

请阅读“错误”部分，并将任何成功或失败的情况报告给我（Ghozlane Toumi <gtoumi@laposte.net>）。
顺便说一句，如果你只有一个显示器，并且不想摆弄VGA直通线，我只能建议你暂时借用一个屏幕。
### 安装
这个驱动程序（应该）可以在ix86上运行，支持较新的2.2.x内核（已测试x=19）和较新的2.4.x内核，可以作为模块使用或者编译到内核中。
从臭名昭著的2.4.10开始，它已经被包含在主流内核中。
你可以应用`sstfb/kernel/*-2.{2|4}.x.patch`中的补丁，并将sstfb.c复制到linux/drivers/video/目录下，或者应用单个补丁`sstfb/patch-2.{2|4}.x-sstfb-yymmdd`到你的Linux源码树中。
然后按照常规方式配置你的内核：选择“m”或“y”来启用3Dfx Voodoo Graphics控制台部分。编译、安装、享受乐趣……并请向我报告情况：）

### 模块使用
#### 注意：
1. 在发出任何命令之前，请完整阅读本节内容。
2. 如果你只有一个显示器可供使用，一旦你加载了模块，3dfx就会接管输出，因此你需要将显示器连接到“普通”视频板上来发出命令，或者你可以盲目地使用工具目录中的sst_dbg_vgapass（参见工具）。另一种解决方案是在加载驱动程序时传递参数vgapass=1（参见内核/模块选项）。

### 模块插入
```
insmod sstfb.o
```
你应该会看到一些奇怪的输出，比如一个大蓝色方块、一个小绿色方块、一个小红色方块以及一条垂直的白色条纹。为什么？函数名自解释：“sstfb_test()”……（如果你没有第二个显示器，你必须直接将显示器连接到2D视频卡才能看到你在输入什么）

```
con2fb /dev/fbx /dev/ttyx
```
将一个tty绑定到新的帧缓冲区。如果你已经有另一个帧缓冲区驱动程序，那么Voodoo帧缓冲区很可能是/dev/fb1。如果没有，则设备将是/dev/fb0。你可以通过执行cat /proc/fb来检查这一点。你可以在tools/目录中找到con2fb的一个副本。
如果你没有其他帧缓冲设备，这一步是多余的，因为控制子系统会自动将ttys绑定到fb。
#. 切换到你刚刚映射的虚拟控制台。“变戏法”...
模块移除
--------------

#. `con2fb /dev/fbx /dev/ttyx`

   将 tty 绑定到旧的帧缓冲区，以便可以移除模块
   （与 vgacon 怎么工作？简短回答：不工作）

#. `rmmod sstfb`


内核/模块选项
----------------------

您可以向 sstfb 模块传递一些选项，并且当驱动程序编译到内核中时，可以通过内核命令行传递：
对于模块：`insmod sstfb.o option1=value1 option2=value2 ..`
在内核中：`video=sstfb:option1,option2:value2,option3 ..`
sstfb 支持以下选项：

=============== =============== ===============================================
模块选项          内核选项           描述
=============== =============== ===============================================
vgapass=0         vganopass      启用或禁用 VGA 通过线缆
vgapass=1         vgapass        当启用时，显示器将从 VGA 板而不是 Voodoo 获得信号
默认值：nopass

mem=x             mem:x          强制设置帧缓冲区内存为 MiB
允许的值：0, 1, 2, 4
默认值：0（自动检测）

inverse=1         inverse        应该启用反显控制台
尚未实现
clipping=1        clipping       启用或禁用裁剪
=============== =============== ===============================================
clipping=0 noclipping  
启用裁剪时，所有离屏读写操作将被丢弃  
默认：启用裁剪

gfxclk=x gfxclk:x  
强制图形时钟频率（以 MHz 为单位）  
注意这个选项，它可能是危险的  
默认：自动

- 对 Voodoo 1，50MHz，
- 对 Voodoo 2，75MHz
slowpci=1 fastpci  
启用或禁用快速 PCI 读写  
slowpci=1 slowpci  
默认：fastpci

dev=x dev:x  
将驱动程序绑定到设备编号 x  
0 是第一个兼容的板卡（按 lspci 顺序）

=============== =============== ===============================================

工具
=====

这些工具主要用于调试目的，但你可能会觉得其中一些很有趣：

- `con2fb`，将一个 tty 映射到帧缓冲区（framebuffer）：
  
  con2fb /dev/fb1 /dev/tty5

- `sst_dbg_vgapass`，更改 VGA 通过设置。你需要重新编译驱动程序，并将 SST_DEBUG 和 SST_DEBUG_IOCTL 设置为 1：
  
  sst_dbg_vgapass /dev/fb1 1 （启用 VGA 电缆）
  sst_dbg_vgapass /dev/fb1 0 （禁用 VGA 电缆）

- `glide_reset`，使用 Glide 重置 Voodoo
  在卸载 sstfb 模块后，如果模块拒绝重新插入，请使用此命令

问题
====

- 不要在 sstfb 模块加载时使用 Glide，否则你的计算机可能会挂起
- 如果你看到一些异常（如像素不清等），尝试关闭裁剪（clipping=0），并/或使用 slowpci
- 驱动程序不检测 4MB 帧缓冲区的 Voodoo，看起来最后 2MB 会环绕。正在调查中
- 该驱动程序仅支持16位色彩，24位或32位不起作用。
- 该驱动程序不是your_favorite_toy安全的。这包括SMP。【实际上，经过检查似乎是安全的 —— Alan】

- 当使用XFree86 FBdev（基于fbdev的X）时，您可能会在窗口边缘看到奇怪的颜色模式（像素丢失了最低字节 -> 基本上是蓝色分量和部分绿色）。我无法在XFree86-3.3中复现这个问题，但一位测试者在XFree86-4中遇到了这个问题。显然最近的Xfree86-4.x版本解决了这个问题。
- 我没有真正测试过调色板的更改，因此在操作调色板时可能会遇到一些奇怪的现象。
- 有时驱动程序不会识别DAC，导致初始化失败。这特别适用于Voodoo 2显卡，但在最新版本中应该已经解决了。请与我联系。
- 考虑到硬件在24位或32位色彩下会做...一些不寻常的事情，24位或32位近期不太可能起作用。

待办事项
====
- 删除前面的一段话
- 买更多的咖啡
- 测试/移植到其他架构
- 尝试通过前后缓冲区微调来添加平移功能
尝试在 Voodoo2 上实现加速，这块显卡即使被宣传为仅支持 3D，但实际上在 2D 方面也能做很多事情。
Ghozlane Toumi <gtoumi@laposte.net>

日期：2002年5月9日 20:11:45

http://sstfb.sourceforge.net/README
