使用交换文件与软件挂起 (swsusp)
===============================================

	(C) 2006 拉斐尔·J·维索基 <rjw@sisk.pl>

Linux 内核处理交换文件的方式几乎与处理交换分区的方式相同，这两种类型的交换区域之间只有两个主要区别：
(1) 交换文件不必连续，
(2) 交换文件的头部不在持有它的分区的第一个块中。从 swsusp 的角度来看，(1) 不是一个问题，因为这已经被交换处理代码解决，但 (2) 必须被考虑进去。
原则上，可以通过适当的文件系统驱动程序确定交换文件头部的位置。不幸的是，这需要持有交换文件的文件系统被挂载，并且如果该文件系统是日志式的，则在从磁盘恢复时无法被挂载。因此，为了识别交换文件，swsusp 使用持有该文件的分区名称和交换文件头部相对于该分区开始处的偏移量。出于方便考虑，此偏移量以 `<PAGE_SIZE>` 单位表示。

为了使用交换文件与 swsusp 配合工作，您需要：

1) 创建交换文件并使其处于活动状态，例如：::

    # dd if=/dev/zero of=<swap_file_path> bs=1024 count=<swap_file_size_in_k>
    # mkswap <swap_file_path>
    # swapon <swap_file_path>

2) 使用一个应用程序通过 FIBMAP ioctl 映射交换文件并确定文件的交换头部位置，即从持有交换文件的分区开始处的偏移量（以 `<PAGE_SIZE>` 单位）。
3) 向内核命令行添加以下参数：::

    resume=<swap_file_partition> resume_offset=<swap_file_offset>

其中 `<swap_file_partition>` 是持有交换文件的分区，而 `<swap_file_offset>` 是由第2步中的应用程序确定的交换头部偏移量（当然，这个步骤可以由同一应用程序自动执行，该应用程序使用 FIBMAP ioctl 确定交换文件头部偏移量）

或者

使用用户空间挂起应用程序，通过在 Documentation/power/userland-swsusp.rst 中描述的 SNAPSHOT_SET_SWAP_AREA ioctl 设置分区和偏移量（这是唯一允许从 initrd 或 initramfs 映像启动恢复的交换文件挂起方法）
现在，swsusp 将以与使用交换分区相同的方式使用交换文件。特别是，交换文件必须处于活动状态（即出现在 /proc/swaps 中），以便能够用于挂起操作。
请注意，如果用于挂起的交换文件被删除并重新创建，则其头部的位置可能与之前不同。因此，每当发生这种情况时，都必须更新内核命令行参数 “resume_offset=” 的值。
