... include:: <isonum.txt>

============
SM501 驱动程序
============

:版权所有: |copy| 2006, 2007 Simtec Electronics

Silicon Motion SM501 多媒体辅助芯片是一种多功能设备，可能提供包括 USB 主控制器、USB 设备（gadget）、异步串行端口、音频功能以及双显示视频接口在内的多种接口。该设备可以通过 PCI 或本地总线连接，并启用不同的功能。
核心
----

位于 `drivers/mfd` 中的核心驱动程序为管理特定硬件块的驱动程序提供了通用服务。这些服务包括对共享寄存器的锁定、时钟控制和资源管理。
核心通过平台设备和驱动程序系统为 PCI 和通用总线芯片注册驱动程序。
在检测到设备后，核心初始化芯片（这可以通过平台数据指定），然后将选定的外设集导出为平台设备供特定驱动程序使用。
核心重用了平台设备系统，因为平台设备系统提供的特性足以支持这些驱动程序，无需创建新的总线类型及其相关代码。
资源
---------

每个外设都有一个设备视图，这个视图隐含地缩小到了该外设为了正确运行所需的特定资源集合。
集中化的内存分配允许驱动程序确保尽可能多的资源分配给视频子系统，因为这是芯片上资源最敏感的功能。
内存分配的主要问题是，在选择了显示模式后移动视频缓冲区。实际上，当发生视频模式改变时，视频子系统的内存占用量会发生变化。
由于除非同时为旧模式和新模式提供足够的连续内存，否则很难在不改变显示的情况下移动视频内存，因此视频驱动程序充分利用分配给它的内存区域，通过将 fb0 对齐到区域的开始位置，将 fb1 对齐到区域的结束位置来实现这一点。中间剩余的任何内存则用于加速功能，这些功能是临时性的，因此其位置不太关键，可以移动。
配置
-------------

平台设备驱动程序使用一组平台数据来向核心及子驱动程序传递配置信息，以便能够在单一的内核镜像中支持多个带有内置 SM501 的系统。
PCI 驱动程序假设 PCI 卡按照 Silicon Motion 参考设计工作。
存在一个关于 M1XCLK 和 M1CLK 频率选择的影响性问题（AB-5）。这两个时钟必须来自同一个锁相环（PLL），尽管之后可以分别进行分频。如果这一设置没有正确配置，则 SM501 可能会锁定并导致整个系统挂起。如果 PLL 选择不同，驱动程序将拒绝加载。
