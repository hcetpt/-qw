==========================================================================
RapidIO 子系统通道化消息字符设备驱动程序 (rio_cm.c)
==========================================================================


1. 概述
===========

此设备驱动程序是RapidIO.org软件任务组（STG）成员之间合作的成果，参与者包括德州仪器、Prodrive Technologies、诺基亚网络、BAE和IDT。此外还收到了来自RapidIO.org其他成员的意见。
目标是创建一个字符模式驱动程序接口，该接口能够直接向应用程序暴露RapidIO终端设备（mports）的消息传递能力，同时允许各种不同的RapidIO实现进行互操作。
此驱动程序（RIO_CM）为用户空间的应用程序提供了对RapidIO邮箱消息资源的共享访问。
根据RapidIO规范（第2部分），终端设备最多可以拥有四个消息邮箱（在多包消息的情况下，最大可达4KB），如果使用单包消息（最大可达256字节），则最多可以有64个邮箱。除了协议定义上的限制外，特定的硬件实现可能会减少消息邮箱的数量。因此，支持RapidIO的应用程序必须共享RapidIO终端的消息资源。
此设备驱动程序的主要目的是通过引入类似套接字的操作来利用单一消息邮箱为大量用户空间进程提供RapidIO邮箱消息功能。这使得应用程序能够高效地使用有限的RapidIO消息硬件资源。
大部分设备驱动程序的操作都是通过'ioctl'系统调用来支持的。
加载此设备驱动程序后，会在/dev目录中为所有注册的RapidIO mport设备创建一个名为rio_cm的文件系统节点。
以下ioctl命令可供用户空间应用程序使用：

- RIO_CM_MPORT_GET_LIST:
    向调用者返回支持消息操作的本地mport设备列表（条目数量最多为RIO_MAX_MPORTS）
每个列表条目包含了mport在系统中的索引和分配给端口的RapidIO目标ID的组合
- RIO_CM_EP_GET_LIST_SIZE:
    返回与指定mport设备关联的RapidIO网络中能够进行消息传递的远程终端数量
- RIO_CM_EP_GET_LIST:
    返回与指定的mport设备相关的RapidIO网络中可用于消息传递的远程端点（对等体）的RapidIO目标ID列表。
- RIO_CM_CHAN_CREATE:
    创建带有自动分配或根据调用者请求指定的通道ID的RapidIO消息交换通道数据结构。
- RIO_CM_CHAN_BIND:
    将指定的通道数据结构绑定到指定的mport设备上。
- RIO_CM_CHAN_LISTEN:
    在指定的通道上启用监听连接请求的功能。
- RIO_CM_CHAN_ACCEPT:
    接受来自对等体在指定通道上的连接请求。如果为该请求指定了等待超时时间，则这是一个阻塞调用。如果将超时设置为0，则是非阻塞调用——ioctl处理器检查是否有待处理的连接请求，如果没有可用的请求，则立即以-EGAIN错误状态退出。
- RIO_CM_CHAN_CONNECT:
    向远程对等体/通道发送连接请求。
- RIO_CM_CHAN_SEND:
    通过指定的通道发送数据消息。此请求的处理器假定由调用者指定的消息缓冲区包含了此驱动程序所需的包头保留空间。
- RIO_CM_CHAN_RECEIVE:
    通过已连接的通道接收数据消息。如果通道没有准备好返回的传入消息，此ioctl处理器将等待新消息直到由调用者指定的超时时间到期。如果超时值设置为0，则ioctl处理器使用由MAX_SCHEDULE_TIMEOUT定义的默认值。
RIO_CM_CHAN_CLOSE:
    关闭指定的通道并释放关联的缓冲区
如果指定的通道处于已连接状态，则向远程对等体发送关闭通知
用户空间应用程序使用的ioctl命令代码及其对应的数据结构定义在 'include/uapi/linux/rio_cm_cdev.h' 中
2. 硬件兼容性
=========================

此设备驱动程序使用内核RapidIO子系统定义的标准接口，因此它可以与任何由RapidIO子系统注册的mport设备驱动程序一起使用，但受限于可用的mport硬件实现中的消息邮箱功能。
3. 模块参数
====================

- 'dbg_level'
      - 此参数允许控制由该设备驱动程序生成的调试信息量。此参数由一组位掩码组成，这些掩码对应特定的功能模块
对于掩码定义，请参见 'drivers/rapidio/devices/rio_cm.c'
        此参数可以动态更改
启用顶层调试输出需要设置 CONFIG_RAPIDIO_DEBUG=y
- 'cmbox'
      - 要使用的RapidIO邮箱编号（默认值为1）
此参数允许设置将在整个RapidIO网络中使用的消息邮箱编号。当默认邮箱被其他设备驱动程序使用或不被RapidIO网络中的某些节点支持时可以使用此参数
- 'chstart'
      - 动态分配的起始通道号。默认值 - 256
允许排除低于此参数的通道号以避免在动态分配时与使用预定义保留通道号的软件组件发生冲突。

4. 已知问题
===========
无

5. 用户空间应用程序和API库
==========================
消息传递API库及使用该设备驱动的应用程序可从RapidIO.org获取。

6. 待办事项列表
================
- 增加对系统通知消息的支持（保留通道0）
