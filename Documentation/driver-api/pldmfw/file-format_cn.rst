SPDX 许可证标识符: 仅 GPL-2.0

==================================
PLDM 固件文件格式概览
==================================

一个 PLDM 固件包是一个二进制文件，其中包含描述固件包内容的头部。这包括初始包头、一个或多个固件记录以及一个或多个描述实际要编程的闪存内容的组件。
以下图示提供了文件格式的概览：

        整体文件布局
      +----------------------+
      |                      |
      |  包头                |
      |                      |
      +----------------------+
      |                      |
      |  设备记录            |
      |                      |
      +----------------------+
      |                      |
      |  组件信息            |
      |                      |
      +----------------------+
      |                      |
      |  包头 CRC            |
      |                      |
      +----------------------+
      |                      |
      |  组件图像 1          |
      |                      |
      +----------------------+
      |                      |
      |  组件图像 2          |
      |                      |
      +----------------------+
      |                      |
      |         ...          |
      |                      |
      +----------------------+
      |                      |
      |  组件图像 N          |
      |                      |
      +----------------------+

包头
==============

包头以 PLDM 文件格式的 UUID 开始，并包含有关文件使用的格式版本的信息。它还包括总头部大小、发布日期、组件位图的长度和整个包的版本信息。
以下图示提供了包头的概览：

             头部布局
      +-------------------------+
      | PLDM UUID               |
      +-------------------------+
      | 格式修订版              |
      +-------------------------+
      | 头部大小                |
      +-------------------------+
      | 发布日期                |
      +-------------------------+
      | 组件位图长度            |
      +-------------------------+
      | 包版本信息              |
      +-------------------------+

设备记录
==============

设备固件记录区域以一个计数开始，该计数表示文件中的记录总数，随后是每个记录。单个设备记录描述与该记录匹配的设备。所有有效的 PLDM 固件文件必须至少包含一个记录，但如果支持多个设备，则可选地包含多个记录。
每个记录将通过描述设备的 TLV（例如 PCI 设备和供应商信息）来标识其支持的设备。它还将指示此设备使用的一组组件。有可能提供的组件中只有一部分会被给定的记录使用。记录还可以可选地包含在更新过程中由设备固件使用的设备特定包数据。
以下图示提供了设备记录区域的概览：

         区域布局
      +---------------+
      |               |
      |  记录计数     |
      |               |
      +---------------+
      |               |
      |  记录 1       |
      |               |
      +---------------+
      |               |
      |  记录 2       |
      |               |
      +---------------+
      |               |
      |      ...      |
      |               |
      +---------------+
      |               |
      |  记录 N       |
      |               |
      +---------------+

           记录布局
      +-----------------------+
      | 记录长度              |
      +-----------------------+
      | 描述符计数            |
      +-----------------------+
      | 选项标志              |
      +-----------------------+
      | 版本设置              |
      +-----------------------+
      | 包数据长度            |
      +-----------------------+
      | 适用组件              |
      +-----------------------+
      | 版本字符串            |
      +-----------------------+
      | 描述符 TLV            |
      +-----------------------+
      | 包数据                |
      +-----------------------+

组件信息
==============

组件信息区域以组件数量的计数开始。在该计数之后是每个组件的描述。组件信息指向文件中存储组件数据的位置，并包括用于识别组件版本的版本数据。
以下图示提供了组件区域的概览：

         区域布局
      +-----------------+
      |                 |
      | 组件计数        |
      |                 |
      +-----------------+
      |                 |
      | 组件 1          |
      |                 |
      +-----------------+
      |                 |
      | 组件 2          |
      |                 |
      +-----------------+
      |                 |
      |     ...         |
      |                 |
      +-----------------+
      |                 |
      | 组件 N          |
      |                 |
      +-----------------+

           组件布局
      +------------------------+
      | 分类                   |
      +------------------------+
      | 组件标识符             |
      +------------------------+
      | 比较戳记               |
      +------------------------+
      | 组件选项               |
      +------------------------+
      | 激活方法               |
      +------------------------+
      | 位置偏移量             |
      +------------------------+
      | 组件大小               |
      +------------------------+
      | 组件版本信息           |
      +------------------------+
      | 包数据                 |
      +------------------------+

包头 CRC
==================

组件信息之后是一个简短的 4 字节 CRC，计算的是所有头部信息的内容。

组件图像
================

组件图像跟随 PLDM 固件文件中的包头信息。这些图像仅仅是二进制块，其起始位置和大小由组件信息区域中相应的组件结构定义。
