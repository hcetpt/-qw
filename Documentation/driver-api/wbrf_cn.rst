... SPDX-License-Identifier: GPL-2.0-or-later

=================================
WBRF - Wi-Fi 频段射频干扰缓解
=================================

由于某些平台设计中的电气和机械限制，GPU 内存时钟的相对高功率谐波可能会对特定 Wi-Fi 频段使用的本地无线电模块频率带产生可能的干扰。
为了缓解可能的射频干扰（RFI），生产者可以宣传正在使用的频率，消费者可以利用这些信息避免在敏感功能中使用这些频率。
当已知平台及其内部设备存在此类问题时，平台设计者将通过具有特定设备方法 (_DSM) 的 ACPI 设备来宣传此功能的存在。
* 具有该 _DSM 的生产者能够宣传其正在使用的频率
* 具有该 _DSM 的消费者能够注册接收正在使用的频率的通知
一些通用术语
==================

生产者：能产生高功率射频的组件
消费者：能根据其他组件的射频调整自身使用频率以缓解可能的射频干扰的组件
为了使机制正常工作，生产者应通知其正在积极使用的特定频率，以便其他消费者可以根据需要进行相应的内部调整以避免共振。
ACPI 接口
==============

尽管最初是为 Wi-Fi 和独立显卡 (dGPU) 使用案例而设计，但 ACPI 接口可以扩展到任何平台设计者发现可能引起干扰的设备类型。
用于 _DSM 的 GUID 为 7B7656CF-DC3D-4C1C-83E9-66E721DE3070。
此 _DSM 中提供三种功能：

* 0: 发现可用功能的数量
* 1: 记录正在使用的射频频段
* 2: 检索正在使用的射频频段

驱动程序编程接口
============================

.. kernel-doc:: drivers/platform/x86/amd/wbrf.c

示例用法
=============

生产者的预期流程：
1. 在探测过程中，调用 `acpi_amd_wbrf_supported_producer` 来检查是否可以为设备启用 WBRF
### 关于使用某些频段的说明：

2. 当使用某个频段时，调用 `acpi_amd_wbrf_add_remove` 函数，并将参数设置为 'add'，以确保其他消费者能够正确接收到通知。

3. 当停止使用某个频段时，调用 `acpi_amd_wbrf_add_remove` 函数，并将参数设置为 'remove'，以确保其他消费者能够接收到通知。

### 消费者的预期流程如下：

1. 在初始化（probe）阶段，调用 `acpi_amd_wbrf_supported_consumer` 函数来检查该设备是否支持启用 WBRF。

2. 调用 `amd_wbrf_register_notifier` 函数注册接收来自其他生产者关于频段变化（添加或移除）的通知。

3. 初始调用 `amd_wbrf_retrieve_freq_band` 函数来获取当前活动的频段，考虑到一些生产者可能在消费者启动之前就广播了此类信息。

4. 接收到频段变化的通知后，再次运行 `amd_wbrf_retrieve_freq_band` 函数来获取最新的活动频段。

5. 在驱动程序清理阶段，调用 `amd_wbrf_unregister_notifier` 函数取消注册通知。
