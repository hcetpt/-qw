... SPDX 许可证标识符: GPL-2.0

===============================================
Ingenic JZ47xx 系统芯片中的定时器/计数器单元硬件
===============================================

Ingenic JZ47xx 系统芯片中的定时器/计数器单元（TCU）是一个多功能硬件模块。它具有最多八个通道，可以作为计数器、定时器或脉宽调制（PWM）使用。
- JZ4725B、JZ4750 和 JZ4755 只有六个 TCU 通道。其他系统芯片都有八个通道。
- JZ4725B 引入了一个独立的通道，称为操作系统定时器（OST）。这是一个 32 位可编程定时器。在 JZ4760B 及以后的型号中，它是 64 位的。
- TCU 的每个通道都有自己的时钟，可以通过其 TCSR 寄存器重新配置到三个不同的时钟源（pclk、ext、rtc）、关闭或重新启动。
- 看门狗和 OST 硬件块在其寄存器空间中也具有相同格式的 TCSR 寄存器。
- 用于控制看门狗和 OST 时钟开启/关闭的 TCU 寄存器同样可以控制这些时钟的开启与关闭。
- 每个 TCU 通道的工作模式有两种：

    - TCU1 模式：通道不能在睡眠模式下工作，但操作起来更简单。
- TCU2 模式：通道可以在睡眠模式下工作，但操作比 TCU1 通道稍微复杂一些。
- 每个 TCU 通道的模式取决于所使用的系统芯片：

    - 在最旧的系统芯片上（直到 JZ4740），所有八个通道都在 TCU1 模式下运行。
- 在 JZ4725B 中，第 5 通道以 TCU2 模式运行，而其他通道则以 TCU1 模式运行。
在最新的片上系统（SoC）(JZ4750 及以上版本)中，通道 1-2 作为 TCU2 运行，其余的作为 TCU1 运行。

- 每个通道都可以产生中断。有些通道共享一个中断线，有些则不共享，并且这种情况会随着 SoC 版本的不同而变化：

    - 在较旧的 SoC 中（JZ4740 及以下版本），通道 0 和通道 1 拥有各自的中断线；通道 2-7 共享最后一个中断线。
- 在 JZ4725B 上，通道 0 拥有自己的中断线；通道 1-5 共享一条中断线；OST 使用最后一条中断线。
- 在较新的 SoC 中（JZ4750 及以上版本），通道 5 拥有自己的中断线；通道 0-4 以及（如果有八个通道的话）通道 6-7 都共享一条中断线；OST 使用最后一条中断线。

实现
====

TCU 硬件的功能分布在多个驱动程序中：

===========  =====
时钟         drivers/clk/ingenic/tcu.c
中断         drivers/irqchip/irq-ingenic-tcu.c
定时器       drivers/clocksource/ingenic-timer.c
OST         drivers/clocksource/ingenic-ost.c
PWM         drivers/pwm/pwm-jz4740.c
看门狗       drivers/watchdog/jz4740_wdt.c
===========  =====

由于属于不同驱动和框架的 TCU 的各种功能可以通过相同的寄存器进行控制，所有这些驱动都通过同一个 regmap 访问它们的寄存器。
有关 TCU 驱动程序的设备树绑定的更多信息，请参阅文档 `Documentation/devicetree/bindings/timer/ingenic,tcu.yaml`。
