SPDX 许可证标识符: GPL-2.0

========================
VCPU 分发统计信息
========================

对于共享处理器的 LPAR（逻辑分区），POWER 虚拟化管理程序保持 LPAR 处理器（VCPU）到物理处理器芯片（代表“宿主”节点）的相对静态映射，并试图始终在关联的物理处理器芯片上分发 VCPU。然而，在某些情况下，VCPU 可能在不同的处理器芯片上被分发（远离其宿主节点）。可以通过 `/proc/powerpc/vcpudispatch_stats` 获取与 VCPU 分发行为相关的统计信息。向此文件写入 '1' 可以启用收集这些统计信息，而写入 '0' 则禁用这些统计信息。默认情况下，每个 VCPU 的 DTLB 日志每秒处理 50 次，以免错过任何条目。可以通过 `/proc/powerpc/vcpudispatch_stats_freq` 更改此处理频率。通过读取 procfs 文件 `/proc/powerpc/vcpudispatch_stats` 可以获得这些统计信息。输出中的每一行对应一个由第一个字段表示的 VCPU，后面跟着 8 个数字。

第一个数字对应于：

1. 自统计信息开始收集以来的总 VCPU 分发次数

接下来的 4 个数字表示 VCPU 分发的分散情况：

2. 此 VCPU 上次被分发在同一处理器上的次数
3. 此 VCPU 上次被分发在相同芯片的不同处理器核心上的次数
4. 此 VCPU 上次被分发在不同芯片上的次数
5. 此 VCPU 上次被分发在不同插槽/抽屉（下一个 NUMA 边界）上的次数

最后 3 个数字表示与 VCPU 宿主节点相关的统计信息：

6. 此 VCPU 在其宿主节点（芯片）上被分发的次数
7. 此 VCPU 在其他节点上被分发的次数
8. 此 VCPU 在更远的节点（NUMA 距离）上被分发的次数

示例输出如下：

```
$ sudo cat /proc/powerpc/vcpudispatch_stats
cpu0 6839 4126 2683 30 0 6821 18 0
cpu1 2515 1274 1229 12 0 2509 6 0
...
cpu15 2163 1115 1032 16 0 2155 8 0
```

在上面的输出中，对于 VCPU0，自统计信息启用以来共有 6839 次分发。其中 4126 次分发是在上次相同的物理 CPU 上。2683 次分发是在同一芯片的不同核心上，而 30 次分发则是在不同的芯片上进行的。
此外，在总共 6839 次分发中，我们看到有 6821 次分发是在 VCPU 的宿主节点上，而 18 次分发是在宿主节点之外，位于相邻的芯片上。
