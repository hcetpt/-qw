===============================
Linux USB 打印机 Gadget 驱动程序
===============================

06/04/2007

版权所有 (C) 2007 克雷格·W·纳德勒 <craig@nadler.us>

---

概述
====

此驱动程序可用于您在嵌入式操作系统 Linux 中编写打印机固件的情况。该驱动程序与在您的 Linux 主机系统中使用打印机无关。
您需要一个 USB 设备控制器和一个接受使用 Linux USB Gadget API 的 gadget/“设备类别”驱动程序的 Linux 驱动程序。加载 USB 设备控制器驱动程序后，再加载打印机 gadget 驱动程序，
这将向与您的 USB 设备端口相连的 USB 主机呈现一个打印机接口。
此驱动程序是为运行在用户模式下的打印机固件设计的。用户模式的打印机固件将通过设备文件从内核模式的打印机 gadget 驱动程序读取和写入数据。当 USB 主机发送设备请求以获取打印机状态时，打印机返回一个打印机状态字节。用户空间固件可以通过设备文件 /dev/g_printer 读取或写入此状态字节。支持阻塞和非阻塞的读/写调用。

如何使用此驱动程序
=====================

要加载 USB 设备控制器驱动程序和打印机 gadget 驱动程序，请参考以下示例（示例中使用的是 Netchip 2280 USB 设备控制器驱动程序）：

```
modprobe net2280
modprobe g_printer
```

加载打印机 gadget 时可以使用以下命令行参数（例如：`modprobe g_printer idVendor=0x0525 idProduct=0xa4a8`）：

- `idVendor`
    - 这是在设备描述符中使用的供应商 ID。默认值为 Netchip 供应商 ID 0x0525。在发布产品之前，**您必须将其更改为自己的供应商 ID**。如果您计划发布产品但尚未拥有供应商 ID，请访问 www.usb.org 了解如何获得一个。
- `idProduct`
    - 这是在设备描述符中使用的产品 ID。默认值为 0xa4a8，如果您的其他 USB 产品有已使用的 ID，则建议您更改此值。为您的产品从例如 0x0001 开始编号是一个好主意。
- `bcdDevice`
    - 这是您产品的版本号。在此处放入您的固件版本是一个好主意。
- `iManufacturer`
    - 包含供应商名称的字符串。
- `iProduct`
    - 包含产品名称的字符串。
- `iSerialNum`
    - 包含序列号的字符串。对于每个单位的产品，应更改此值。
