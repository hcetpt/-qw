SPDX 许可证标识符: GPL-2.0

=======================================
已知的 CPU 虚拟化限制
=======================================

每当完全模拟某个 CPU 特性变得不可能或过于困难时，KVM 必须在不实现该特性与引入虚拟机和裸金属系统之间的行为差异之间做出选择。此文件记录了 KVM 在虚拟化 CPU 特性时的一些已知限制。

x86
===

``KVM_GET_SUPPORTED_CPUID`` 问题
----------------------------------

x87 特性
~~~~~~~~~~~~

与大多数其他 CPUID 特性位不同，CPUID[EAX=7,ECX=0]:EBX[6]（FDP_EXCPTN_ONLY）和 CPUID[EAX=7,ECX=0]:EBX[13]（ZERO_FCS_FDS）如果这些特性存在则被清除，如果这些特性不存在则被设置。在 CPUID 中清除这些位对来宾的操作没有影响；如果这些位在硬件上被设置，则这些特性不会出现在运行于该硬件上的任何虚拟机中。
**解决方法：** 建议始终在来宾 CPUID 中设置这些位。然而需要注意的是，任何期望这些特性存在的软件（例如 `WIN87EM.DLL`）可能早于这些 CPUID 特性位，并且因此不知道要检查这些位。

嵌套虚拟化特性
------------------------------

待定

x2APIC
------
当启用 KVM_X2APIC_API_USE_32BIT_IDS 时，KVM 激活了一个 hack/quirk，允许即使目标 vCPU 启用了传统 xAPIC，也可以使用其 x2APIC ID 发送事件，例如通过 INIT-SIPI 在具有超过 255 个 vCPU 的 VM 上启动热插拔 vCPU。这个 quirk 的副作用是，如果多个 vCPU 具有相同的物理 APIC ID，KVM 将仅将针对该 APIC ID 的事件发送到具有最低 vCPU ID 的 vCPU。如果未启用 KVM_X2APIC_API_USE_32BIT_IDS，KVM 在处理中断时遵循 x86 架构（所有匹配目标 APIC ID 的 vCPU 都会收到中断）。
