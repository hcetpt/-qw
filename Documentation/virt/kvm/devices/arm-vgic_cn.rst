SPDX 许可证标识符: GPL-2.0

==================================================
ARM 虚拟通用中断控制器版本 2 (VGIC)
==================================================

支持的设备类型：

  - KVM_DEV_TYPE_ARM_VGIC_V2    ARM 通用中断控制器版本 2.0

只能通过此 API 或过时的 KVM_CREATE_IRQCHIP API 实例化一个 VGIC。创建的 VGIC 将作为虚拟机的中断控制器，要求模拟用户空间设备将中断注入到 VGIC 而不是直接注入到 CPU。
支持硬件兼容性的 GICv3 实现允许通过此接口创建来宾 GICv2。有关创建来宾 GICv3 设备和来宾 ITS 设备的信息，请参阅 arm-vgic-v3.txt。在同一虚拟机上不可能同时创建 GICv3 和 GICv2 设备。

组：
  KVM_DEV_ARM_VGIC_GRP_ADDR
   属性：

    KVM_VGIC_V2_ADDR_TYPE_DIST（读写，64位）
      在来宾物理地址空间中 GIC 分配器寄存器映射的基本地址。仅对 KVM_DEV_TYPE_ARM_VGIC_V2 有效。
      此地址需要 4K 对齐，并且该区域覆盖 4 KB。
    KVM_VGIC_V2_ADDR_TYPE_CPU（读写，64位）
      在来宾物理地址空间中 GIC 虚拟 CPU 接口寄存器映射的基本地址。仅对 KVM_DEV_TYPE_ARM_VGIC_V2 有效。
      此地址需要 4K 对齐，并且该区域覆盖 4 KB。

错误：

    =======  =============================================================
    -E2BIG   地址超出可寻址 IPA 范围
    -EINVAL  地址对齐不正确
    -EEXIST  地址已配置
    -ENXIO   组或属性未知/不受支持，或者缺少硬件支持
    -EFAULT  attr->addr 的用户指针无效
    =======  =============================================================

  KVM_DEV_ARM_VGIC_GRP_DIST_REGS
   属性：

    kvm_device_attr 的 attr 字段编码两个值：

      位：     | 63   ....  40 | 39 ..  32  |  31   ....    0 |
      值：     |    保留       | vcpu_index |      偏移量    |

    所有分配器寄存器都是（读写，32位）

    偏移量相对于 GICv2 规范中定义的“分配器基地址”。获取或设置此类寄存器的效果与从指定 vcpu_index 的 CPU 读取或写入实际硬件上的寄存器相同。请注意，大多数分配器字段是非分页的，无论使用哪个 vcpu_index 访问寄存器都会返回相同的值。
    当 KVM 实现的模拟 GICv2 发生直接影响来宾或用户空间可见的变化时，GICD_IIDR.Revision 将更新。
用户空间应从KVM读取GICD_IIDR，并将读取的值写回以确认其预期行为与KVM实现一致。
用户空间应在设置其他寄存器（包括KVM_DEV_ARM_VGIC_GRP_DIST_REGS和KVM_DEV_ARM_VGIC_GRP_CPU_REGS）之前设置GICD_IIDR，以确保预期的行为。除非用户空间已设置了GICD_IIDR，否则对中断组寄存器（GICD_IGROUPR）的写入将被忽略。

错误：

    =======  =====================================================
    -ENXIO   获取或设置此寄存器尚未支持
    -EBUSY   一个或多个VCPUs正在运行
    -EINVAL  提供了无效的vcpu_index
    =======  =====================================================

KVM_DEV_ARM_VGIC_GRP_CPU_REGS
属性：

kvm_device_attr的attr字段编码两个值：

      bits:     | 63   ....  40 | 39 ..  32  |  31   ....    0 |
      values:   |    reserved   | vcpu_index |      offset     |

所有CPU接口寄存器都是（可读写，32位）

offset指定了从GICv2规范中定义的“CPU接口基地址”的偏移量。获取或设置此类寄存器的效果等同于在实际硬件上读取或写入该寄存器。

活动优先级寄存器APRn是实现定义的，因此我们为我们的实现设定了一个固定的格式，符合我们向客户机展示的“没有安全扩展的GICv2实现”模型。这个接口始终暴露四个寄存器APR[0-3]，描述最大可能的128个抢占级别。寄存器的语义通过设置相应位来指示给定抢占级别中的任何中断是否处于活动状态。

因此，抢占级别X有一个或多个活动中断当且仅当：

      APRn[X mod 32] == 0b1，其中n = X / 32

未定义的抢占级别的位是RAZ/WI
请注意，这与硬件上没有安全扩展的GIC的CPU视图不同，在硬件上，GIC分别在不同的寄存器组中暴露组0和组1的活动优先级，而我们显示的是类似于GICv2的GICH_APR的组合视图。

出于历史原因以及为了提供与用户空间的ABI兼容性，我们将GICC_PMR寄存器导出为GICH_VMCR.VMPriMask字段的格式，位于一个字的低5位，这意味着用户空间必须始终使用低5位与KVM设备通信，并且必须将该值左移3位以获得实际的优先级掩码级别。

错误：

    =======  =====================================================
    -ENXIO   获取或设置此寄存器尚未支持
    -EBUSY   一个或多个VCPUs正在运行
    -EINVAL  提供了无效的vcpu_index
    =======  =====================================================

KVM_DEV_ARM_VGIC_GRP_NR_IRQS
属性：

描述此GIC实例中断数（SGI，PPI和SPI）的值，范围从64到1024，以32为增量

错误：

    =======  =============================================================
    -EINVAL  设置的值超出预期范围
    -EBUSY   值已经被设置，或者GIC已经用默认值初始化
    =======  =============================================================

KVM_DEV_ARM_VGIC_GRP_CTRL
属性：

KVM_DEV_ARM_VGIC_CTRL_INIT
请求初始化VGIC或ITS，kvm_device_attr.addr中没有额外参数
错误：

    =======  =========================================================
    -ENXIO   在调用此属性之前，VGIC 未按要求正确配置
    -ENODEV  没有在线的 VCPU
    -ENOMEM  分配 VGIC 内部数据时内存不足
    =======  =========================================================
