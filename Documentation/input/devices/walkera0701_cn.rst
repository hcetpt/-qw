Walkera WK-0701发射器
===========================

Walkera WK-0701发射器随同即飞型Walkera直升机（如HM36、HM37、HM60）一同提供。Walkera0701模块使您能够将此发射器用作操纵杆。

开发主页和下载：
http://zub.fei.tuke.sk/walkera-wk0701/

或者使用cogito：
cg-clone http://zub.fei.tuke.sk/GIT/walkera0701-joystick

连接到PC
================

在发射器的背面可以找到S视频连接器。调制脉冲从处理器到高频部分可以在该连接器的第2脚找到，第3脚是地（GND）。在第3脚和CPU之间有一个5.6k欧姆的电阻。为了将调制脉冲传送到PC，信号脉冲必须被放大。
线缆：（Walkera TX到并口）

Walkera WK-0701 TX S-VIDEO连接器：

（TX背面）
     __   __              S视频:                                  佳能25
    /  |_|  \             第2脚（信号）              NPN           并口
   / O 4 3 O \            第3脚（GND）        LED        ________________  10 ACK
  ( O 2   1 O )                                         | C
   \   ___   /      2 ________________________|\|_____|/
    | [___] |                                 |/|   B |\
     -------        3 __________________________________|________________ 25 GND
                                                          E

我使用了绿色LED和BC109 NPN晶体管
软件
========

构建包含walkera0701模块的内核。模块walkera0701需要独占访问并口，在加载walkera0701模块之前，必须卸载像lp这样的模块，并检查dmesg中的错误消息。通过电缆将TX连接到PC并运行jstest /dev/input/js0以查看TX的值。如果无法通过TX“操纵杆”更改任何值，请检查/proc/interrupts的输出。如果TX处于开启状态，通常为irq7的并口中断值应增加。
技术细节
=================

驱动程序使用来自并口ACK输入位的中断来测量脉冲长度，使用hrtimers。
帧格式：
基于Shaul Eizikovich对Walkera WK-0701 PCM格式的描述（下载自http://www.smartpropoplus.com/Docs/Walkera_Wk-0701_PCM.pdf）

信号脉冲
-------------

```
                     （模拟）
      SYNC      BIN   OCT
    +---------+      +------+
    |         |      |      |
  --+         +------+      +---
```

帧
-----

```
SYNC , BIN1, OCT1, BIN2, OCT2 ... BIN24, OCT24, BIN25, 下一帧 SYNC .
脉冲长度
------------

```
   二进制值：		 模拟八进制值：

   288 微秒 二进制 0		318 微秒       000
   438 微秒 二进制 1		398 微秒       001
					478 微秒       010
					558 微秒       011
					638 微秒       100
  1306 微秒 同步			718 微秒       101
					798 微秒       110
					878 微秒       111

24个bin+oct值 + 1个bin值 = 24 * 4 + 1位 = 97位

（警告：ACK上的脉冲通过晶体管反转，irq在同步到bin变化或八进制值到bin变化时上升）
二进制数据表示
---------------------------

一个二进制和八进制值可以组合成一个字节的四分之一。24个字节的四分之一加上一个二进制值可以在同步脉冲之间采样。
前四个通道（模拟操纵杆值）的值可以在前10个字节的四分之一中找到。模拟值由一个符号位和9位绝对二进制值表示。（每通道10位）。下一个字节的四分之一是前十个字节的校验和。
接下来的字节的四分之一12到21代表四个通道（并非所有通道都可以直接从TX控制）。二进制表示与前四个通道相同。在字节的四分之一22和23中有一个特殊的魔法数字。字节的四分之一24是字节的四分之一12到23的校验和。
在最后一个八进制值（第24个四位组）之后和下一个同步脉冲之前，可以采样一个额外的二进制值。这个位和神奇数字在软件驱动中未被使用。关于这些神奇数字的一些详细信息可以在 Walkera_Wk-0701_PCM.pdf 中找到。

校验和计算
--------------------

各位组中八进制值的总和必须与校验和位组中的八进制值相同（仅使用前3位）。校验和位组的二进制值通过以下方式计算：被检查位组中的二进制值之和加上被检查位组中的八进制值之和除以8。只使用这个和的第0位。
