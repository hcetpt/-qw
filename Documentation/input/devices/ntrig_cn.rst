```rst
.. include:: <isonum.txt>

=========================
N-Trig 触摸屏驱动程序
=========================

:版权: |copy| 2008-2010 Rafi Rubin <rafi@seas.upenn.edu>
:版权: |copy| 2009-2010 Stephane Chatty

该驱动程序为 N-Trig 笔和多点触控传感器提供支持。单点和多点触摸事件会被转换为适用于 HID 和输入系统的适当协议。笔事件已经足够符合 HID 标准，并由 HID 内核处理。该驱动还提供了通过 sysfs 和模块参数访问的附加过滤和实用功能。此驱动程序已报告可正常支持多个 N-Trig 设备连接。

参数
----------

注意：加载时设置的值是全局的，将应用于所有适用设备。通过 sysfs 调整参数将覆盖加载时的值，但仅针对该设备。
以下参数用于配置滤波器以减少噪声：

+-----------------------+-----------------------------------------------------+
|activate_slack         | 在处理事件前忽略的手指数量                           |
+-----------------------+-----------------------------------------------------+
|activation_height,     | 激活阈值（大小）                                     |
|activation_width       |                                                    |
+-----------------------+-----------------------------------------------------+
|min_height,            | 大小阈值，在此阈值以下的手指将被忽略                 |
|min_width              | 用于决定激活及活动期间的阈值                         |
+-----------------------+-----------------------------------------------------+
|deactivate_slack       | 在传播结束活动事件前忽略的“无接触”帧的数量           |
+-----------------------+-----------------------------------------------------+

当最后一个手指离开设备后，它会发送一些空帧。通过在去激活时等待几帧，我们可以容忍错误断开的情况，即传感器可能会误报没有检测到仍然存在的手指。因此，`deactivate_slack` 解决了用户在绘图时看到线条中断或长拖动过程中丢失对象的问题。

额外的 sysfs 项
----------------------

这些节点仅提供对设备报告范围的轻松访问：

+-----------------------+-----------------------------------------------------+
|sensor_logical_height, | 活动期间位置报告的范围                              |
|sensor_logical_width   |                                                    |
+-----------------------+-----------------------------------------------------+
|sensor_physical_height,| 内部范围，不用于正常事件但有助于调整               |
|sensor_physical_width  |                                                    |
+-----------------------+-----------------------------------------------------+

所有产品 ID 为 1 的 N-Trig 设备报告的事件范围为：

* X: 0-9600
* Y: 0-7200

然而，并非所有这些设备都具有相同的物理尺寸。大多数是 12 英寸传感器（如 Dell Latitude XT 和 XT2 以及 HP TX2），至少有一个型号（Dell Studio 17）具有 17 英寸传感器。物理尺寸与逻辑尺寸的比例用于调整基于大小的滤波器参数。

滤波
---------

随着早期多点触控固件的发布，这些传感器容易出现错误事件的问题变得越来越明显。用户报告称，出现了不适当的接触丢失和幽灵接触，即在没有手指实际触摸屏幕的情况下报告了接触。

去激活延迟有助于防止单点触控使用中的接触丢失，但并不能解决在其他接触仍处于活动状态时其中一个或多个接触丢失的问题。多点触控情况下的丢失需要额外的处理，并应与跟踪一起处理。

观察到的幽灵接触与实际使用传感器类似，但它们似乎有不同的特征。幽灵活动通常表现为短暂的小接触。因此，我认为连续事件流越长，这些事件来自真实接触的可能性就越大；每次接触的大小越大，其真实性的可能性也越大。为了平衡防止幽灵和快速接受真实事件（以最小化用户可观察到的延迟）的目标，滤波器会累积对传入事件的信心，直到达到阈值并开始传播。为了尽量减少存储的状态以及做出决策的操作成本，我保持了简单的决策过程。

时间是以报告的手指数量来衡量的，而不是帧数，因为预期多个同时出现的幽灵的概率会随着数量的增加而急剧下降。我没有将大小作为累积权重的因素，而是只用作二进制阈值。足够大的接触会立即覆盖等待期并导致激活。
```
设置较大的激活尺寸阈值会导致主要依据激活空闲时间来决定。如果你看到持续时间较长的幽灵触点，增加激活空闲时间并减少尺寸阈值可能足以消除这些幽灵触点，同时保持屏幕对坚定触摸的响应性。

即使在初始激活过滤器满足条件后，接触点仍然会通过 `min_height` 和 `min_width` 进行过滤。其目的是提供一种机制来过滤掉实际使用屏幕时出现的额外手指形式的幽灵触点。实际上，这种类型的幽灵触点问题较少或相对罕见，因此我将这两个参数的默认值都设为 0，有效地关闭了这个过滤器。

我不知道这些过滤器的最佳值是多少。如果默认值不适合你，请尝试调整这些参数。如果你发现其他值更舒适，请给我反馈。

这些设备的校准会随时间漂移。如果幽灵触点或接触丢失加剧，并干扰到你的设备正常使用，请尝试重新校准。

### 校准
------------

N-Trig 的 Windows 工具提供了校准和测试功能。此外，还有一个非官方且不受支持的用户空间工具集，包括一个校准工具，可以在以下地址获取：
http://code.launchpad.net/~rafi-seas/+junk/ntrig_calib

### 跟踪
--------

目前所有测试过的 N-Trig 固件都不支持手指跟踪。当多个接触点活跃时，它们似乎主要按 Y 坐标进行排序。
