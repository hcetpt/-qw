SPDX 许可证标识符: GPL-2.0

===============================
Acorn 磁盘文件系统 - ADFS
===============================

ADFS 支持的文件系统
-----------------------------

ADFS 模块支持以下 Filecore 格式，这些格式具有：

- 新的地图
- 新目录或大目录

就上述格式而言，这意味着我们支持：

- E 和 E+，无论是否带有引导块
- F 和 F+

我们完全支持从这些文件系统读取文件，并在现有分配中写入现有文件。基本上，我们不支持更改任何文件系统的元数据。
这旨在支持在 RISC OS 文件系统上挂载回环方式的 Linux 本机文件系统，但允许修改文件内的数据。
如果配置了写入支持（ADFS_FS_RW），我们允许进行基本的目录更新，特别是更新访问模式和时间戳。

ADFS 的挂载选项
----------------------

  ============  ======================================================
  uid=nnn       分区中的所有文件将由用户 ID nnn 所有，默认为 0（root）
gid=nnn       分区中的所有文件都属于组 nnn，默认为 0（root）
ownmask=nnn   ADFS '所有者'权限的权限掩码将是 nnn，默认为 0700
othmask=nnn   ADFS '其他'权限的权限掩码将是 nnn，默认为 0077
ftsuffix=n    当 ftsuffix=0 时，不会应用文件类型后缀
当 ftsuffix=1 时，会添加一个十六进制后缀，对应于 RISC OS 文件类型，默认为 0
============  ======================================================

ADFS 权限到 Linux 权限的映射
------------------------------------------------

ADFS 权限包括以下内容：

- 所有者读取
- 所有者写入
- 其他读取
- 其他写入

（在旧版本中，确实存在一个“执行”权限，但这与 Linux 的“执行”权限含义不同，现在已过时）
映射如下所示：

- 所有者读取 -> -r--r--r--
- 所有者写入 -> --w--w---w
- 所有者读取和Unix执行文件类型 -> ---x--x--x
- 这些权限然后被所有者掩码（ownmask）屏蔽，例如 700 -> -rwx------
- 可能的所有者模式权限 -> -rwx------

- 其他人读取 -> -r--r--r--
- 其他人写入 -> --w--w--w-
- 其他人读取和Unix执行文件类型 -> ---x--x--x
- 这些权限然后被其他掩码（othmask）屏蔽，例如 077 -> ----rwxrwx
- 可能的其他人模式权限 -> ----rwxrwx

因此，默认掩码下，如果一个文件具有所有者读/写权限，并且不是Unix执行文件类型，则权限将为：

- -rw-------

然而，如果掩码为 ownmask=0770, othmask=0007，则权限会被修改为：

- -rw-rw----

对于这些掩码没有任何限制。你可以选择让任何读权限都给予所有人对该文件的读访问权，但保留默认的写保护（ownmask=0755, othmask=0577）：

- -rw-r--r--

因此，你可以根据需要自定义权限转换，以实现Linux下所需的权限。

### RISC OS 文件类型后缀
------------------------

RISC OS 文件类型存储在文件加载地址的第19到第8位中。
为了使非RISC OS系统能够存储文件而不丢失文件类型信息，设计了一种文件命名约定（最初用于NFS），即十六进制后缀形式 ,xyz 表示文件类型：例如 BasicFile,ffb 是一个BASIC文件（0xffb）。这种命名约定现在也被RISC OS模拟器如RPCEmu使用。
挂载ADFS磁盘时，如果选项 ftsuffix=1，则会为从目录读取的文件名添加适当的文件类型后缀。如果 ftsuffix 选项为零或省略，则不会添加文件类型后缀。
