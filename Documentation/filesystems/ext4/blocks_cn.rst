SPDX 许可证标识符: GPL-2.0

块
---

ext4 以“块”为单位分配存储空间。一个块是一组介于 1KiB 到 64KiB 之间的扇区，且扇区的数量必须是 2 的整数次幂。块又进一步组合成更大的单元，称为块组。块大小在格式化时指定，默认通常是 4KiB。如果块大小大于页大小（例如，在只有 4KiB 内存页的 i386 上使用 64KiB 块），可能会遇到挂载问题。默认情况下，文件系统可以包含 2^32 个块；如果启用了“64位”功能，则文件系统可以拥有 2^64 个块。结构的位置是以该结构所在的块号而不是磁盘上的绝对偏移来存储的。

对于 32 位文件系统，限制如下：

| 项目           | 1KiB       | 2KiB       | 4KiB       | 64KiB      |
|----------------|------------|------------|------------|------------|
| 块             | 2^32       | 2^32       | 2^32       | 2^32       |
| 索引节点       | 2^32       | 2^32       | 2^32       | 2^32       |
| 文件系统大小    | 4TiB       | 8TiB       | 16TiB      | 256TiB     |
| 每个块组中的块  | 8,192      | 16,384     | 32,768     | 524,288    |
| 每个块组中的索引节点 | 8,192      | 16,384     | 32,768     | 524,288    |
| 块组大小       | 8MiB       | 32MiB      | 128MiB     | 32GiB      |
| 每个文件中的块，范围 | 2^32       | 2^32       | 2^32       | 2^32       |
| 每个文件中的块，块映射 | 16,843,020 | 134,480,396 | 1,074,791,436 | 4,398,314,962,956（实际为 2^32，因为字段大小限制） |
| 文件大小，范围  | 4TiB       | 8TiB       | 16TiB      | 256TiB     |
| 文件大小，块映射 | 16GiB      | 256GiB     | 4TiB       | 256TiB     |

对于 64 位文件系统，限制如下：

| 项目           | 1KiB       | 2KiB       | 4KiB       | 64KiB      |
|----------------|------------|------------|------------|------------|
| 块             | 2^64       | 2^64       | 2^64       | 2^64       |
| 索引节点       | 2^32       | 2^32       | 2^32       | 2^32       |
| 文件系统大小    | 16ZiB      | 32ZiB      | 64ZiB      | 1YiB       |
| 每个块组中的块  | 8,192      | 16,384     | 32,768     | 524,288    |
| 每个块组中的索引节点 | 8,192      | 16,384     | 32,768     | 524,288    |
| 块组大小       | 8MiB       | 32MiB      | 128MiB     | 32GiB      |
| 每个文件中的块，范围 | 2^32       | 2^32       | 2^32       | 2^32       |
| 每个文件中的块，块映射 | 16,843,020 | 134,480,396 | 1,074,791,436 | 4,398,314,962,956（实际为 2^32，因为字段大小限制） |
| 文件大小，范围  | 4TiB       | 8TiB       | 16TiB      | 256TiB     |
| 文件大小，块映射 | 16GiB      | 256GiB     | 4TiB       | 256TiB     |

注意：不使用范围（即使用块映射）的文件必须放置在文件系统的前 2^32 个块内。使用范围的文件必须放置在文件系统的前 2^48 个块内。对于更大的文件系统，目前尚不清楚会发生什么情况。
