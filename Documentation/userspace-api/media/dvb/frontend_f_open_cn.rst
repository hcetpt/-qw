SPDX 许可声明标识符: GFDL-1.1-no-invariants-or-later
C 命名空间: DTV.fe

.. _frontend_f_open:

***************************
数字电视前端 open()
***************************

名称
====

fe-open - 打开一个前端设备

概要
========

.. code-block:: c

    #include <fcntl.h>

.. c:function:: int open( const char *device_name, int flags )

参数
=========

``device_name``
    要打开的设备
``flags``
    打开标志。访问可以是 ``O_RDWR`` 或 ``O_RDONLY``
允许使用 ``O_RDONLY`` 进行多次打开。在此模式下，仅允许查询和读取 ioctl 操作
只允许在 ``O_RDWR`` 下进行一次打开。在此模式下，所有 ioctl 操作都是允许的
当给出 ``O_NONBLOCK`` 标志时，如果没有任何数据可用或设备驱动程序暂时繁忙，则系统调用可能会返回 ``EAGAIN`` 错误码
其他标志没有效果
描述
===========

此系统调用用于打开指定的前端设备（如 ``/dev/dvb/adapter?/frontend?``）以供后续使用。通常，在成功打开后需要做的第一件事是使用 :ref:`FE_GET_INFO` 来确定前端类型。
设备可以以只读模式打开，这仅允许监控设备状态和统计信息，或者以读写模式打开，这允许任何类型的使用（例如执行调谐操作）。

在一个具有多个前端的系统中，通常情况下不能同时打开多个设备进行读写操作。只要一个前端设备以读写模式打开，其他以读写模式打开的 open() 调用将根据是否指定了非阻塞模式或阻塞模式而失败或被阻塞。使用 fcntl 系统调用中的 F_SETFL 命令可以在稍后将阻塞模式下的前端设备设置为非阻塞模式（反之亦然）。这是一个标准系统调用，在 Linux 的 fcntl 手册页中有详细说明。
当 open() 调用成功后，设备将以指定的模式准备好使用。这意味着相应的硬件已被启动，并且可能已关闭其他前端以实现这一点。
返回值
============

成功时 :c:func:`open()` 返回新的文件描述符
在发生错误时，返回 -1，并适当地设置 ``errno`` 变量。可能的错误代码包括：

成功时返回 0，并填充 :c:type:`ca_slot_info`
发生错误时返回 -1，并适当地设置 ``errno`` 变量

.. tabularcolumns:: |p{2.5cm}|p{15.0cm}|

.. flat-table::
    :header-rows:  0
    :stub-columns: 0
    :widths: 1 16

    -  - ``EPERM``
       -  调用者无权限访问设备
    -  - ``EBUSY``
       -  设备驱动程序已经在使用中
    -  - ``EMFILE``
       -  进程已打开的文件数量达到最大限制
    -  - ``ENFILE``
       -  系统上已打开的文件总数达到了限制

通用错误代码在 :ref:`Generic Error Codes <gen-errors>` 章节中有详细描述。
