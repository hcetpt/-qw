SPDX 许可证标识符: GFDL-1.1-no-invariants-or-later

********************************
详细的色彩空间描述
********************************

.. _col-smpte-170m:

色彩空间 SMPTE 170M（V4L2_COLORSPACE_SMPTE170M）
=================================================

:ref:`smpte170m` 标准定义了 NTSC 和 PAL 以及标清电视（SDTV）中使用的色彩空间。默认的传输函数是 `V4L2_XFER_FUNC_709`。默认的 Y'CbCr 编码是 `V4L2_YCBCR_ENC_601`。默认的 Y'CbCr 量化是有限范围。主要颜色和白参考的色度如下：

.. flat-table:: SMPTE 170M 色度
    :header-rows:  1
    :stub-columns: 0
    :widths:       1 1 2

    * - 颜色
      - x
      - y
    * - 红色
      - 0.630
      - 0.340
    * - 绿色
      - 0.310
      - 0.595
    * - 蓝色
      - 0.155
      - 0.070
    * - 白参考（D65）
      - 0.3127
      - 0.3290

红色、绿色和蓝色的色度也常被称为 SMPTE C 色域，因此这个色彩空间有时也称为 SMPTE C。为 SMPTE 170M 定义的传输函数与 Rec. 709 中定义的相同。

.. math::

    L' = -1.099(-L)^{0.45} + 0.099 \text{, for } L \le -0.018

    L' = 4.5L \text{, for } -0.018 < L < 0.018

    L' = 1.099L^{0.45} - 0.099 \text{, for } L \ge 0.018

逆传输函数：

.. math::

    L = -\left( \frac{L' - 0.099}{-1.099} \right) ^{\frac{1}{0.45}} \text{, for } L' \le -0.081

    L = \frac{L'}{4.5} \text{, for } -0.081 < L' < 0.081

    L = \left(\frac{L' + 0.099}{1.099}\right)^{\frac{1}{0.45} } \text{, for } L' \ge 0.081

亮度（Y'）和色差（Cb 和 Cr）通过以下 `V4L2_YCBCR_ENC_601` 编码获得：

.. math::

    Y' = 0.2990R' + 0.5870G' + 0.1140B'

    Cb = -0.1687R' - 0.3313G' + 0.5B'

    Cr = 0.5R' - 0.4187G' - 0.0813B'

Y' 被限制在 [0…1] 的范围内，而 Cb 和 Cr 被限制在 [-0.5…0.5] 的范围内。这种转换到 Y'CbCr 与 :ref:`itu601` 标准中定义的一致，并且该色彩空间有时也被称为 BT.601，尽管 BT.601 并未提及任何色域。默认量化是有限范围，但全范围也是可能的，尽管很少见。

.. _col-rec709:

色彩空间 Rec. 709（V4L2_COLORSPACE_REC709）
============================================

:ref:`itu709` 标准定义了一般高清电视（HDTV）中使用的色彩空间。默认的传输函数是 `V4L2_XFER_FUNC_709`。默认的 Y'CbCr 编码是 `V4L2_YCBCR_ENC_709`。默认的 Y'CbCr 量化是有限范围。主要颜色和白参考的色度如下：

.. flat-table:: Rec. 709 色度
    :header-rows:  1
    :stub-columns: 0
    :widths:       1 1 2

    * - 颜色
      - x
      - y
    * - 红色
      - 0.640
      - 0.330
    * - 绿色
      - 0.300
      - 0.600
    * - 蓝色
      - 0.150
      - 0.060
    * - 白参考（D65）
      - 0.3127
      - 0.3290

此标准的全名是 Rec. ITU-R BT.709-5。传输函数通常 L 的范围是 [0…1]，但对于扩展色域 xvYCC 编码允许超出该范围的值。

.. math::

    L' = -1.099(-L)^{0.45} + 0.099 \text{, for } L \le -0.018

    L' = 4.5L \text{, for } -0.018 < L < 0.018

    L' = 1.099L^{0.45} - 0.099 \text{, for } L \ge 0.018

逆传输函数：

.. math::

    L = -\left( \frac{L' - 0.099}{-1.099} \right)^\frac{1}{0.45} \text{, for } L' \le -0.081

    L = \frac{L'}{4.5}\text{, for } -0.081 < L' < 0.081

    L = \left(\frac{L' + 0.099}{1.099}\right)^{\frac{1}{0.45} } \text{, for } L' \ge 0.081

亮度（Y'）和色差（Cb 和 Cr）通过以下 `V4L2_YCBCR_ENC_709` 编码获得：

.. math::

    Y' = 0.2126R' + 0.7152G' + 0.0722B'

    Cb = -0.1146R' - 0.3854G' + 0.5B'

    Cr = 0.5R' - 0.4542G' - 0.0458B'

Y' 被限制在 [0…1] 的范围内，而 Cb 和 Cr 被限制在 [-0.5…0.5] 的范围内。默认量化是有限范围，但全范围也是可能的，尽管很少见。

上面描述的 `V4L2_YCBCR_ENC_709` 编码是此色彩空间的默认编码，但它可以通过 `V4L2_YCBCR_ENC_601` 进行覆盖，此时使用 BT.601 的 Y'CbCr 编码。

与此色彩空间相关的两种额外的扩展色域 Y'CbCr 编码也是可能的：

xvYCC 709 编码（`V4L2_YCBCR_ENC_XV709`，:ref:`xvycc`）类似于 Rec. 709 编码，但允许 R'、G' 和 B' 值超出 [0…1] 的范围。得到的 Y'、Cb 和 Cr 值根据有限范围公式进行缩放和偏移：

.. math::

    Y' = \frac{219}{256} * (0.2126R' + 0.7152G' + 0.0722B') + \frac{16}{256}

    Cb = \frac{224}{256} * (-0.1146R' - 0.3854G' + 0.5B')

    Cr = \frac{224}{256} * (0.5R' - 0.4542G' - 0.0458B')

xvYCC 601 编码（`V4L2_YCBCR_ENC_XV601`，:ref:`xvycc`）类似于 BT.601 编码，但允许 R'、G' 和 B' 值超出 [0…1] 的范围。得到的 Y'、Cb 和 Cr 值根据有限范围公式进行缩放和偏移：

.. math::

    Y' = \frac{219}{256} * (0.2990R' + 0.5870G' + 0.1140B') + \frac{16}{256}

    Cb = \frac{224}{256} * (-0.1687R' - 0.3313G' + 0.5B')

    Cr = \frac{224}{256} * (0.5R' - 0.4187G' - 0.0813B')

Y' 被限制在 [0…1] 的范围内，而 Cb 和 Cr 被限制在 [-0.5…0.5] 的范围内，并且没有进一步的缩放或偏移。
非标准的xvYCC 709或xvYCC 601编码可以通过选择`V4L2_YCBCR_ENC_XV709`或`V4L2_YCBCR_ENC_XV601`来使用。根据xvYCC公式，这些编码始终使用有限范围量化，没有全范围变体。这些扩展色域编码的关键在于，即使超出有限范围的值仍然有效，尽管它们映射到的R'、G'和B'值超出了[0…1]范围，因此在Rec. 709色域之外。

.. _col-srgb:

色域sRGB（V4L2_COLORSPACE_SRGB）
======================================

:srgb: 标准定义了大多数网络摄像头和计算机图形使用的色域。默认的传输函数是`V4L2_XFER_FUNC_SRGB`。默认的Y'CbCr编码是`V4L2_YCBCR_ENC_601`。默认的Y'CbCr量化是有限范围。请注意，:ref:`sycc`标准指定了全范围量化，但是所有当前内核支持的捕获硬件都将R'G'B'转换为有限范围Y'CbCr。因此，默认选择全范围将破坏应用程序对量化范围的解释。
主要颜色和白参考的色度如下：

.. flat-table:: sRGB 色度
    :header-rows:  1
    :stub-columns: 0
    :widths:       1 1 2

    * - 颜色
      - x
      - y
    * - 红色
      - 0.640
      - 0.330
    * - 绿色
      - 0.300
      - 0.600
    * - 蓝色
      - 0.150
      - 0.060
    * - 白参考 (D65)
      - 0.3127
      - 0.3290

这些色度与Rec. 709色域相同。注意，负值仅用于Y'CbCr转换。

.. math::

    L' = -1.055(-L)^{\frac{1}{2.4} } + 0.055\text{, for }L < -0.0031308

    L' = 12.92L\text{, for }-0.0031308 \le L \le 0.0031308

    L' = 1.055L ^{\frac{1}{2.4} } - 0.055\text{, for }0.0031308 < L \le 1

逆传输函数：

.. math::

    L = -((-L' + 0.055) / 1.055) ^{2.4}\text{, for }L' < -0.04045

    L = L' / 12.92\text{, for }-0.04045 \le L' \le 0.04045

    L = ((L' + 0.055) / 1.055) ^{2.4}\text{, for }L' > 0.04045

亮度（Y'）和色差（Cb和Cr）通过:ref:`sycc`定义的`V4L2_YCBCR_ENC_601`编码获得：

.. math::

    Y' = 0.2990R' + 0.5870G' + 0.1140B'

    Cb = -0.1687R' - 0.3313G' + 0.5B'

    Cr = 0.5R' - 0.4187G' - 0.0813B'

Y'被限制在[0…1]范围内，Cb和Cr被限制在[-0.5…0.5]范围内。这种变换与SMPTE 170M/BT.601中定义的相同。Y'CbCr量化是有限范围的。

.. _col-oprgb:

色域opRGB（V4L2_COLORSPACE_OPRGB）
===============================================

:ref:`oprgb` 标准定义了使用opRGB色域的计算机图形色域。默认的传输函数是`V4L2_XFER_FUNC_OPRGB`。默认的Y'CbCr编码是`V4L2_YCBCR_ENC_601`。默认的Y'CbCr量化是有限范围的。
请注意，:ref:`oprgb` 标准指定了全范围量化，但是所有当前内核支持的捕获硬件都将R'G'B'转换为有限范围Y'CbCr。因此，默认选择全范围将破坏应用程序对量化范围的解释。
主要颜色和白参考的色度如下：

.. flat-table:: opRGB 色度
    :header-rows:  1
    :stub-columns: 0
    :widths:       1 1 2

    * - 颜色
      - x
      - y
    * - 红色
      - 0.6400
      - 0.3300
    * - 绿色
      - 0.2100
      - 0.7100
    * - 蓝色
      - 0.1500
      - 0.0600
    * - 白参考 (D65)
      - 0.3127
      - 0.3290

传输函数：

.. math::

    L' = L ^{\frac{1}{2.19921875}}

逆传输函数：

.. math::

    L = L'^{(2.19921875)}

亮度（Y'）和色差（Cb和Cr）通过以下`V4L2_YCBCR_ENC_601`编码获得：

.. math::

    Y' = 0.2990R' + 0.5870G' + 0.1140B'

    Cb = -0.1687R' - 0.3313G' + 0.5B'

    Cr = 0.5R' - 0.4187G' - 0.0813B'

Y'被限制在[0…1]范围内，Cb和Cr被限制在[-0.5…0.5]范围内。这种变换与SMPTE 170M/BT.601中定义的相同。Y'CbCr量化是有限范围的。
颜色空间 BT.2020（V4L2_COLORSPACE_BT2020）
===========================================

ITU-R BT.2020 标准定义了超高清电视（UHDTV）使用的颜色空间。默认的传输函数是 `V4L2_XFER_FUNC_709`。默认的 Y'CbCr 编码是 `V4L2_YCBCR_ENC_BT2020`。默认的 Y'CbCr 量化范围是有限范围。主要颜色和白点参考的色度如下：

.. flat-table:: BT.2020 色度
    :header-rows:  1
    :stub-columns: 0
    :widths:       1 1 2

    * - 颜色
      - x
      - y
    * - 红色
      - 0.708
      - 0.292
    * - 绿色
      - 0.170
      - 0.797
    * - 蓝色
      - 0.131
      - 0.046
    * - 白点参考（D65）
      - 0.3127
      - 0.3290

传输函数（与 Rec. 709 相同）：

.. math::

    L' = 4.5L\text{, for }0 \le L < 0.018

    L' = 1.099L ^{0.45} - 0.099\text{, for } 0.018 \le L \le 1

逆传输函数：

.. math::

    L = L' / 4.5\text{, for } L' < 0.081

    L = \left( \frac{L' + 0.099}{1.099}\right) ^{\frac{1}{0.45} }\text{, for } L' \ge 0.081

请注意，尽管 Rec. 709 被 ITU-R BT.2020 标准定义为默认传输函数，在实际应用中，这个颜色空间经常与 `xf-smpte-2084` 一起使用。特别是 Ultra HD Blu-ray 光盘使用这种组合。

亮度（Y'）和色差（Cb 和 Cr）通过以下 `V4L2_YCBCR_ENC_BT2020` 编码获得：

.. math::

    Y' = 0.2627R' + 0.6780G' + 0.0593B'

    Cb = -0.1396R' - 0.3604G' + 0.5B'

    Cr = 0.5R' - 0.4598G' - 0.0402B'

Y' 被限制在 [0…1] 范围内，Cb 和 Cr 被限制在 [-0.5…0.5] 范围内。Y'CbCr 的量化范围是有限的。

还有一种替代的恒定亮度 R'G'B' 到 Yc'CbcCrc (`V4L2_YCBCR_ENC_BT2020_CONST_LUM`) 编码：

亮度：

.. math::
    :nowrap:

    \begin{align*}
    Yc' = (0.2627R + 0.6780G + 0.0593B)'& \\
    B' - Yc' \le 0:& \\
        &Cbc = (B' - Yc') / 1.9404 \\
    B' - Yc' > 0: & \\
        &Cbc = (B' - Yc') / 1.5816 \\
    R' - Yc' \le 0:& \\
        &Crc = (R' - Y') / 1.7184 \\
    R' - Yc' > 0:& \\
        &Crc = (R' - Y') / 0.9936
    \end{align*}

Yc' 被限制在 [0…1] 范围内，Cbc 和 Crc 被限制在 [-0.5…0.5] 范围内。Yc'CbcCrc 的量化范围是有限的。

.. _col-dcip3:

颜色空间 DCI-P3（V4L2_COLORSPACE_DCI_P3）
==========================================

SMPTE 431 标准定义了使用 DCI-P3 颜色空间的电影放映机所使用颜色空间。默认的传输函数是 `V4L2_XFER_FUNC_DCI_P3`。默认的 Y'CbCr 编码是 `V4L2_YCBCR_ENC_709`。默认的 Y'CbCr 量化范围是有限范围。

.. note::

   注意该颜色空间标准没有指定 Y'CbCr 编码，因为它不打算被编码为 Y'CbCr。因此，默认选择了 HDTV 编码作为 Y'CbCr 编码。

主要颜色和白点参考的色度如下：

.. flat-table:: DCI-P3 色度
    :header-rows:  1
    :stub-columns: 0
    :widths:       1 1 2

    * - 颜色
      - x
      - y
    * - 红色
      - 0.6800
      - 0.3200
    * - 绿色
      - 0.2650
      - 0.6900
    * - 蓝色
      - 0.1500
      - 0.0600
    * - 白点参考
      - 0.3140
      - 0.3510

传输函数：

.. math::

    L' = L^{\frac{1}{2.6}}

逆传输函数：

.. math::

    L = L'^{(2.6)}

Y'CbCr 编码未指定。V4L2 默认采用 Rec. 709 编码。

.. _col-smpte-240m:

颜色空间 SMPTE 240M（V4L2_COLORSPACE_SMPTE240M）
=================================================

SMPTE 240M 标准是在 HDTV 早期阶段（1988-1998）使用的过渡标准，已被 Rec. 709 取代。默认的传输函数是 `V4L2_XFER_FUNC_SMPTE240M`。默认的 Y'CbCr 编码是 `V4L2_YCBCR_ENC_SMPTE240M`。默认的 Y'CbCr 量化范围是有限范围。主要颜色和白点参考的色度如下：

.. flat-table:: SMPTE 240M 色度
    :header-rows:  1
    :stub-columns: 0
    :widths:       1 1 2

    * - 颜色
      - x
      - y
    * - 红色
      - 0.630
      - 0.340
    * - 绿色
      - 0.310
      - 0.595
    * - 蓝色
      - 0.155
      - 0.070
    * - 白点参考（D65）
      - 0.3127
      - 0.3290

这些色度与 SMPTE 170M 颜色空间相同。

传输函数：

.. math::

    L' = 4L\text{, for } 0 \le L < 0.0228

    L' = 1.1115L ^{0.45} - 0.1115\text{, for } 0.0228 \le L \le 1

逆传输函数：

.. math::

    L = \frac{L'}{4}\text{, for } 0 \le L' < 0.0913

    L = \left( \frac{L' + 0.1115}{1.1115}\right) ^{\frac{1}{0.45} }\text{, for } L' \ge 0.0913

亮度（Y'）和色差（Cb 和 Cr）通过以下 `V4L2_YCBCR_ENC_SMPTE240M` 编码获得：

.. math::

    Y' = 0.2122R' + 0.7013G' + 0.0865B'

    Cb = -0.1161R' - 0.3839G' + 0.5B'

    Cr = 0.5R' - 0.4451G' - 0.0549B'

Y' 被限制在 [0…1] 范围内，Cb 和 Cr 被限制在 [-0.5…0.5] 范围内。Y'CbCr 的量化范围是有限的。

.. _col-sysm:

颜色空间 NTSC 1953（V4L2_COLORSPACE_470_SYSTEM_M）
===================================================

此标准定义了 1953 年 NTSC 使用的颜色空间。实际上，这个颜色空间已经过时，应使用 SMPTE 170M 替代。默认的传输函数是 `V4L2_XFER_FUNC_709`。默认的 Y'CbCr 编码是 `V4L2_YCBCR_ENC_601`。默认的 Y'CbCr 量化范围是有限范围。主要颜色和白点参考的色度如下：

.. flat-table:: NTSC 1953 色度
    :header-rows:  1
    :stub-columns: 0
    :widths:       1 1 2

    * - 颜色
      - x
      - y
    * - 红色
      - 0.67
      - 0.33
    * - 绿色
      - 0.21
      - 0.71
    * - 蓝色
      - 0.14
      - 0.08
    * - 白点参考（C）
      - 0.310
      - 0.316

.. note::

   此颜色空间使用 C 光源而不是 D65 作为白点参考。要正确地将此颜色空间中的图像转换为使用 D65 的另一种颜色空间，需要应用一种色适应算法，例如 Bradford 方法。
传输函数从未在NTSC 1953中被正确定义。文献中推荐使用Rec. 709的传输函数：

.. math::

    L' = 4.5L\text{, for } 0 \le L < 0.018

    L' = 1.099L ^{0.45} - 0.099\text{, for } 0.018 \le L \le 1

逆传输函数：

.. math::

    L = \frac{L'}{4.5} \text{, for } L' < 0.081

    L = \left( \frac{L' + 0.099}{1.099}\right) ^{\frac{1}{0.45} }\text{, for } L' \ge 0.081

亮度（Y'）和色差（Cb和Cr）通过以下“V4L2_YCBCR_ENC_601”编码获得：

.. math::

    Y' = 0.2990R' + 0.5870G' + 0.1140B'

    Cb = -0.1687R' - 0.3313G' + 0.5B'

    Cr = 0.5R' - 0.4187G' - 0.0813B'

Y' 被限定在 [0…1] 的范围内，而 Cb 和 Cr 被限定在 [-0.5…0.5] 的范围内。Y'CbCr量化是有限范围的。此变换与SMPTE 170M/BT.601定义的一致。

.. _col-sysbg:

色彩空间EBU Tech. 3213（V4L2_COLORSPACE_470_SYSTEM_BG）
=========================================================

:ref:`tech3213` 标准定义了1975年PAL/SECAM使用的色彩空间。请注意，该色彩空间不被HDMI接口支持。相反，:ref:`tech3321` 推荐在HDMI中使用Rec. 709。默认传输函数为 ``V4L2_XFER_FUNC_709``。默认Y'CbCr编码为 ``V4L2_YCBCR_ENC_601``。默认Y'CbCr量化为有限范围。主要颜色和白参考的色度如下：

.. flat-table:: EBU Tech. 3213 色度
    :header-rows:  1
    :stub-columns: 0
    :widths:       1 1 2

    * - 颜色
      - x
      - y
    * - 红色
      - 0.64
      - 0.33
    * - 绿色
      - 0.29
      - 0.60
    * - 蓝色
      - 0.15
      - 0.06
    * - 白参考 (D65)
      - 0.3127
      - 0.3290

该色彩空间的传输函数从未被正确定义。文献中推荐使用Rec. 709的传输函数：

.. math::

    L' = 4.5L\text{, for } 0 \le L < 0.018

    L' = 1.099L ^{0.45} - 0.099\text{, for } 0.018 \le L \le 1

逆传输函数：

.. math::

    L = \frac{L'}{4.5} \text{, for } L' < 0.081

    L = \left(\frac{L' + 0.099}{1.099} \right) ^{\frac{1}{0.45} }\text{, for } L' \ge 0.081

亮度（Y'）和色差（Cb和Cr）通过以下“V4L2_YCBCR_ENC_601”编码获得：

.. math::

    Y' = 0.2990R' + 0.5870G' + 0.1140B'

    Cb = -0.1687R' - 0.3313G' + 0.5B'

    Cr = 0.5R' - 0.4187G' - 0.0813B'

Y' 被限定在 [0…1] 的范围内，而 Cb 和 Cr 被限定在 [-0.5…0.5] 的范围内。Y'CbCr量化是有限范围的。此变换与SMPTE 170M/BT.601定义的一致。

.. _col-jpeg:

色彩空间JPEG（V4L2_COLORSPACE_JPEG）
======================================

此色彩空间定义了大多数(Motion-)JPEG格式所用的色彩空间。主要颜色和白参考的色度与sRGB相同。传输函数使用的是 ``V4L2_XFER_FUNC_SRGB``。Y'CbCr编码为 ``V4L2_YCBCR_ENC_601``，并采用全范围量化，其中Y'被缩放至[0…255]，而Cb/Cr被缩放至[-128…128]，然后裁剪到[-128…127]。

.. note::

   JPEG标准实际上并不存储色彩空间信息。因此，如果使用非sRGB色彩空间，则驱动程序必须显式设置这些信息。实际上，“V4L2_COLORSPACE_JPEG”可以被认为是“V4L2_COLORSPACE_SRGB”，“V4L2_XFER_FUNC_SRGB”，“V4L2_YCBCR_ENC_601”和“V4L2_QUANTIZATION_FULL_RANGE”的缩写。

传输函数详细描述
******************************

.. _xf-smpte-2084:

传输函数SMPTE 2084（V4L2_XFER_FUNC_SMPTE2084）
=======================================================

:ref:`smpte2084` 标准定义了高动态范围内容使用的传输函数。
常数：
    m1 = (2610 / 4096) / 4

    m2 = (2523 / 4096) * 128

    c1 = 3424 / 4096

    c2 = (2413 / 4096) * 32

    c3 = (2392 / 4096) * 32

传输函数：
    L' = ((c1 + c2 * L\ :sup:`m1`) / (1 + c3 * L\ :sup:`m1`))\ :sup:`m2`

逆传输函数：
    L = (max(L':sup:`1/m2` - c1, 0) / (c2 - c3 *
    L'\ :sup:`1/m2`))\ :sup:`1/m1`

在将此传输函数转换为非HDR传输函数时要小心：HDR内容的线性RGB值[0…1]映射到0到10000 cd/m\ :sup:`2` 的亮度范围，而非HDR（即标准动态范围或SDR）的线性RGB值映射到0到100 cd/m\ :sup:`2` 的亮度范围。
从SDR转换到HDR，你需要首先将L除以100。反之，你需要将L乘以100。当然，这种方法会将所有超过100 cd/m²的亮度值限制为100 cd/m²。
有更优秀的方法，详见 :ref:`colimg` 以获取更多关于这方面的深入信息。
