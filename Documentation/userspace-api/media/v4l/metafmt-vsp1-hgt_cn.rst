.. SPDX-License-Identifier: GFDL-1.1-no-invariants-or-later

.. _v4l2-meta-fmt-vsp1-hgt:

*******************************
V4L2_META_FMT_VSP1_HGT ('VSPT')
*******************************

Renesas R-Car VSP1 2-D 直方图数据

描述
===========

此格式描述了由 Renesas R-Car VSP1 2-D 直方图（HGT）引擎生成的直方图数据。
VSP1 HGT 是一个基于 HSV 数据进行操作的直方图计算引擎。它对可能被裁剪和下采样的输入图像进行处理，并计算 S 组件的总和、最大值和最小值，以及基于 H 和 S 组件的加权频率直方图。
直方图是一个包含 6 个色调桶和 32 个饱和度桶的矩阵，总共 192 个桶。每个 HSV 值会根据色调区域配置以 1 到 16 的权重添加到一个或多个桶中。查找相应的桶是通过独立检查 H 和 S 值完成的。

饱和度位置 **n** (0 - 31) 在矩阵中的位置由以下表达式确定：

    n = S / 8

色调位置 **m** (0 - 5) 在矩阵中的位置取决于 HGT 色调区域的配置。有 6 个用户可配置的色调区域，可以设置为覆盖重叠的色调值：

.. raw:: latex

    \small

::

         区域 0       区域 1       区域 2       区域 3       区域 4       区域 5
        ________     ________     ________     ________     ________     ________
   \   /|      |\   /|      |\   /|      |\   /|      |\   /|      |\   /|      |\   /
    \ / |      | \ / |      | \ / |      | \ / |      | \ / |      | \ / |      | \ /
     X  |      |  X  |      |  X  |      |  X  |      |  X  |      |  X  |      |  X
    / \ |      | / \ |      | / \ |      | / \ |      | / \ |      | / \ |      | / \
   /   \|      |/   \|      |/   \|      |/   \|      |/   \|      |/   \|      |/   \
  5U   0L      0U   1L      1U   2L      2U   3L      3U   4L      4U   5L      5U   0L
        <0..............................色调值............................255>

.. raw:: latex

    \normalsize

当两个连续区域不重叠时（n+1L 等于 nU），边界值被视为较低区域的一部分。
具有包含在某个区域中心（介于 nL 和 nU 之间，包括 nL 和 nU）的色调值的像素将归属于该单个区域，并赋予权重 16。具有位于两个区域重叠区域（介于 n+1L 和 nU 之间，不包括 nU）内的色调值的像素将归属于这两个区域，并根据其沿对角线的位置为每个区域分配权重（向下取整）。
色调区域设置必须符合以下约束之一：

::

    0L <= 0U <= 1L <= 1U <= 2L <= 2U <= 3L <= 3U <= 4L <= 4U <= 5L <= 5U

::

    0U <= 1L <= 1U <= 2L <= 2U <= 3L <= 3U <= 4L <= 4U <= 5L <= 5U <= 0L

**字节序。**
所有数据都以小端格式存储在内存中。表格中的每个单元格包含一个字节。

.. flat-table:: VSP1 HGT 数据 - (776 字节)
    :header-rows:  2
    :stub-columns: 0

    * - 偏移量
      - :cspan:`4` 内存
    * -
      - [31:24]
      - [23:16]
      - [15:8]
      - [7:0]
    * - 0
      - -
      - S 最大值 [7:0]
      - -
      - S 最小值 [7:0]
    * - 4
      - :cspan:`4` S 总和 [31:0]
    * - 8
      - :cspan:`4` 直方图桶 (m=0, n=0) [31:0]
    * - 12
      - :cspan:`4` 直方图桶 (m=0, n=1) [31:0]
    * -
      - :cspan:`4` ..
* - 132
      - :cspan:`4` 直方图桶 (m=0, n=31) [31:0]
    * - 136
      - :cspan:`4` 直方图桶 (m=1, n=0) [31:0]
    * -
      - :cspan:`4` ..
* - 264
      - :cspan:`4` 直方图桶 (m=2, n=0) [31:0]
    * -
      - :cspan:`4` ..
* - 392
      - :cspan:`4` 直方图桶 (m=3, n=0) [31:0]
    * -
      - :cspan:`4` ..
* - 520
      - :cspan:`4` 直方图桶 (m=4, n=0) [31:0]
    * -
      - :cspan:`4` ..
* - 648
      - :cspan:`4` 直方图桶 (m=5, n=0) [31:0]
    * -
      - :cspan:`4` ..
* - 772
      - :cspan:`4` 直方图桶 (m=5, n=31) [31:0]
