SPDX 许可证标识符: GFDL-1.1-no-invariants-or-later

*************
配置
*************

应用程序可以使用 :ref:`选择 API <VIDIOC_G_SELECTION>` 来选择视频信号或缓冲区中的一个区域，并查询默认设置和硬件限制。
视频硬件可能有各种裁剪、组合和缩放限制。它可能只能放大或缩小，只支持离散的缩放因子，或者在水平和垂直方向上有不同的缩放能力。同时，它可能根本不支持缩放。此外，裁剪/组合矩形可能需要对齐，源端和接收端都可能有任意的大小上限和下限。因此，如通常一样，驱动程序应调整请求的参数并返回实际选定的值。应用程序可以使用 :ref:`约束标志 <v4l2-selection-flags>` 控制舍入行为。

视频捕获的配置
==============================

参见图 :ref:`sel-targets-capture` 以了解视频捕获设备可用的选择目标示例。建议先配置裁剪目标再配置组合目标。
可以采样的区域的左上角坐标范围、宽度和高度由 ``V4L2_SEL_TGT_CROP_BOUNDS`` 目标给出。建议驱动程序开发者将左上角位置设为 ``(0,0)``。矩形的坐标以像素表示。
源矩形（即实际采样的区域）的左上角坐标、宽度和高度由 ``V4L2_SEL_TGT_CROP`` 目标给出。
它使用与 ``V4L2_SEL_TGT_CROP_BOUNDS`` 相同的坐标系统。活动裁剪区域必须完全位于捕获边界内。
驱动程序可以根据硬件限制进一步调整请求的大小和/或位置。
每个捕获设备都有一个默认的源矩形，由 ``V4L2_SEL_TGT_CROP_DEFAULT`` 目标给出。此矩形应覆盖驱动程序作者认为的完整画面。当驱动程序首次加载时，应将活动裁剪矩形设置为默认值，但之后不应更改。
组合目标指的是内存缓冲区。组合坐标的限制可以通过 ``V4L2_SEL_TGT_COMPOSE_BOUNDS`` 获得。所有坐标均以像素表示。矩形的左上角必须位于位置 ``(0,0)``。宽度和高度等于通过 :ref:`VIDIOC_S_FMT <VIDIOC_G_FMT>` 设置的图像大小。
硬件将图像插入缓冲区的部分由 `V4L2_SEL_TGT_COMPOSE` 目标控制。该矩形的坐标也以与边界矩形相同的坐标系统表示。组合矩形必须完全位于边界矩形内。驱动程序必须调整组合矩形以适应边界限制。此外，驱动程序可以根据硬件限制进行其他调整。应用程序可以使用 :ref:`约束标志 <v4l2-selection-flags>` 控制舍入行为。对于捕获设备，默认组合矩形通过 `V4L2_SEL_TGT_COMPOSE_DEFAULT` 查询。它通常等于边界矩形。

硬件修改缓冲区的部分由 `V4L2_SEL_TGT_COMPOSE_PADDED` 给出。它包含所有通过 `V4L2_SEL_TGT_COMPOSE` 定义的像素以及在插入过程中被硬件修改的所有填充数据。该矩形外的所有像素 *不得* 被硬件更改。位于填充区域但不在活动区域内的像素内容是未定义的。应用程序可以使用填充矩形和活动矩形来检测垃圾像素的位置，并在需要时移除它们。

视频输出配置
=============

对于输出设备，目标和 ioctl 的用法类似于视频捕获的情况。*组合* 矩形指的是将图像插入到视频信号中。裁剪矩形指的是内存缓冲区。建议先配置组合目标，然后再配置裁剪目标。

裁剪目标指的是包含要插入视频信号或图形屏幕的图像的内存缓冲区。裁剪坐标的限制可以通过 `V4L2_SEL_TGT_CROP_BOUNDS` 获取。所有坐标均以像素表示。左上角始终为点 `(0,0)`。宽度和高度等于通过 :ref:`VIDIOC_S_FMT <VIDIOC_G_FMT>` ioctl 指定的图像大小。

源矩形的左上角、宽度和高度，即硬件处理图像数据的区域，由 `V4L2_SEL_TGT_CROP` 给出。其坐标在同一坐标系统中表示。活动裁剪区域必须完全位于裁剪边界内，且驱动程序可能会根据硬件限制进一步调整请求的大小和/或位置。

对于输出设备，默认裁剪矩形通过 `V4L2_SEL_TGT_CROP_DEFAULT` 查询。它通常等于边界矩形。

硬件将图像插入视频信号或图形显示的部分由 `V4L2_SEL_TGT_COMPOSE` 目标控制。该矩形的坐标以像素表示。组合矩形必须完全位于边界矩形内。驱动程序必须调整该区域以适应边界限制。此外，驱动程序可以根据硬件限制进行其他调整。

设备有一个默认组合矩形，由 `V4L2_SEL_TGT_COMPOSE_DEFAULT` 目标给出。此矩形应覆盖驱动程序编写者认为的完整画面。建议驱动程序开发者将左上角设置在位置 `(0,0)`。
当驱动程序首次加载时，应将活动合成矩形设置为默认值。
设备可能会在视频信号中引入除内存缓冲区中的图像之外的其他内容。这包括图像周围的边框。然而，这种填充区域是与驱动程序相关的特性，并不在本文档的覆盖范围内。建议驱动程序开发者保持填充矩形与活动矩形相等。填充目标可以通过 `V4L2_SEL_TGT_COMPOSE_PADDED` 标识符访问。它必须包含来自 `V4L2_SEL_TGT_COMPOSE` 目标的全部像素。

缩放控制
=========

应用程序可以通过比较使用 `V4L2_SEL_TGT_CROP` 和 `V4L2_SEL_TGT_COMPOSE` 目标获取的矩形的宽度和高度来检测是否进行了缩放。如果这些值不相等，则表示应用了缩放。应用程序可以使用这些值计算缩放比例。
