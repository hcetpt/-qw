SPDX 许可证标识符: GFDL-1.1-no-invariants-or-later

.. _event:

***************
事件接口
***************

V4L2 事件接口为用户提供了一种立即通知设备上发生某些条件的手段。这可能包括帧开始或信号丢失事件等。V4L2 控制值或状态的变化也可以通过事件来报告。
要接收事件，用户首先需要使用 `VIDIOC_SUBSCRIBE_EVENT` ioctl 订阅感兴趣的事件。一旦订阅了某个事件，就可以使用 `VIDIOC_DQEVENT` ioctl 获取已订阅类型的事件。可以使用 `VIDIOC_UNSUBSCRIBE_EVENT` ioctl 取消订阅事件。特殊事件类型 V4L2_EVENT_ALL 可用于取消订阅驱动程序支持的所有事件。
事件订阅和事件队列是特定于文件句柄的。在一个文件句柄上订阅一个事件不会影响其他文件句柄。
通过在视频设备上使用 select 或 poll 系统调用来获取可获取的事件信息。V4L2 事件在 poll 系统调用中使用 POLLPRI 事件，在 select 系统调用中使用异常事件。
从内核 3.1 版本开始，关于事件提供了一些保证：

1. 每个已订阅的事件都有自己的内部专用事件队列。这意味着一种事件类型的泛滥不会干扰其他事件类型。
2. 如果某个已订阅事件的内部事件队列满了，则该队列中的最旧事件将被丢弃。
3. 在适用的情况下，某些事件类型可以确保即将被丢弃的最旧事件的有效载荷将与下一个最旧事件的有效载荷合并。这样可以确保没有信息丢失，而只是丢失了一个导致该信息的中间步骤。请查阅您想要订阅的事件文档以了解该事件是否适用。
