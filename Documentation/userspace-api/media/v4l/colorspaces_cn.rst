SPDX 许可证标识符：GFDL-1.1-no-invariants-or-later

.. _色彩空间:

***********
色彩空间
***********

“颜色”是一个非常复杂的概念，它依赖于物理学、化学和生物学。仅仅因为你有三个数字来描述像素颜色的“红”、“绿”和“蓝”成分，并不意味着你可以准确地显示该颜色。一个色彩空间定义了具有某个 RGB 值（例如 (255, 0, 0)）的实际意义，即在一个完全校准的环境中屏幕上应该重现哪种颜色。

为了做到这一点，我们首先需要对颜色有一个良好的定义，即某种方式来唯一且明确地定义一种颜色，以便其他人可以重现它。人类的色觉是三原色的，因为人眼中有三种不同波长光的感受器。因此需要使用三个数字来描述颜色。如果你是一只螳螂虾，那你就惨了，因为它们对 12 种不同的波长敏感，所以我们不是用 RGB 色彩空间，而是用 ABCDEFGHIJKL 色彩空间。

颜色仅存在于眼睛和大脑中，是色感受器受刺激强度的结果。这基于光谱功率分布（SPD），它是进入眼睛的可见光谱范围内光的强度（辐射功率）图。色度学研究的是 SPD 和人类大脑感知颜色之间的关系。

由于人眼只有三种色感受器，完全有可能不同的 SPD 会以相同的方式刺激这些感受器并被感知为相同的颜色，即使光的 SPD 是不同的。

在 20 世纪 20 年代，设计了一些实验来确定 SPD 与感知颜色之间的关系，从而产生了定义光谱加权函数的 CIE 1931 标准，这些函数模拟了颜色的感知。具体来说，该标准定义了可以从 SPD 计算每个色感受器刺激值的函数。

经过一些进一步的数学变换，这些刺激值被称为 *CIE XYZ 三刺激值*，这些 X、Y 和 Z 值描述了一种人类感知的颜色，且这种描述是明确无误的。这些 X、Y 和 Z 值都在 [0…1] 的范围内。

在 CIE XYZ 色彩空间中，Y 值对应于亮度。通常，CIE XYZ 色彩空间会被转换为归一化的 CIE xyY 色彩空间：

	x = X / (X + Y + Z)

	y = Y / (X + Y + Z)

x 和 y 值是色度坐标，可以用来定义一种颜色而不包括亮度分量 Y。这些色彩空间名称如此相似可能会让人感到困惑。请注意，如果颜色是以小写的 'x' 和 'y' 指定的，则使用的是 CIE xyY 色彩空间。大写的 'X' 和 'Y' 指的是 CIE XYZ 色彩空间。此外，y 与亮度无关。一起，x 和 y 指定了颜色，而 Y 表示亮度。从实际应用的角度来看，你只需要记住这一点。本节末尾有一些推荐阅读资源，如果你感兴趣的话可以深入了解。

显示器或电视通过发射三种不同波长的光来重现颜色，这些光的组合会刺激眼睛中的色感受器，从而导致颜色的感知。

历史上，这些波长是由显示屏上使用的红色、绿色和蓝色荧光粉定义的。这些 *基色* 是定义色彩空间的一部分。

不同的显示设备会有不同的基色，某些基色更适合某些显示技术。
这导致了多种色彩空间的出现，它们用于不同的显示技术和用途。定义一个色彩空间需要定义三个色彩基色（通常以CIE xyY色彩空间中的x、y色度坐标来定义），还需要定义白色参考：即当三个基色都达到最大功率时得到的颜色。这确定了基色之间的相对功率或能量。通常选择接近自然光的颜色作为白色参考，这种颜色被定义为CIE D65光源。

总结一下：CIE XYZ色彩空间可以唯一地标识颜色。
其他色彩空间由在CIE xyY色彩空间中定义的三个色度坐标来定义。基于这些坐标，可以构建一个3x3矩阵，将CIE XYZ颜色转换为新色彩空间中的颜色。

CIE XYZ色彩空间和从特定色度基色派生出的RGB色彩空间都是线性色彩空间。但是，人眼和显示技术都不是线性的。在线性色彩空间中将所有分量值加倍，并不会被视为颜色强度加倍。因此，每个色彩空间还定义了一个传输函数，它将线性色彩分量值转换为非线性分量值，这样更接近人眼和显示器的非线性表现。线性分量值表示为RGB，非线性分量值表示为R'G'B'。一般情况下，图形中使用的颜色都是R'G'B'，除了OpenGL使用线性RGB。处理OpenGL时需要注意提供线性RGB颜色，或者使用内置的OpenGL支持来应用逆传输函数。

定义一个色彩空间的最后一部分是一个函数，该函数将非线性R'G'B'转换为非线性Y'CbCr。这个函数由所谓的亮度系数决定。同一个色彩空间可能允许多个Y'CbCr编码。许多颜色编码偏好使用亮度（Y'）和色度（CbCr）而不是R'G'B'。由于人眼对亮度差异比对颜色差异更敏感，这种编码允许减少与亮度数据相比的颜色信息量。需要注意的是，亮度（Y'）与CIE XYZ色彩空间中的Y无关。另外，Y'CbCr通常被称为YCbCr或YUV，尽管严格来说这是不正确的。

有时人们会把Y'CbCr误解为一种色彩空间。这是不正确的，它只是将R'G'B'颜色编码为亮度和色度值的一种方式。与R'G'B'颜色相关联的基本色彩空间也与Y'CbCr颜色相关联。

最后一步是如何量化RGB、R'G'B'或Y'CbCr值。
CIE XYZ色彩空间中X、Y和Z的范围是[0…1]，描述了人类能感知的所有颜色，但转换到另一个色彩空间会产生超出[0…1]范围的颜色。一旦将这些颜色限制在[0…1]范围内，就无法再用该色彩空间重现这些颜色。这种限制减少了色彩空间的范围或色域。如何将[0…1]范围转换为[0…255]（或更高，取决于色彩深度）的整数值称为量化。这不是色彩空间定义的一部分。实际上，RGB或R'G'B'值是全范围的，即使用[0…255]的全部范围。而Y'CbCr值则是有限范围的，其中Y'使用[16…235]，Cb和Cr使用[16…240]。

不幸的是，在某些情况下也会使用有限范围的RGB，其中各分量使用[16…235]范围。同样也存在全范围的Y'CbCr，使用[0…255]范围。

为了正确解释一个颜色，你需要知道量化范围，无论是R'G'B'还是Y'CbCr，所使用的Y'CbCr编码以及色彩空间。根据这些信息，你可以计算出相应的CIE XYZ颜色，并将其映射到你的显示设备所使用的色彩空间。
颜色空间的定义包括三个色度基色、白点参考色度、一个传输函数以及将 R'G'B' 转换为 Y'CbCr 所需的亮度系数。虽然有些颜色空间标准正确地定义了这四个要素，但很多时候颜色空间标准只定义了一部分，你需要依赖其他标准来补充缺失的部分。由于颜色空间通常是不同标准的混合体，这也导致了命名约定非常混乱，即用某个标准的名字来命名一个颜色空间，而实际上该标准也是其他多个颜色空间的一部分。

如果你想了解更多关于颜色和颜色空间的信息，以下资源非常有用：:ref:`poynton` 是一本适合视频工程师的实际操作书籍，:ref:`colimg` 涵盖范围更广，描述了许多与颜色相关的方面（物理、化学、生物学等）。`http://www.brucelindbloom.com <http://www.brucelindbloom.com>`__ 网站是一个非常好的资源，尤其是在颜色空间转换背后的数学原理方面。维基百科的 `CIE 1931 颜色空间 <http://en.wikipedia.org/wiki/CIE_1931_color_space#CIE_xy_chromaticity_diagram_and_the_CIE_xyY_color_space>`__ 文章也非常有用。
