=======================
ALSA SoC 层概述
=======================

ALSA 系统级芯片（ASoC）层的整体项目目标是为嵌入式系统级芯片处理器（例如 pxa2xx、au1x00、iMX 等）和便携式音频编解码器提供更好的 ALSA 支持。在引入 ASoC 子系统之前，内核中已经有一些针对 SoC 音频的支持，但存在一些局限性：

  * 编解码器驱动程序通常与底层的 SoC CPU 紧密耦合。这并不理想，并且会导致代码重复——例如，Linux 在四个不同的 SoC 平台上分别有不同版本的 wm8731 驱动程序。
  * 没有一个标准的方法来指示用户触发的音频事件（例如耳机/麦克风插入、插入后的检测等）。这些事件在便携设备上很常见，并且经常需要特定于设备的代码来重新路由音频、启用放大器等。
  * 驱动程序在播放或录音时倾向于启动整个编解码器。对于台式机来说这还可以接受，但在便携设备上会浪费大量电力。此外，也没有通过改变编解码器过采样率、偏置电流等方式节省电力的支持。

ASoC 设计
=========

ASoC 层的设计旨在解决这些问题并提供以下功能：

  * 编解码器独立性。允许在其他平台和机器上重用编解码器驱动程序。
  * 简化 I2S/PCM 音频接口在编解码器和 SoC 之间的设置。每个 SoC 接口和编解码器都会向核心注册其音频接口能力，并在应用程序硬件参数已知的情况下进行匹配和配置。
  * 动态音频电源管理（DAPM）。DAPM 始终自动将编解码器设置为其最低功耗状态。这包括根据内部编解码器音频路由和任何活动流来开启或关闭内部电源模块。
  * 减少咔哒声和爆破声。通过以正确的顺序开启或关闭编解码器（包括使用数字静音）可以减少咔哒声和爆破声。ASoC 会在适当的时候通知编解码器更改电源状态。
  * 机器特定控制：允许机器向声卡添加控制（例如扬声器放大器的音量控制）。
为了实现这一切，ASoC（Audio System on Chip）基本上将嵌入式音频系统拆分成多个可重用的组件驱动程序：

  * 编解码器类驱动程序：编解码器类驱动程序与平台无关，并包含音频控制、音频接口功能、编解码器 DAPM（动态电源管理）定义以及编解码器 IO 函数。如果需要，此类还可以扩展到蓝牙（BT）、调频（FM）和调制解调器（MODEM）IC。编解码器类驱动程序应该是可以在任何架构和机器上运行的通用代码。
  * 平台类驱动程序：平台类驱动程序包括音频 DMA 引擎驱动程序、数字音频接口（DAI）驱动程序（例如 I2S、AC97、PCM）以及该平台的任何音频 DSP 驱动程序。
  * 机器类驱动程序：机器类驱动程序作为胶水，描述并绑定其他组件驱动程序，以形成一个 ALSA “声卡设备”。它处理任何特定于机器的控制和机器级别的音频事件（例如，在开始播放时打开放大器）。
