软件接口 ALSA-DSP MADI 驱动程序
=======================================

（从德语翻译，所以英语可能不太好；）

2004 - Winfried Ritsch

已向驱动程序添加了全部功能。由于某些控件和启动选项是 ALSA 标准的，因此下面仅描述和讨论特殊控件。
硬件功能
======================

音频传输
------------------

* 通道数 -- 取决于传输模式

    所选通道数为 1..Nmax。使用较少通道的原因仅仅是资源分配，因为未使用的 DMA 通道将被禁用且分配较少的内存。这样也可以调整 PCI 系统的吞吐量。（仅对低性能板卡重要）
* 单速 -- 1..64 通道 

.. note::
    （注意：选择 56 通道模式进行传输或接收时，只有 56 个通道通过 MADI 传输/接收，但所有 64 个通道都可用于混音器，因此驱动程序中的通道数为 64）

* 双速 -- 1..32 通道

.. note::
    注意：选择 56 通道模式进行传输/接收时，只有 28 个通道通过 MADI 传输/接收，但所有 32 个通道都可用于混音器，因此驱动程序中的通道数为 32

* 四速 -- 1..16 通道 

.. note::
    选择 56 通道模式进行传输/接收时，只有 14 个通道通过 MADI 传输/接收，但所有 16 个通道都可用于混音器，因此驱动程序中的通道数为 16

* 格式 -- 32 位小端字节序带符号整数 (SNDRV_PCM_FMTBIT_S32_LE)

* 采样率 --

    单速 -- 32000, 44100, 48000

    双速 -- 64000, 88200, 96000（未经测试）

    四速 -- 128000, 176400, 192000（未经测试）

* 访问模式 -- MMAP（内存映射），非交错（PCM_NON-INTERLEAVED）

* 缓冲区大小 -- 64, 128, 256, 512, 1024, 2048, 8192 个样本

* 分片 -- 2

* 硬件指针 -- 2 种模式

    该卡支持读取当前缓冲区指针，DMA 在此处读写。由于 PCI 的批量模式，其精度仅为 64 字节。因此它不适用于 ALSA 中级函数（这里缓冲区 ID 提供更好的结果），但如果应用程序使用 MMAP，则可以配置。因此可以在加载时通过参数 precise-pointer 进行配置。
.. hint::
    （提示：实验发现指针最大偏差 64，从不大于 64。因此如果你减去 64，总是有一个安全的写入指针，在这种模式下 ALSA 内部使用。理论上你现在可以获得低至 16 个样本的延迟，这是中断可能性的四分之一。）

    * 精确指针 -- 关闭
                使用中断进行指针计算
                
    * 精确指针 -- 打开
                使用硬件指针
控制器
----------

由于 DSP-MADI 混音器具有 8152 个推子，因此使用标准混音器控件是没有意义的，因为这会破坏大多数（尤其是图形）ALSA 混音器 GUI。因此混音控制通过使用 hwdep 接口的二维控制器提供。

此外，所有 128+256 峰值和 RMS 表也可以通过 hwdep 接口访问。由于即使只需要一个峰值和 RMS 水平时，始终复制和转换它们可能会成为性能问题，我决定导出硬件结构，以便在需要时一些驱动高手可以实现混音器或峰值表的内存映射，或者只复制而不转换。一个测试应用程序展示了控制器的使用方法。
* 延迟控制 --- 未实现！！！

.. note::
    注意：在 Windows 驱动程序中，延迟可通过控制面板访问，但缓冲区大小由 ALSA 通过 hwparams 调用控制，并且不应在运行时更改，因此我没有在这里实现它。
* 系统时钟 -- 暂停！！！

  * 名称 -- "系统时钟模式"

  * 访问 -- 读写
    
  * 值 -- "主" "从"

.. note::
    ！！！这是一个硬件功能，但与时钟源控制器冲突，后者是一种 ALSA 标准。设置卡到特定模式（在某个频率下的主模式或从模式）是有意义的，因为即使不使用音频应用，工作室也应有正常工作的同步设置。因此请改用时钟源控制器！！！

* 时钟源  

  * 名称 -- "采样时钟源"

  * 访问 -- 读写

  * 值 -- "自动同步" "内部 32.0 kHz", "内部 44.1 kHz", "内部 48.0 kHz", "内部 64.0 kHz", "内部 88.2 kHz", "内部 96.0 kHz"

        可以选择在特定频率下的主模式以及速度模式或从模式（自动同步）。另见“首选同步参考”。

.. warning::
    ！！！这不是纯粹的硬件功能，但之前某些 ALSA 驱动程序实现了这一功能，因此我也使用它。！！！

* 首选同步参考

  * 名称 -- "首选同步参考"

  * 访问 -- 读写

  * 值 -- "字时钟" "MADI"

        在自动同步模式下可以选择首选同步源。如果不可用，则尽可能使用其他源。

.. note::
    注意：由于 MADI 的比特率远高于字时钟，因此卡应该在 MADI 模式下更好地同步。但由于 RME PLL 非常好，使用字时钟几乎没有问题。我从未发现两者之间有任何区别。
* TX 64 通道

  * 名称 -- "TX 64 通道模式"

  * 访问 -- 读写

  * 值 -- 0 1

        使用 64 通道模式（1）或 56 通道模式进行 MADI 传输（0）

.. note::
    注意：此控件仅用于输出。输入模式将根据硬件发送的 MADI 自动检测。
* 清晰TMS

  * 名称 -- “清晰轨道标记”

  * 访问 -- 读写

  * 值 -- 0 1

		 不要将AES上的下5个音频位作为额外位使用

* 安全模式或自动输入

  * 名称 -- “安全模式”

  * 访问 -- 读写

  * 值 -- 0 1（默认开启）

		 如果开启（1），则如果光纤或同轴连接出现故障，会切换到正常工作的连接，并且不会出现采样失败。只有在您将第二个用作备用连接时才有用

* 输入选择

  * 名称 -- “输入选择”

  * 访问 -- 读写

  * 值 -- 光纤 同轴

		 选择输入，光纤或同轴。如果安全模式处于活动状态，则这是首选输入

混合器
------

* 混合器

  * 名称 -- “混合器”

  * 访问 -- 读写

  * 值 - <通道编号 0-127> <值 0-65535>

		 这里首先取通道索引作为第一值来获取/设置相应的混合器通道，其中0-63是输入到输出的推子，64-127是播放到输出的推子。值0表示通道静音，0和32768表示放大1倍

* 通道1-64

       用于ALSA混合器工具的快速混合器。混合矩阵的对角线从播放到输出实现

* 线路输出

  * 名称 -- “线路输出”

  * 访问 -- 读写

  * 值 -- 0 1

		 开启和关闭模拟输出，这与混音或路由无关。模拟输出反映的是通道63、64

信息（只读访问）
-------------------

* 采样率

  * 名称 -- “系统采样率”

  * 访问 -- 只读

		 获取采样率

* 外部测量率

  * 名称 -- “外部速率”

  * 访问 -- 只读

		 应该是“自动同步速率”，但使用的名称是ALSA方案。报告的外部采样频率与自动同步中使用的频率一致

* MADI同步状态

  * 名称 -- “MADI同步锁定状态”

  * 访问 -- 读

  * 值 -- 0,1,2

       MADI输入为 0=未锁定，1=已锁定，或2=已同步

* 字时钟同步状态

  * 名称 -- “字时钟锁定状态”

  * 访问 -- 读

  * 值 -- 0,1,2

       字时钟输入为 0=未锁定，1=已锁定，或2=已同步
* AutoSync

  * 名称 -- "AutoSync 参考"

  * 访问 -- 只读

  * 值 -- "WordClock", "MADI", "无"

		 同步参考可以是 "WordClock"、"MADI" 或者无
* RX 64ch --- 尚未实现

       MADI 接收器处于 64 通道模式或 56 通道模式
* AB_inp   --- 未经测试 

		 用于自动输入的输入端口
* 当前缓冲区位置 --- 尚未实现

	   !!! 这是一个 ALSA 内部功能，因此不使用任何控制 !!!

调用参数
========

* index int 数组（最小值 = 1，最大值 = 8）

     RME HDSPM 接口的索引值。ALSA 中的卡索引

     注意：符合 ALSA 标准
* id 字符串数组（最小值 = 1，最大值 = 8）

     RME HDSPM 接口的 ID 字符串
注意：符合 ALSA 标准
* enable int 数组（最小值 = 1，最大值 = 8）

     启用或禁用特定的 HDSPM 声卡
注意：符合 ALSA 标准
* precise_ptr int 数组（最小值 = 1，最大值 = 8）

     启用精确指针或禁用
.. 注意::
     注意：仅在应用程序支持此功能时使用（这是一个特殊情况）
* line_outs_monitor int 数组（最小值 = 1，最大值 = 8）

     默认将播放流发送到模拟输出
.. 注意::
	  注意：每个播放通道默认混合到相同编号的输出通道（路由）。这与 ALSA 规范相反，后者要求加载驱动程序后必须静音所有通道，但在其他卡上之前是这样使用的，因此历史地再次使用这种方法

* enable_monitor int 数组（最小值 = 1，最大值 = 8）

     默认启用第 63/64 通道的模拟输出
.. 注意 ::
      注意：这里启用了模拟输出（但未进行路由）
当然，请提供您需要翻译的文本。
