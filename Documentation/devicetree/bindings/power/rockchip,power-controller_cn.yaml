# SPDX-许可证标识符: GPL-2.0
%YAML 1.2
---
$id: http://devicetree.org/schemas/power/rockchip,power-controller.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: Rockchip 电源域

维护者:
  - 张庆 <zhangqing@rock-chips.com>
  - Heiko Stuebner <heiko@sntech.de>

描述: |
  Rockchip 处理器包括对多个电源域的支持，这些电源域可以根据不同的应用场景由软件进行上电/下电操作以节省电力。
  在 power-controller 节点内包含的电源域是通用电源域提供者，详细信息记录在
  文档/devicetree/bindings/power/power-domain.yaml 中。
属于某个电源域的 IP 核应该包含一个名为 "power-domains" 的属性，该属性是指向表示该域的电源域节点的句柄。
属性:
  $nodename:
    常量: power-controller

  compatible:
    枚举:
      - rockchip,px30-power-controller
      - rockchip,rk3036-power-controller
      - rockchip,rk3066-power-controller
      - rockchip,rk3128-power-controller
      - rockchip,rk3188-power-controller
      - rockchip,rk3228-power-controller
      - rockchip,rk3288-power-controller
      - rockchip,rk3328-power-controller
      - rockchip,rk3366-power-controller
      - rockchip,rk3368-power-controller
      - rockchip,rk3399-power-controller
      - rockchip,rk3568-power-controller
      - rockchip,rk3588-power-controller
      - rockchip,rv1126-power-controller

  "#power-domain-cells":
    常量: 1

  "#address-cells":
    常量: 1

  "#size-cells":
    常量: 0

必需:
  - compatible
  - "#power-domain-cells"

其他属性: false

模式属性:
  "^power-domain@[0-9a-f]+$":

    $引用: "#/$defs/pd-node"

    未评估属性: false

    属性:
      "#address-cells":
        常量: 1

      "#size-cells":
        常量: 0

    模式属性:
      "^power-domain@[0-9a-f]+$":

        $引用: "#/$defs/pd-node"

        未评估属性: false

        属性:
          "#address-cells":
            常量: 1

          "#size-cells":
            常量: 0

        模式属性:
          "^power-domain@[0-9a-f]+$":

            $引用: "#/$defs/pd-node"

            未评估属性: false

            属性:
              "#power-domain-cells":
                常量: 0

$defs:
  pd-node:
    类型: 对象
    描述: |
      表示 power 控制器节点内的电源域
属性:
      reg:
        最大项目数: 1
        描述: |
          电源域索引。有效值定义在
          "include/dt-bindings/power/px30-power.h"
          "include/dt-bindings/power/rk3036-power.h"
          "include/dt-bindings/power/rk3066-power.h"
          "include/dt-bindings/power/rk3128-power.h"
          "include/dt-bindings/power/rk3188-power.h"
          "include/dt-bindings/power/rk3228-power.h"
          "include/dt-bindings/power/rk3288-power.h"
          "include/dt-bindings/power/rk3328-power.h"
          "include/dt-bindings/power/rk3366-power.h"
          "include/dt-bindings/power/rk3368-power.h"
          "include/dt-bindings/power/rk3399-power.h"
          "include/dt-bindings/power/rk3568-power.h"
          "include/dt-bindings/power/rk3588-power.h"
          "include/dt-bindings/power/rockchip,rv1126-power.h"

      clocks:
        最小项目数: 1
        最大项目数: 30
        描述: |
          需要在电源域状态切换时启用的一组时钟句柄
pm_qos:
        $引用: /schemas/types.yaml#/definitions/phandle-array
        项目:
          最大项目数: 1
        描述: |
          需要在电源域状态切换时保存和恢复的一组 QoS 块句柄
"#power-domain-cells":
        枚举: [0, 1]
        描述:
          对于代表单个 PM 域的节点必须为 0，对于提供多个 PM 域的节点必须为 1
必需:
      - reg
      - "#power-domain-cells"

示例:
  - |
    #include <dt-bindings/clock/rk3399-cru.h>
    #include <dt-bindings/power/rk3399-power.h>

    soc {
        #address-cells = <2>;
        #size-cells = <2>;

        qos_hdcp: qos@ffa90000 {
            compatible = "rockchip,rk3399-qos", "syscon";
            reg = <0x0 0xffa90000 0x0 0x20>;
        };

        qos_iep: qos@ffa98000 {
            compatible = "rockchip,rk3399-qos", "syscon";
            reg = <0x0 0xffa98000 0x0 0x20>;
        };

        qos_rga_r: qos@ffab0000 {
            compatible = "rockchip,rk3399-qos", "syscon";
            reg = <0x0 0xffab0000 0x0 0x20>;
        };

        qos_rga_w: qos@ffab0080 {
            compatible = "rockchip,rk3399-qos", "syscon";
            reg = <0x0 0xffab0080 0x0 0x20>;
        };

        qos_video_m0: qos@ffab8000 {
            compatible = "rockchip,rk3399-qos", "syscon";
            reg = <0x0 0xffab8000 0x0 0x20>;
        };

        qos_video_m1_r: qos@ffac0000 {
            compatible = "rockchip,rk3399-qos", "syscon";
            reg = <0x0 0xffac0000 0x0 0x20>;
        };

        qos_video_m1_w: qos@ffac0080 {
            compatible = "rockchip,rk3399-qos", "syscon";
            reg = <0x0 0xffac0080 0x0 0x20>;
        };

        power-management@ff310000 {
            compatible = "rockchip,rk3399-pmu", "syscon", "simple-mfd";
            reg = <0x0 0xff310000 0x0 0x1000>;

            power-controller {
                compatible = "rockchip,rk3399-power-controller";
                #power-domain-cells = <1>;
                #address-cells = <1>;
                #size-cells = <0>;

                /* 这些电源域按 VD_CENTER 分组 */
                power-domain@RK3399_PD_IEP {
                    reg = <RK3399_PD_IEP>;
                    clocks = <&cru ACLK_IEP>,
                             <&cru HCLK_IEP>;
                    pm_qos = <&qos_iep>;
                    #power-domain-cells = <0>;
                };
                power-domain@RK3399_PD_RGA {
                    reg = <RK3399_PD_RGA>;
                    clocks = <&cru ACLK_RGA>,
                             <&cru HCLK_RGA>;
                    pm_qos = <&qos_rga_r>,
                             <&qos_rga_w>;
                    #power-domain-cells = <0>;
                };
                power-domain@RK3399_PD_VCODEC {
                    reg = <RK3399_PD_VCODEC>;
                    clocks = <&cru ACLK_VCODEC>,
                             <&cru HCLK_VCODEC>;
                    pm_qos = <&qos_video_m0>;
                    #power-domain-cells = <0>;
                };
                power-domain@RK3399_PD_VDU {
                    reg = <RK3399_PD_VDU>;
                    clocks = <&cru ACLK_VDU>,
                             <&cru HCLK_VDU>;
                    pm_qos = <&qos_video_m1_r>,
                             <&qos_video_m1_w>;
                    #power-domain-cells = <0>;
                };
                power-domain@RK3399_PD_VIO {
                    reg = <RK3399_PD_VIO>;
                    #power-domain-cells = <1>;
                    #address-cells = <1>;
                    #size-cells = <0>;

                    power-domain@RK3399_PD_HDCP {
                        reg = <RK3399_PD_HDCP>;
                        clocks = <&cru ACLK_HDCP>,
                                 <&cru HCLK_HDCP>,
                                 <&cru PCLK_HDCP>;
                        pm_qos = <&qos_hdcp>;
                        #power-domain-cells = <0>;
                    };
                };
            };
        };
    };
