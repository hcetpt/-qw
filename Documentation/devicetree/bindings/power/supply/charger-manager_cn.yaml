# SPDX-许可证标识符: GPL-2.0
%YAML 1.2
---
$id: http://devicetree.org/schemas/power/supply/charger-manager.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: 充电器管理器

维护者:
  - Sebastian Reichel <sre@kernel.org>

描述: |
  针对传统充电器管理驱动程序的绑定
请勿在新产品中使用
属性:
  compatible:
    常量: charger-manager

  cm-chargers:
    描述: 充电器名称
    $ref: /schemas/types.yaml#/definitions/string-array

  cm-num-chargers:
    $ref: /schemas/types.yaml#/definitions/uint32
    过时: true

  cm-fuel-gauge:
    描述: 电池电量计名称
    $ref: /schemas/types.yaml#/definitions/string

  cm-name:
    描述: 充电器管理器名称
    默认: battery
    $ref: /schemas/types.yaml#/definitions/string

  cm-poll-mode:
    描述: 轮询模式
    $ref: /schemas/types.yaml#/definitions/uint32
    默认: 0
    枚举:
      - 0 # 禁用
      - 1 # 总是
      - 2 # 当外部电源连接时
      - 3 # 在充电时

  cm-poll-interval:
    描述: 轮询间隔（以毫秒为单位）
    $ref: /schemas/types.yaml#/definitions/uint32

  cm-battery-stat:
    描述: 电池状态
    $ref: /schemas/types.yaml#/definitions/uint32
    枚举:
      - 0 # 电池始终存在
      - 1 # 没有电池
      - 2 # 通过电量计检查存在
      - 3 # 通过充电器检查存在

  cm-fullbatt-vchkdrop-volt:
    描述: 在重启充电前电压下降值（以微伏为单位）
    $ref: /schemas/types.yaml#/definitions/uint32

  cm-fullbatt-vchkdrop-ms:
    过时: true

  cm-fullbatt-voltage:
    描述: 满电电池电压（以微伏为单位）
    $ref: /schemas/types.yaml#/definitions/uint32

  cm-fullbatt-soc:
    描述: 视为满电电池的荷电状态百分比
    $ref: /schemas/types.yaml#/definitions/uint32

  cm-fullbatt-capacity:
    描述: 视为满电电池的容量（以微安时为单位）
    $ref: /schemas/types.yaml#/definitions/uint32

  cm-thermal-zone:
    描述: 外部温度计的热区名称
    $ref: /schemas/types.yaml#/definitions/string

  cm-discharging-max:
    描述: 放电持续时间限制（以毫秒为单位）
    $ref: /schemas/types.yaml#/definitions/uint32

  cm-charging-max:
    描述: 充电持续时间限制（以毫秒为单位）
    $ref: /schemas/types.yaml#/definitions/uint32

  cm-battery-cold:
    描述: 充电时电池临界低温（以十分之一摄氏度为单位）
    $ref: /schemas/types.yaml#/definitions/uint32

  cm-battery-cold-in-minus:
    描述: 如果设置，则cm-battery-cold温度是在零下
    类型: 布尔值

  cm-battery-hot:
    描述: 充电时电池临界高温（以十分之一摄氏度为单位）
    $ref: /schemas/types.yaml#/definitions/uint32

  cm-battery-temp-diff:
    描述: 允许重新充电的温差（以十分之一摄氏度为单位）
    $ref: /schemas/types.yaml#/definitions/uint32

模式属性:
  "-supply$":
    描述: 根据cm-regulator-name命名的稳压器消费者
    $ref: /schemas/types.yaml#/definitions/phandle

  "^regulator[@-][0-9]$":
    类型: 对象
    属性:
      cm-regulator-name:
        描述: 充电器稳压器名称
        $ref: /schemas/types.yaml#/definitions/string

    必需:
      - cm-regulator-name

    额外属性: false

    模式属性:
      "^cable[@-][0-9]$":
        类型: 对象
        属性:
          cm-cable-name:
            描述: 充电器电缆名称
            枚举:
              - USB
              - USB-HOST
              - SDP
              - DCP
              - CDP
              - ACA
              - FAST-CHARGER
              - SLOW-CHARGER
              - WPT
              - PD
              - DOCK
              - JIG
              - MECHANICAL

          cm-cable-extcon:
            描述: extcon设备名称
            $ref: /schemas/types.yaml#/definitions/string

          cm-cable-min:
            描述: 电缆最小电流（以微安为单位）
            $ref: /schemas/types.yaml#/definitions/uint32

          cm-cable-max:
            描述: 电缆最大电流（以微安为单位）
            $ref: /schemas/types.yaml#/definitions/uint32

        必需:
          - cm-cable-name
          - cm-cable-extcon

        额外属性: false

必需:
  - compatible
  - cm-chargers
  - cm-fuel-gauge

额外属性: false

示例:
  - |
    charger-manager {
        compatible = "charger-manager";
        chg-reg-supply = <&charger_regulator>;

        cm-name = "battery";
        /* 始终开启轮询：30秒 */
        cm-poll-mode = <1>;
        cm-poll-interval = <30000>;

        cm-fullbatt-vchkdrop-volt = <150000>;
        cm-fullbatt-soc = <100>;

        cm-battery-stat = <3>;

        cm-chargers = "charger0", "charger1", "charger2";

        cm-fuel-gauge = "fuelgauge0";

        cm-thermal-zone = "thermal_zone.1";
        /* 十分之一摄氏度 */
        cm-battery-cold = <50>;
        cm-battery-cold-in-minus;
        cm-battery-hot = <800>;
        cm-battery-temp-diff = <100>;

        /* 允许充电5小时 */
        cm-charging-max = <18000000>;
        /* 允许放电2小时 */
        cm-discharging-max = <7200000>;

        regulator-0 {
            cm-regulator-name = "chg-reg";
            cable-0 {
                cm-cable-name = "USB";
                cm-cable-extcon = "extcon-dev.0";
                cm-cable-min = <475000>;
                cm-cable-max = <500000>;
            };
            cable-1 {
                cm-cable-name = "SDP";
                cm-cable-extcon = "extcon-dev.0";
                cm-cable-min = <650000>;
                cm-cable-max = <675000>;
            };
        };
    };
