# SPDX-许可证标识符: GPL-2.0
%YAML 1.2
---
$id: http://devicetree.org/schemas/power/supply/gpio-charger.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: 仅通过 GPIO 进行通信的简易电池充电器

维护者:
  - Sebastian Reichel <sre@kernel.org>

描述:
  此绑定适用于所有以或多或少自主方式工作的充电器，它们仅提供一些状态 GPIO，并可能提供一些用于限制充电过程控制的 GPIO。

属性:
  compatible:
    常量: gpio-charger

  charger-type:
    枚举:
      - 未知
      - 电池
      - 不间断电源(UPS)
      - 主电源
      - usb-sdp                   # USB 标准下游端口
      - usb-dcp                   # USB 专用充电端口
      - usb-cdp                   # USB 充电下游端口
      - usb-aca                   # USB 配件充电适配器
    描述:
      充电器类型，例如“主电源”代表墙壁充电器

gpios:
    最大项数: 1
    描述: 表示充电器存在的 GPIO

  charge-status-gpios:
    最大项数: 1
    描述: 表示充电状态的 GPIO

  charge-current-limit-gpios:
    最小项数: 1
    最大项数: 32
    描述: 用于电流限制的 GPIO

  charge-current-limit-mapping:
    描述: 包含电流（单位：微安）和 GPIO 比特图的元组列表（按此顺序）。这些元组必须按照电流限制降序排列。
$ref: /schemas/types.yaml#/definitions/uint32-matrix
    项:
      项:
        - 描述:
            电流限制（单位：微安）
        - 描述:
            编码后的 GPIO 设置。比特 0 代表来自 charge-current-limit-gpios 属性中的最后一个 GPIO。比特 1 代表倒数第二个 GPIO，以此类推

必需:
  - compatible

anyOf:
  - 必需:
      - gpios
  - 必需:
      - charge-status-gpios
  - 必需:
      - charge-current-limit-gpios

依赖关系:
  charge-current-limit-gpios: [ charge-current-limit-mapping ]
  charge-current-limit-mapping: [ charge-current-limit-gpios ]

额外属性: false

示例:
  - |
    #include <dt-bindings/gpio/gpio.h>

    charger {
      compatible = "gpio-charger";
      charger-type = "usb-sdp";

      gpios = <&gpd 28 GPIO_ACTIVE_LOW>;
      charge-status-gpios = <&gpc 27 GPIO_ACTIVE_LOW>;

      charge-current-limit-gpios = <&gpioA 11 GPIO_ACTIVE_HIGH>,
                                   <&gpioA 12 GPIO_ACTIVE_HIGH>;
      charge-current-limit-mapping = <2500000 0x00>, // 2.5 A => 两个 GPIO 低电平
                                     <700000 0x01>, // 700 mA => GPIO A.12 高电平
                                     <0 0x02>; // 0 mA => GPIO A.11 高电平
    };
