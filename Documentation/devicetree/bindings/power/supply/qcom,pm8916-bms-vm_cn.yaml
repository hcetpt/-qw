# SPDX-文件许可人: (GPL-2.0-only 或 BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/power/supply/qcom,pm8916-bms-vm.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: 高通电压模式电池管理系统(BMS)

maintainers:
  - 尼基塔·特拉夫金 <nikita@trvn.ru>

description:
  电压模式BMS是在一些高通电源管理集成电路(PMIC)中发现的一个硬件模块，例如pm8916。该模块执行电池电压监控。
allOf:
  - $ref: power-supply.yaml#

properties:
  compatible:
    const: qcom,pm8916-bms-vm

  reg:
    maxItems: 1

  interrupts:
    items:
      - description: BMS有限状态机离开S3模式
      - description: BMS有限状态机进入S2模式
      - description: 在S3模式下测量到开路电压(OCV)良好
      - description: 开路电压低于阈值
      - description: 先入先出(FIFO)更新完成
      - description: BMS有限状态机切换状态

  interrupt-names:
    items:
      - const: cv_leave
      - const: cv_enter
      - const: ocv_good
      - const: ocv_thr
      - const: fifo
      - const: state_chg

  monitored-battery: true

  power-supplies: true

required:
  - compatible
  - reg
  - interrupts
  - interrupt-names
  - monitored-battery

additionalProperties: false

examples:
  - |
    #include <dt-bindings/interrupt-controller/irq.h>
    pmic {
      #address-cells = <1>;
      #size-cells = <0>;

      battery@4000 {
        compatible = "qcom,pm8916-bms-vm";
        reg = <0x4000>;
        interrupts = <0x0 0x40 0 IRQ_TYPE_EDGE_RISING>,
                     <0x0 0x40 1 IRQ_TYPE_EDGE_RISING>,
                     <0x0 0x40 2 IRQ_TYPE_EDGE_RISING>,
                     <0x0 0x40 3 IRQ_TYPE_EDGE_RISING>,
                     <0x0 0x40 4 IRQ_TYPE_EDGE_RISING>,
                     <0x0 0x40 5 IRQ_TYPE_EDGE_RISING>;
        interrupt-names = "cv_leave",
                          "cv_enter",
                          "ocv_good",
                          "ocv_thr",
                          "fifo",
                          "state_chg";

        monitored-battery = <&battery>;
        power-supplies = <&pm8916_charger>;
      };
    };
