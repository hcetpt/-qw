# SPDX-许可证标识符: (GPL-2.0-only 或 BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/power/supply/battery.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: 电池特性

维护者:
  - Sebastian Reichel <sre@kernel.org>

描述: |
  设备树中的电池节点提供了静态的电池特性。
  在智能电池中，这些特性通常存储在燃料计量芯片上的非易失性内存中。
  应当在没有合适的非易失性内存或该内存未编程/不正确的情况下使用电池节点。
  上游设备树文件不应包含电池节点，除非所表示的电池不容易被系统中的另一种类型的电池替换。
  这可以防止由于更换了不同类型的电池而未相应更新设备树二进制文件时可能出现的不可预测甚至潜在有害的行为。
  电池属性尽可能地以与 `include/linux/power_supply.h` 中定义的 `enum power_supply_property` 对应的元素命名。

  电池必须通过 phandle 被充电器和/或燃料计量器引用。
  phandle 的属性应命名为 "monitored-battery"。
属性:
  compatible:
    常量: simple-battery

  device-chemistry:
    描述: 描述电池的化学技术。
    可选之一:
      - 常量: nickel-cadmium
      - 常量: nickel-metal-hydride
      - 常量: lithium-ion
        描述: 这是一个涵盖所有锂离子电池的通用类型，
          包括以下几种。如果可能，应使用下面更精确的兼容字符串，
          但有时具体使用的锂离子电池未知，这时可以使用这个宽泛的兼容类型。
      - 常量: lithium-ion-polymer
      - 常量: lithium-ion-iron-phosphate
      - 常量: lithium-ion-manganese-oxide

  over-voltage-threshold-microvolt:
    描述: 电池过电压限制。

  re-charge-voltage-microvolt:
    描述: 重新开始充电的电压限制。

  voltage-min-design-microvolt:
    描述: 电池耗尽时的电压。

  voltage-max-design-microvolt:
    描述: 电池完全充电时的电压。

  energy-full-design-microwatt-hours:
    描述: 电池设计能量。

  charge-full-design-microamp-hours:
    描述: 电池设计容量。

  trickle-charge-current-microamp:
    描述: 滴流充电阶段的电流。

  precharge-current-microamp:
    描述: 预充电阶段的电流。

  precharge-upper-limit-microvolt:
    描述: 更改为恒定充电的电压上限。

  charge-term-current-microamp:
    描述: 充电终止阶段的电流。

  constant-charge-current-max-microamp:
    描述: 最大恒定输入电流。

  constant-charge-voltage-max-microvolt:
    描述: 最大恒定输入电压。

  factory-internal-resistance-micro-ohms:
    描述: 电池出厂内部电阻。

  resistance-temp-table:
    $ref: /schemas/types.yaml#/definitions/uint32-matrix
    项:
      项:
        - 描述: 温度（摄氏度）
        - 描述: 电池内部电阻百分比
    描述: |
      提供温度（摄氏度）及其对应的电池内部电阻百分比的表格，用于根据当前温度查找电阻百分比，以获得不同温度下准确的电池内部电阻。

  ocv-capacity-celsius:
    描述: |
      包含每个电池容量查表的温度（摄氏度）的数组。

  operating-range-celsius:
    描述: 电池的操作温度范围。
    项:
      - 描述: 电池可以工作的最低温度
      - 描述: 电池可以工作的最高温度

  ambient-celsius:
    描述: 安全的环境温度范围。
    项:
      - 描述: 当环境温度低于此值时发出警报
      - 描述: 当环境温度高于此值时发出警报

  alert-celsius:
    描述: 安全的电池温度范围。
    项:
      - 描述: 当电池温度低于此值时发出警报
      - 描述: 当电池温度高于此值时发出警报

必需:
  - compatible

模式属性:
  '^ocv-capacity-table-[0-9]+$':
    $ref: /schemas/types.yaml#/definitions/uint32-matrix
    描述: |
      提供电池开路电压(OCV)及其对应的电池容量百分比的数组，用于根据当前 OCV 值查找电池容量。开路电压单位是微伏特。
```yaml
maxItems: 100
items:
  items:
    - description: 开路电压（OCV）, 单位微伏
    - description: 电池容量百分比
      maximum: 100

additionalProperties: false

examples:
  - |
    power {
      #address-cells = <1>;
      #size-cells = <0>;

      battery: battery {
        compatible = "simple-battery";
        over-voltage-threshold-microvolt = <4500000>;  # 过压阈值，单位微伏
        re-charge-voltage-microvolt = <250000>;        # 重充电电压，单位微伏
        voltage-min-design-microvolt = <3200000>;      # 最小设计电压，单位微伏
        voltage-max-design-microvolt = <4200000>;      # 最大设计电压，单位微伏
        energy-full-design-microwatt-hours = <5290000>;# 全满能量设计值，单位微瓦时
        charge-full-design-microamp-hours = <1430000>; # 全满电荷设计值，单位微安时
        precharge-current-microamp = <256000>;         # 预充电电流，单位微安
        precharge-upper-limit-microvolt = <2500000>;   # 预充电上限电压，单位微伏
        charge-term-current-microamp = <128000>;       # 收尾阶段充电电流，单位微安
        constant-charge-current-max-microamp = <900000>;# 恒定充电最大电流，单位微安
        constant-charge-voltage-max-microvolt = <4200000>;# 恒定充电最大电压，单位微伏
        factory-internal-resistance-micro-ohms = <250000>;# 出厂内部电阻，单位微欧姆
        ocv-capacity-celsius = <(-10) 0 10>;           # OCV-容量关系在不同摄氏度下的表
        /* -10摄氏度时的表格 */
        ocv-capacity-table-0 = <4185000 100>, <4113000 95>, <4066000 90>;
        /* 0摄氏度时的表格 */
        ocv-capacity-table-1 = <4200000 100>, <4185000 95>, <4113000 90>;
        /* 10摄氏度时的表格 */
        ocv-capacity-table-2 = <4250000 100>, <4200000 95>, <4185000 90>;
        resistance-temp-table = <20 100>, <10 90>, <0 80>, <(-10) 60>; # 内阻与温度的关系表
        operating-range-celsius = <(-30) 50>; # 工作温度范围，单位摄氏度
        ambient-celsius = <(-5) 50>;          # 环境温度范围，单位摄氏度
        alert-celsius = <0 40>;               # 警戒温度范围，单位摄氏度
      };

      charger@11 {
        reg = <0x11>;
        monitored-battery = <&battery>;
      };

      fuel-gauge@22 {
        reg = <0x22>;
        monitored-battery = <&battery>;
      };
    };
```

这段配置描述了一个电源系统的定义，其中包括一个电池、一个充电器和一个燃油计量装置。具体包括电池的各项参数，如过压阈值、充电电压、设计电压范围等，并且还定义了不同温度下开路电压与电池容量的关系。同时，还包括充电器和燃油计量装置的配置信息。
