# SPDX-许可证标识符: GPL-2.0-only 或 BSD-2-Clause
%YAML 1.2
---
$id: http://devicetree.org/schemas/bus/socionext,uniphier-system-bus.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: UniPhier 系统总线

description: |
  UniPhier 系统总线是一种外部总线，用于将板载设备连接到 UniPhier SoC。它是一个简单的（半）并行总线，具有地址、数据和一些控制信号。它支持最多 8 个存储器组（芯片选择）
在访问总线之前，必须配置总线控制器；总线控制器寄存器提供了从每个存储器组内的偏移量到 CPU 视图地址的转换控制。所需的设置包括基地址、每个存储器组的大小。可选地，可以针对更快的总线访问优化一些时序参数。
maintainers:
  - Masahiro Yamada <yamada.masahiro@socionext.com>

properties:
  compatible:
    const: socionext,uniphier-system-bus

  reg:
    maxItems: 1

  "#address-cells":
    description: |
      第一个单元是存储器组编号（芯片选择）
第二个单元是存储器组内的地址偏移量
const: 2

  "#size-cells":
    const: 1

  ranges:
    description: |
      提供从系统总线到父级总线的地址转换
注意：
      可以为系统总线分配的地址区域由具体实现定义。某些 SoC 可以使用 0x00000000-0x0fffffff 和 0x40000000-0x4fffffff，而其他 SoC 只能使用 0x40000000-0x4fffffff
根据 SoC 和引导模式可能存在额外限制
只要在支持的地址空间中按所需对齐方式分配存储器组，并且它们不相互重叠，地址转换是任意的
例如，可以映射如下：
        存储器组 0 到 0x42000000-0x43ffffff，存储器组 5 到 0x46000000-0x46ffffff
也可以映射如下：
        存储器组 0 到 0x48000000-0x49ffffff，存储器组 5 到 0x44000000-0x44ffffff
没有理由坚持特定的转换映射，但 "ranges" 属性应提供一个“合理”的默认值，已知该值有效。软件应据此初始化总线控制器
patternProperties:
  "^.*@[1-5],[1-9a-f][0-9a-f]+$":
    description: 连接到芯片选择的设备
    type: object

required:
  - compatible
  - reg
  - "#address-cells"
  - "#size-cells"
  - ranges

additionalProperties: false

examples:
  - |
    // 在这个示例中，
    // - 以太网设备连接到 CS1 的偏移量 0x01f00000 并映射到父级总线的 0x43f00000
该段文字描述了一个设备树（Device Tree）片段，主要用于定义SoC（System on Chip）中的总线和连接到此总线的设备。下面是翻译后的中文版本：

// UART 设备连接在 CS5 的偏移地址 0x00200000 处，
// 并映射到父级总线的 0x46200000 地址处。
system-bus@58c00000 {
        compatible = "socionext,uniphier-system-bus"; // 兼容性标识
        reg = <0x58c00000 0x400>; // 注册器地址范围
        #address-cells = <2>; // 地址单元数量
        #size-cells = <1>; // 大小单元数量
        ranges = <1 0x00000000 0x42000000 0x02000000>, // 地址映射
                 <5 0x00000000 0x46000000 0x01000000>;

        ethernet@1,1f00000 { // 以太网设备
            compatible = "smsc,lan9115"; // 兼容性标识
            reg = <1 0x01f00000 0x1000>; // 注册器地址范围
            interrupts = <0 48 4>; // 中断信息
            phy-mode = "mii"; // 物理层模式
        };

        serial@5,200000 { // UART 串口设备
            compatible = "ns16550a"; // 兼容性标识
            reg = <5 0x00200000 0x20>; // 注册器地址范围
            interrupts = <0 49 4>; // 中断信息
            clock-frequency = <12288000>; // 时钟频率
        };
    };

这里的关键点包括：
- `system-bus` 定义了系统总线的相关配置；
- `ethernet` 和 `serial` 分别指定了以太网和 UART 串口设备，并定义了它们的具体配置信息。
