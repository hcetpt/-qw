# SPDX-许可证标识符: (GPL-2.0 或 BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/leds/backlight/lp855x-backlight.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: 德州仪器 LP855X 背光控制器

maintainers:
  - Artur Weber <aweber.kernel@gmail.com>

properties:
  compatible:
    enum:
      - ti,lp8550
      - ti,lp8551
      - ti,lp8552
      - ti,lp8553
      - ti,lp8555
      - ti,lp8556
      - ti,lp8557

  reg:
    maxItems: 1

  dev-ctrl:
    $ref: /schemas/types.yaml#/definitions/uint8
    description:
      设备控制寄存器的值。这是一个特定于设备的值。
bl-name:
    $ref: /schemas/types.yaml#/definitions/string
    description: 背光设备名称
init-brt:
    $ref: /schemas/types.yaml#/definitions/uint8
    description: 初始背光亮度值
power-supply:
    description: 控制3V电源轨的稳压器
enable-supply:
    description: 控制EN/VDDIO输入的稳压器
pwms:
    maxItems: 1
    description: |
      用于控制背光的PWM通道；设置此属性将启用基于PWM的背光控制模式
pwm-names: true

  pwm-period:
    $ref: /schemas/types.yaml#/definitions/uint32
    description:
      PWM周期值。已弃用；请在pwms属性中设置周期值
deprecated: true

patternProperties:
  "^rom-[0-9a-f]{2}h$":
    type: object
    description: 包含配置寄存器值的节点
additionalProperties: false
    properties:
      rom-addr:
        $ref: /schemas/types.yaml#/definitions/uint8
        description: 要更新的ROM区域的寄存器地址
rom-val:
        $ref: /schemas/types.yaml#/definitions/uint8
        description: 写入ROM寄存器的值
下面是给定的Device Tree Blob (DTB) 配置片段的中文翻译，这些配置用于定义I2C总线上的背光控制器。

```plaintext
# 必需字段：
- compatible（兼容性）
- reg（寄存器地址）
- dev-ctrl（设备控制）

# 不允许未评估的属性
unevaluatedProperties: false

# 示例
examples:
  - |
    i2c {  # I2C 总线
        #address-cells = <1>;  # 地址单元数量为 1
        #size-cells = <0>;  # 大小单元数量为 0

        backlight@2c {  # 背光控制器，地址为 0x2c
            compatible = "ti,lp8555";  # 兼容 ti,lp8555 芯片
            reg = <0x2c>;  # 寄存器地址为 0x2c

            dev-ctrl = /bits/ 8 <0x00>;  # 设备控制，8位宽度，值为 0x00

            pwms = <&pwm 0 10000>;  # PWM 控制信息
            pwm-names = "lp8555";  # PWM 名称

            /* 4V 过压保护，启用第 0 组输出 LED */
            rom-14h {  # ROM 地址为 0x14
              rom-addr = /bits/ 8 <0x14>;  # ROM 地址，8位宽度，值为 0x14
              rom-val = /bits/ 8 <0xcf>;  # ROM 值，8位宽度，值为 0xcf
            };

            /* 重平滑处理，24ms 的斜坡时间步长 */
            rom-15h {  # ROM 地址为 0x15
              rom-addr = /bits/ 8 <0x15>;  # ROM 地址，8位宽度，值为 0x15
              rom-val = /bits/ 8 <0xc7>;  # ROM 值，8位宽度，值为 0xc7
            };

            /* 启用第 1 组输出 LED */
            rom-19h {  # ROM 地址为 0x19
              rom-addr = /bits/ 8 <0x19>;  # ROM 地址，8位宽度，值为 0x19
              rom-val = /bits/ 8 <0x0f>;  # ROM 值，8位宽度，值为 0x0f
            };
        };
    };
  - |
    i2c {  # I2C 总线
        #address-cells = <1>;  # 地址单元数量为 1
        #size-cells = <0>;  # 大小单元数量为 0

        backlight@2c {  # 背光控制器，地址为 0x2c
            compatible = "ti,lp8556";  # 兼容 ti,lp8556 芯片
            reg = <0x2c>;  # 寄存器地址为 0x2c

            bl-name = "lcd-bl";  # 背光名称
            dev-ctrl = /bits/ 8 <0x85>;  # 设备控制，8位宽度，值为 0x85
            init-brt = /bits/ 8 <0x10>;  # 初始亮度，8位宽度，值为 0x10
        };
      };
  - |
    i2c {  # I2C 总线
        #address-cells = <1>;  # 地址单元数量为 1
        #size-cells = <0>;  # 大小单元数量为 0

        backlight@2c {  # 背光控制器，地址为 0x2c
            compatible = "ti,lp8557";  # 兼容 ti,lp8557 芯片
            reg = <0x2c>;  # 寄存器地址为 0x2c
            enable-supply = <&backlight_vddio>;  # 启用电源供应
            power-supply = <&backlight_vdd>;  # 电源供应

            dev-ctrl = /bits/ 8 <0x41>;  # 设备控制，8位宽度，值为 0x41
            init-brt = /bits/ 8 <0x0a>;  # 初始亮度，8位宽度，值为 0x0a

            /* 4V 过压保护，启用 LED 输出串 */
            rom-14h {  # ROM 地址为 0x14
              rom-addr = /bits/ 8 <0x14>;  # ROM 地址，8位宽度，值为 0x14
              rom-val = /bits/ 8 <0xcf>;  # ROM 值，8位宽度，值为 0xcf
            };
        };
    };
```

以上是 Device Tree Blob (DTB) 中关于背光控制器配置的示例，其中定义了不同的芯片型号以及它们的初始化参数。```
