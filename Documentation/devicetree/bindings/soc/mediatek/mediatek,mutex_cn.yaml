# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/soc/mediatek/mediatek,mutex.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: 联发科互斥锁

维护者:
  - 春光 胡 <chunkuang.hu@kernel.org>
  - 菲利普·扎贝尔 <p.zabel@pengutronix.de>

描述: |
  联发科互斥锁，即MUTEX，用于向显示数据路径或MDP数据路径上的每个子模块发送触发信号，这些信号称为帧开始(SOF)/帧结束(EOF)。
  在某些SoC中（例如mt2701），MUTEX可能是一个硬件互斥锁，用于保护影子寄存器。
  MUTEX设备节点必须是中央MMSYS_CONFIG节点的同级节点。
  关于MMSYS_CONFIG绑定的详细说明，请参阅Documentation/devicetree/bindings/arm/mediatek/mediatek,mmsys.yaml。

属性:
  compatible:
    枚举:
      - mediatek,mt2701-disp-mutex
      - mediatek,mt2712-disp-mutex
      - mediatek,mt6795-disp-mutex
      - mediatek,mt8167-disp-mutex
      - mediatek,mt8173-disp-mutex
      - mediatek,mt8183-disp-mutex
      - mediatek,mt8186-disp-mutex
      - mediatek,mt8186-mdp3-mutex
      - mediatek,mt8188-disp-mutex
      - mediatek,mt8188-vpp-mutex
      - mediatek,mt8192-disp-mutex
      - mediatek,mt8195-disp-mutex
      - mediatek,mt8195-vpp-mutex
      - mediatek,mt8365-disp-mutex

  reg:
    最大项数: 1

  interrupts:
    最大项数: 1

  power-domains:
    描述: 根据由phandle指定的电源控制器绑定定义的phandle和PM域指定符。详细信息请参阅Documentation/devicetree/bindings/power/power-domain.yaml。

时钟:
    项目:
      - 描述: MUTEX时钟

  mediatek,gce-events:
    描述:
      与特定硬件事件信号映射到GCE的事件ID。事件ID在各芯片的GCE头文件include/dt-bindings/gce/<chip>-gce.h中定义。
$ref: /schemas/types.yaml#/definitions/uint32-array

  mediatek,gce-client-reg:
    $ref: /schemas/types.yaml#/definitions/phandle-array
    项目:
      项目:
        - 描述: GCE的phandle
        - 描述: GCE子系统ID
        - 描述: 寄存器偏移量
        - 描述: 寄存器大小
    描述: 客户端驱动程序的寄存器可以通过GCE配置，该配置使用此属性中定义的4个参数。每个GCE子系统ID映射到头文件include/dt-bindings/gce/<chip>-gce.h中定义的一个客户端。

allOf:
  - 如果:
      属性:
        compatible:
          包含:
            枚举:
              - mediatek,mt2701-disp-mutex
              - mediatek,mt2712-disp-mutex
              - mediatek,mt6795-disp-mutex
              - mediatek,mt8173-disp-mutex
              - mediatek,mt8186-disp-mutex
              - mediatek,mt8186-mdp3-mutex
              - mediatek,mt8192-disp-mutex
              - mediatek,mt8195-disp-mutex
    那么:
      必需:
        - clocks


必需:
  - compatible
  - reg
  - interrupts
  - power-domains

额外属性: false

示例:
  - |
    #include <dt-bindings/interrupt-controller/arm-gic.h>
    #include <dt-bindings/clock/mt8173-clk.h>
    #include <dt-bindings/power/mt8173-power.h>
    #include <dt-bindings/gce/mt8173-gce.h>

    soc {
        #address-cells = <2>;
        #size-cells = <2>;

        mutex: mutex@14020000 {
            compatible = "mediatek,mt8173-disp-mutex";
            reg = <0 0x14020000 0 0x1000>;
            interrupts = <GIC_SPI 169 IRQ_TYPE_LEVEL_LOW>;
            power-domains = <&spm MT8173_POWER_DOMAIN_MM>;
            clocks = <&mmsys CLK_MM_MUTEX_32K>;
            mediatek,gce-events = <CMDQ_EVENT_MUTEX0_STREAM_EOF>,
                                  <CMDQ_EVENT_MUTEX1_STREAM_EOF>;
        };
    };
