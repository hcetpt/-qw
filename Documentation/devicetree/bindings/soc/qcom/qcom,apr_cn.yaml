### SPDX 许可标识符: (GPL-2.0 或 BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/soc/qcom/qcom,apr.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: Qualcomm APR/GPR (异步/通用数据包路由器)

维护者:
  - Srinivas Kandagatla <srinivas.kandagatla@linaro.org>

描述: |
  此绑定描述了Qualcomm APR/GPR，APR/GPR是一种用于Application处理器和QDSP之间通信的IPC协议。APR/GPR主要用于QDSP上的音频/语音服务。
属性:
  compatible:
    枚举:
      - qcom,apr
      - qcom,apr-v2
      - qcom,gpr

  power-domains:
    最大项数: 1

  qcom,apr-domain:
    $ref: /schemas/types.yaml#/definitions/uint32
    枚举: [1, 2, 3, 4, 5, 6, 7]
    描述:
      选择APR的处理器域
        1 = APR模拟器
        2 = PC域
        3 = 调制解调器域
        4 = ADSP域
        5 = 应用处理器域
        6 = 调制解调器2域
        7 = 应用处理器2域
    过时: true

  qcom,domain:
    $ref: /schemas/types.yaml#/definitions/uint32
    最小值: 1
    最大值: 7
    描述:
      选择APR的处理器域
        1 = APR模拟器
        2 = PC域
        3 = 调制解调器域
        4 = ADSP域
        5 = 应用处理器域
        6 = 调制解调器2域
        7 = 应用处理器2域
      选择GPR的处理器域
        1 = 调制解调器域
        2 = 音频DSP域
        3 = 应用处理器域

  qcom,glink-channels:
    $ref: /schemas/types.yaml#/definitions/string-array
    描述: 用于通信的通道名称
    最大项数: 1

  qcom,intents:
    $ref: /schemas/types.yaml#/definitions/uint32-matrix
    最少项数: 1
    最大项数: 32
    项:
      项:
        - 描述: 每个意图预分配的大小
        - 描述: 预分配的意图数量
          最小值: 1
    描述:
      列表，包含(size, amount)对，描述了此虚拟通道应预分配哪些意图。这可以用来调整通道默认可用的意图，以满足远端的期望。

  qcom,smd-channels:
    $ref: /schemas/types.yaml#/definitions/string-array
    描述: 用于通信的通道名称
    项:
      - 常量: apr_audio_svc

  '#address-cells':
    常量: 1

  '#size-cells':
    常量: 0

模式属性:
  "^service@[1-9a-d]$":
    类型: 对象
    $ref: /schemas/soc/qcom/qcom,apr-services.yaml
    其他属性: true
    描述:
      APR/GPR静态端口服务
属性:
  compatible:
    枚举:
      - qcom,q6core
      - qcom,q6asm
      - qcom,q6afe
      - qcom,q6adm
      - qcom,q6apm
      - qcom,q6prm

必需:
  - compatible
  - qcom,domain

allOf:
  - 如果:
      属性:
        compatible:
          枚举:
            - qcom,gpr
    然后:
      属性:
        qcom,glink-channels:
          项:
            - 常量: adsp_apps
        power-domains: false
    否则:
      属性:
        qcom,glink-channels:
          项:
            - 常量: apr_audio_svc

  - 如果:
      必需:
        - qcom,glink-channels
    然后:
      属性:
        qcom,smd-channels: false

  - 如果:
      必需:
        - qcom,smd-channels
    然后:
      属性:
        qcom,glink-channels: false

其他属性: false

示例:
  - |
    #include <dt-bindings/soc/qcom,apr.h>
    apr {
        compatible = "qcom,apr-v2";
        qcom,domain = <APR_DOMAIN_ADSP>;
        qcom,glink-channels = "apr_audio_svc";
        qcom,intents = <512 20>;
        #address-cells = <1>;
        #size-cells = <0>;

        q6core: service@3 {
            compatible = "qcom,q6core";
            reg = <APR_SVC_ADSP_CORE>;
            qcom,protection-domain = "avs/audio", "msm/adsp/audio_pd";
        };

        service@4 {
            compatible = "qcom,q6afe";
            reg = <APR_SVC_AFE>;
            qcom,protection-domain = "avs/audio", "msm/adsp/audio_pd";

            clock-controller {
                compatible = "qcom,q6afe-clocks";
                #clock-cells = <2>;
            };

            dais {
                compatible = "qcom,q6afe-dais";
                #address-cells = <1>;
                #size-cells = <0>;
                #sound-dai-cells = <1>;
                /* ... */
            };
            /* ... */
        };
    };

  - |
    #include <dt-bindings/soc/qcom,gpr.h>
    gpr {
        compatible = "qcom,gpr";
        qcom,domain = <GPR_DOMAIN_ID_ADSP>;
        qcom,glink-channels = "adsp_apps";
        qcom,intents = <512 20>;
        #address-cells = <1>;
        #size-cells = <0>;

        service@1 {
            compatible = "qcom,q6apm";
            reg = <GPR_APM_MODULE_IID>;
            #sound-dai-cells = <0>;
            qcom,protection-domain = "avs/audio", "msm/adsp/audio_pd";

            dais {
                compatible = "qcom,q6apm-dais";
                iommus = <&apps_smmu 0x1801 0x0>;
            };

            bedais {
                compatible = "qcom,q6apm-lpass-dais";
                #sound-dai-cells = <1>;
            };
        };
    };
