# SPDX-许可证标识符: (GPL-2.0-only 或 BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/soc/ti/wkup-m3-ipc.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: 唤醒 M3 IPC 设备

维护者:
  - Dave Gerlach <d-gerlach@ti.com>
  - Drew Fustini <dfustini@baylibre.com>

描述: |+
  TI AM33xx 和 AM43xx 系列设备使用一个小型 Cortex M3 协处理器（通常称为唤醒 M3 或 CM3）来帮助处理各种无法从 MPU 控制的低功耗任务，如挂起/恢复和 CPU 闲置时的某些深度 C 状态。一旦 wkup_m3_ipc 驱动程序使用 wkup_m3_rproc 驱动程序启动了 wkup_m3，它就会通过 SoC 控制模块中的 IPC 寄存器和邮箱与 CM3 进行通信。wkup_m3_ipc 提供了一个 API，允许 SoC PM 代码执行特定的 PM 任务。
唤醒 M3 设备节点
  ====================
  一个 wkup_m3_ipc 设备节点用于表示 SoC 内部的 IPC 寄存器。
支持 GPIO 引脚控制的 VTT 切换
  ====================================
  在一些板子上，例如 AM335x EVM-SK 和 AM437x GP EVM，一个 GPIO 引脚连接到 DDR VTT 调节器的使能引脚上。这使得调节器可以在挂起时禁用，并在恢复时启用。请注意，GPIO 引脚必须是 GPIO0 模块的一部分，因为只有这个 GPIO 模块位于唤醒电源域中。
支持 IO 隔离
  ========================
  对于 AM437x SoC，当激活 IO 隔离时，某些引脚可以被强制进入替代状态。这些引脚有以 'CTRL_CONF_' 开头的垫控制寄存器，其中包含 DS0（例如，深度睡眠）配置位，这些配置位可以在 IO 隔离活动时覆盖引脚现有的偏置（上拉/下拉）和值（高/低）。
支持 I2C PMIC 电压缩放
  ====================================
  可以将二进制文件的名称传递给 CM3 内存加载。二进制数据是 CM3 在进入低功耗模式期间发送给 PMIC 的 I2C 序列。
属性:
  compatible:
    枚举:
      - ti,am3352-wkup-m3-ipc # 对于 AM33xx SoC
      - ti,am4372-wkup-m3-ipc # 对于 AM43xx SoC

  reg:
    描述:
      与唤醒 M3 处理器进行通信的 IPC 寄存器地址空间
    最大项数: 1

  interrupts:
    描述: 唤醒 M3 中断，用于向 MPU 发送信号
    最大项数: 1

  ti,rproc:
    $ref: /schemas/types.yaml#/definitions/phandle
    描述:
      用于 IPC 驱动程序引导它的 wkup_m3 rproc 节点的 phandle

  mboxes:
    描述:
      IPC 框架使用的 phandle 以获取正确的邮箱通道进行通信。必须指向适当的 mbox_wkupm3 子节点
最大项数: 1

  firmware-name:
    描述:
      包含 I2C 序列用于 PMIC 电压缩放的二进制文件的名称

  ti,vtt-gpio-pin:
    $ref: /schemas/types.yaml#/definitions/uint32
    描述: 连接到 VTT 调节器使能引脚上的 GPIO 引脚

  ti,set-io-isolation:
    类型: 布尔值
    描述:
      如果存在此属性，则 wkup_m3_ipc 驱动程序会指示 CM3 固件在暂停到深度睡眠时激活 IO 隔离。
      这可以被板级设计利用，以将板上的其他设备置于低功耗状态
allOf:
  - 如果:
      属性:
        compatible:
          不:
            包含:
              常量: ti,am4372-wkup-m3-ipc
    然后:
      属性:
        ti,set-io-isolation: false

必需:
  - compatible
  - reg
  - interrupts
  - ti,rproc
  - mboxes

额外属性: false

示例:
  - |
    /* AM335x SoC 示例 */
    soc {
        #address-cells = <1>;
        #size-cells = <1>;

        am335x_mailbox: mailbox {
            #mbox-cells = <1>;
        };

        wkup_m3_ipc@1324 {
           compatible = "ti,am3352-wkup-m3-ipc";
           reg = <0x1324 0x24>;
           interrupts = <78>;
           ti,rproc = <&wkup_m3>;
           mboxes = <&am335x_mailbox &mbox_wkupm3>;
           ti,vtt-gpio-pin = <7>;
           firmware-name = "am335x-evm-scale-data.bin";
        };
    };

  - |
    /*
     * AM473x SoC 示例:
     * 在 AM437x-GP-EVM 板上，gpio5_7 连接到 DDR VTT 调节器的使能引脚。'ddr_vtt_toggle_default' pinmux 节点配置了 gpio5_7，在正常系统操作期间为上拉。然而，该引脚的 DS0（深度睡眠）状态配置为下拉，因此当 IO 隔离激活时，VTT 调节器将被禁用以节省电力。请注意，这种方法是使用 'ti,vtt-gpio-pin' 属性的一个替代方案。
这段代码是 Device Tree Blob (DTB) 的一部分，用于配置基于 AM43xx 系列处理器的硬件。下面是中文翻译：

```plaintext
#include <dt-bindings/pinctrl/am43xx.h>

soc { // 社区（即SoC，System on Chip）
    #address-cells = <1>; // 地址单元数为1
    #size-cells = <1>; // 大小单元数为1

    am437x_mailbox: mailbox { // 邮箱通信模块
        #mbox-cells = <1>; // 邮箱单元数为1
    };

    am43xx_pinmux { // AM43xx引脚复用器
        pinctrl-names = "default"; // 引脚控制器名称
        pinctrl-0 = <&ddr3_vtt_toggle_default>; // 引脚控制器组0

        ddr3_vtt_toggle_default: ddr_vtt_toggle_default { // DDR3 VTT切换默认配置
             pinctrl-single,pins = <
                0x25C (DS0_PULL_UP_DOWN_EN | PIN_OUTPUT_PULLUP | DS0_FORCE_OFF_MODE | MUX_MODE7) // 设置引脚0x25C的属性
             >;
        };
    };

    wkup_m3_ipc@1324 { // 在地址0x1324处的唤醒M3 IPC
       compatible = "ti,am4372-wkup-m3-ipc"; // 兼容性声明
       reg = <0x1324 0x24>; // 寄存器地址范围
       interrupts = <78>; // 中断号
       ti,rproc = <&wkup_m3>; // 关联的远程处理器
       mboxes = <&am437x_mailbox &mbox_wkupm3>; // 邮箱列表
       ti,set-io-isolation; // 设置I/O隔离
       firmware-name = "am43x-evm-scale-data.bin"; // 固件名称
    };
};
```

请注意，这里的翻译主要是对代码中的注释和语义进行解释，并非直接的逐字翻译。
