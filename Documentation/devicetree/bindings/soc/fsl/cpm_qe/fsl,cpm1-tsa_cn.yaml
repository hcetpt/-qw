# SPDX-许可证标识符: (GPL-2.0-only 或 BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/soc/fsl/cpm_qe/fsl,cpm1-tsa.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: PowerQUICC CPM 时间槽分配器 (TSA) 控制器

维护者:
  - Herve Codina <herve.codina@bootlin.com>

描述:
  TSA 是可在某些 PowerQUICC 系统级芯片上找到的时间槽分配器。
它的目的是将一些时分复用 (TDM) 时间槽路由到其他内部串行控制器。
属性:
  compatible:
    items:
      - 枚举:
          - fsl,mpc885-tsa
          - fsl,mpc866-tsa
      - 常量: fsl,cpm1-tsa

  reg:
    items:
      - 描述: SI (串行接口) 寄存器基址
      - 描述: SI RAM 基址

  reg-names:
    items:
      - 常量: si_regs
      - 常量: si_ram

  '#address-cells':
    常量: 1

  '#size-cells':
    常量: 0

模式属性:
  '^tdm@[0-1]$':
    描述:
      该控制器管理的 TDM
    类型: 对象

    不允许额外属性。

    属性:
      reg:
        最小值: 0
        最大值: 1
        描述:
          该 TDM 的编号，0 表示 TDMa，1 表示 TDMb

      fsl,common-rxtx-pins:
        $ref: /schemas/types.yaml#/definitions/flag
        描述:
          硬件可以使用四个专用引脚用于 Tx 时钟、Tx 同步、Rx 时钟和 Rx 同步，
          或仅使用两个引脚用于 Tx/Rx 时钟和 Tx/Rx 同步。
          如果没有 'fsl,common-rxtx-pins' 属性，则使用四个引脚。
          如果有 'fsl,common-rxtx-pins' 属性，则使用两个引脚。
      clocks:
        minItems: 2
        items:
          - 描述: 连接到 L1RSYNC 引脚的外部时钟
          - 描述: 连接到 L1RCLK 引脚的外部时钟
          - 描述: 连接到 L1TSYNC 引脚的外部时钟
          - 描述: 连接到 L1TCLK 引脚的外部时钟

      clock-names:
        minItems: 2
        items:
          - 常量: l1rsync
          - 常量: l1rclk
          - 常量: l1tsync
          - 常量: l1tclk

      fsl,rx-frame-sync-delay-bits:
        枚举: [0, 1, 2, 3]
        默认: 0
        描述: |
          接收帧同步延迟比特数
          指示 Rx 同步与 Rx 帧的第一个比特之间的延迟。0 表示无比特延迟。1、2 或 3 表示 1、2 或 3 比特延迟。
      fsl,tx-frame-sync-delay-bits:
        枚举: [0, 1, 2, 3]
        默认: 0
        描述: |
          发送帧同步延迟比特数
          指示 Tx 同步与 Tx 帧的第一个比特之间的延迟。0 表示无比特延迟。1、2 或 3 表示 1、2 或 3 比特延迟。
      fsl,clock-falling-edge:
        $ref: /schemas/types.yaml#/definitions/flag
        描述:
          数据在时钟下降沿发送（并在上升沿接收）。如果未指定 'clock-falling-edge'，
          则数据在上升沿发送（并在下降沿接收）。
Here's the translation into Chinese:

`fsl`, `fsync-rising-edge`:
        $ref: /schemas/types.yaml#/definitions/flag
        description:
          帧同步脉冲使用通道时钟的上升沿进行采样。如果不存在`fsync-rising-edge`，则脉冲使用下降沿进行采样。

`fsl`, `double-speed-clock`:
        $ref: /schemas/types.yaml#/definitions/flag
        description:
          通道时钟是数据速率的两倍。

`patternProperties`:
      '^fsl,[rt]x-ts-routes$':
        $ref: /schemas/types.yaml#/definitions/uint32-matrix
        description: |
          一个元组列表，指示Tx或Rx时隙的路由
items:
          items:
            - description:
                时隙的数量
              minimum: 1
              maximum: 64
            - description: |
                源（Tx）或目的地（Rx）串行接口
                （dt-bindings/soc/cpm1-fsl,tsa.h定义了这些值）
                 - 0: 无目的地
                 - 1: SCC2
                 - 2: SCC3
                 - 3: SCC4
                 - 4: SMC1
                 - 5: SMC2
              enum: [0, 1, 2, 3, 4, 5]
        minItems: 1
        maxItems: 64

`allOf`:
      # 如果存在`fsl,common-rxtx-pins`，只需要2个时钟
# 否则，必须存在4个时钟
- if:
          required:
            - fsl,common-rxtx-pins
        then:
          properties:
            clocks:
              maxItems: 2
            clock-names:
              maxItems: 2
        else:
          properties:
            clocks:
              minItems: 4
            clock-names:
              minItems: 4

`required`:
      - reg
      - clocks
      - clock-names

`required`:
  - compatible
  - reg
  - reg-names
  - '#address-cells'
  - '#size-cells'

additionalProperties: false

例子:
  - |
    #include <dt-bindings/soc/cpm1-fsl,tsa.h>

    tsa@ae0 {
        compatible = "fsl,mpc885-tsa", "fsl,cpm1-tsa";
        reg = <0xae0 0x10>,
              <0xc00 0x200>;
        reg-names = "si_regs", "si_ram";

        #address-cells = <1>;
        #size-cells = <0>;

        tdm@0 {
            /* TDMa */
            reg = <0>;

            clocks = <&clk_l1rsynca>, <&clk_l1rclka>;
            clock-names = "l1rsync", "l1rclk";

            fsl,common-rxtx-pins;
            fsl,fsync-rising-edge;

            fsl,tx-ts-routes = <2 0>,             /* TS 0..1 */
                           <24 FSL_CPM_TSA_SCC4>, /* TS 2..25 */
                           <1 0>,                 /* TS 26 */
                           <5 FSL_CPM_TSA_SCC3>;  /* TS 27..31 */

            fsl,rx-ts-routes = <2 0>,             /* TS 0..1 */
                           <24 FSL_CPM_TSA_SCC4>, /* 2..25 */
                           <1 0>,                 /* TS 26 */
                           <5 FSL_CPM_TSA_SCC3>;  /* TS 27..31 */
        };
    };
