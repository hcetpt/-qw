# SPDX-文件许可人: (GPL-2.0 或 BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/firmware/cznic,turris-omnia-mcu.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: CZ.NIC 的 Turris Omnia 微控制器单元 (MCU)

maintainers:
  - Marek Behún <kabel@kernel.org>

description:
  在 Turris Omnia 上的 MCU 作为系统控制器提供额外的 GPIO、中断、看门狗、系统关机和唤醒配置。

properties:
  compatible:
    const: cznic,turris-omnia-mcu

  reg:
    description: MCU I2C 从设备地址
    maxItems: 1

  interrupts:
    maxItems: 1

  interrupt-controller: true

  '#interrupt-cells':
    const: 2
    description: |
      第一个单元格指定中断编号（0 到 63），第二个单元格指定中断类型（可以是 IRQ_TYPE_EDGE_RISING、
      IRQ_TYPE_EDGE_FALLING 或 IRQ_TYPE_EDGE_BOTH）
中断编号依次对应 GPIO 编号，考虑 GPIO 银行：
        中断编号   GPIO 银行   银行内的 GPIO 引脚编号
           0 - 15      0           0 - 15
          16 - 47      1           0 - 31
          48 - 63      2           0 - 15
有几个例外情况：
        中断编号   含义
          11           按钮按下时 LED 面板亮度变化
          13           TRNG 熵准备就绪
          14           ECDSA 消息签名计算完成

  gpio-controller: true

  '#gpio-cells':
    const: 3
    description:
      第一个单元格是银行编号（0、1 或 2），第二个单元格是银行内的引脚编号
      （对于银行 0 和 2 为 0 到 15，对于银行 1 为 0 到 31），第三个单元格指定消费者标志。

required:
  - compatible
  - reg
  - interrupts
  - interrupt-controller
  - gpio-controller

additionalProperties: false

examples:
  - |
    #include <dt-bindings/interrupt-controller/irq.h>

    i2c {
        #address-cells = <1>;
        #size-cells = <0>;

        system-controller@2a {
            compatible = "cznic,turris-omnia-mcu";
            reg = <0x2a>;

            interrupt-parent = <&gpio1>;
            interrupts = <11 IRQ_TYPE_NONE>;

            gpio-controller;
            #gpio-cells = <3>;

            interrupt-controller;
            #interrupt-cells = <2>;
        };
    };
