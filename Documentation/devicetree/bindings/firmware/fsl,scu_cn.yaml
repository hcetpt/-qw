# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/firmware/fsl,scu.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: NXP i.MX 系统控制器固件 (SCFW)

maintainers:
  - 东艾生 <aisheng.dong@nxp.com>

description:
  系统控制器固件 (SCFW) 是一种低级系统功能，运行在一个专用的 Cortex-M 核心上，提供电源、时钟和资源管理。它存在于某些 i.MX8 处理器中，例如 i.MX8QM (QM, QP)，以及 i.MX8QX (QXP, DX)。
应用处理器 (AP) 通过位于 LSIO 子系统中的多端口 MU 模块与 SC 进行通信。当前定义的这个 MU 模块提供了 5 个远程 AP 连接到 SC，以支持最多 5 个执行环境（可信区，虚拟机监视器，标准 Linux 等）。这个 MU 模块的 SC 一侧接口与 LSIO DSC IP 总线相连。SC 固件将使用 MSI 总线与该 MU 模块进行通信。
properties:
  compatible:
    const: fsl,imx-scu

  clock-controller:
    description:
      提供由 SCU 控制的时钟的时钟控制器节点
    $ref: /schemas/clock/fsl,scu-clk.yaml

  gpio:
    description:
      通过固件 API 控制 SCU 域上的 GPIO 引脚
    $ref: /schemas/gpio/fsl,imx8qxp-sc-gpio.yaml

  ocotp:
    description:
      由 SCU 提供的 OCOTP 控制器节点
    $ref: /schemas/nvmem/fsl,scu-ocotp.yaml

  keys:
    description:
      由 SCU 提供的按键
    $ref: /schemas/input/fsl,scu-key.yaml

  mboxes:
    description:
      一个 TX MU 通道的 phandle 列表后跟一个 RX MU 通道的 phandle 列表。列表末尾可以包含一个可选的 MU 通道用于通用中断。如果 MU 实例与 "fsl,imx8-mu-scu" 兼容，则预期的 TX 和 RX 通道数量为 1 TX 和 1 RX 通道；否则为 4 TX 和 4 RX 通道。所有 MU 通道必须在同一 MU 实例内。不允许跨实例。MU 实例只能是 imx8qxp 和 imx8qm 中的 LSIO MU0～M4 之一。用户需要确保所用的一个不与其它执行环境（如 ATF）冲突。
oneOf:
      - items:
          - description: TX0 MU 通道
          - description: RX0 MU 通道
      - items:
          - description: TX0 MU 通道
          - description: RX0 MU 通道
          - description: 可选 MU 通道用于通用中断
      - items:
          - description: TX0 MU 通道
          - description: TX1 MU 通道
          - description: TX2 MU 通道
          - description: TX3 MU 通道
          - description: RX0 MU 通道
          - description: RX1 MU 通道
          - description: RX2 MU 通道
          - description: RX3 MU 通道
      - items:
          - description: TX0 MU 通道
          - description: TX1 MU 通道
          - description: TX2 MU 通道
          - description: TX3 MU 通道
          - description: RX0 MU 通道
          - description: RX1 MU 通道
          - description: RX2 MU 通道
          - description: RX3 MU 通道
          - description: 可选 MU 通道用于通用中断

  mbox-names:
    oneOf:
      - items:
          - const: tx0
          - const: rx0
      - items:
          - const: tx0
          - const: rx0
          - const: gip3
      - items:
          - const: tx0
          - const: tx1
          - const: tx2
          - const: tx3
          - const: rx0
          - const: rx1
          - const: rx2
          - const: rx3
      - items:
          - const: tx0
          - const: tx1
          - const: tx2
          - const: tx3
          - const: rx0
          - const: rx1
          - const: rx2
          - const: rx3
          - const: gip3

  pinctrl:
    description:
      由 SCU 提供的引脚控制器
    $ref: /schemas/pinctrl/fsl,scu-pinctrl.yaml

  power-controller:
    description:
      提供由 SCU 控制的电源域的电源域控制器节点
    $ref: /schemas/power/fsl,scu-pd.yaml

  rtc:
    description:
      由 SCU 提供的 RTC 控制器
    $ref: /schemas/rtc/fsl,scu-rtc.yaml

  thermal-sensor:
    description:
      由 SCU 提供的温度传感器
    $ref: /schemas/thermal/fsl,scu-thermal.yaml

  watchdog:
    description:
      由 SCU 提供的看门狗控制器
    $ref: /schemas/watchdog/fsl,scu-wdt.yaml

required:
  - compatible
  - mbox-names
  - mboxes

additionalProperties: false

examples:
  - |
    #include <dt-bindings/firmware/imx/rsrc.h>
    #include <dt-bindings/input/input.h>
    #include <dt-bindings/pinctrl/pads-imx8qxp.h>

    firmware {
        system-controller {
            compatible = "fsl,imx-scu";
            mbox-names = "tx0", "tx1", "tx2", "tx3",
                         "rx0", "rx1", "rx2", "rx3",
                         "gip3";
            mboxes = <&lsio_mu1 0 0 &lsio_mu1 0 1 &lsio_mu1 0 2 &lsio_mu1 0 3
                      &lsio_mu1 1 0 &lsio_mu1 1 1 &lsio_mu1 1 2 &lsio_mu1 1 3
                      &lsio_mu1 3 3>;

            clock-controller {
                compatible = "fsl,imx8qxp-clk", "fsl,scu-clk";
                #clock-cells = <2>;
            };

            pinctrl {
                compatible = "fsl,imx8qxp-iomuxc";

                pinctrl_lpuart0: lpuart0grp {
                    fsl,pins = <
                        IMX8QXP_UART0_RX_ADMA_UART0_RX   0x06000020
                        IMX8QXP_UART0_TX_ADMA_UART0_TX   0x06000020
                    >;
                };
            };

            ocotp {
                compatible = "fsl,imx8qxp-scu-ocotp";
                #address-cells = <1>;
                #size-cells = <1>;

                fec_mac0: mac@2c4 {
                    reg = <0x2c4 6>;
                };
            };

            power-controller {
                compatible = "fsl,imx8qxp-scu-pd", "fsl,scu-pd";
                #power-domain-cells = <1>;
            };

            rtc {
                compatible = "fsl,imx8qxp-sc-rtc";
            };

            keys {
                compatible = "fsl,imx8qxp-sc-key", "fsl,imx-sc-key";
                linux,keycodes = <KEY_POWER>;
            };

            watchdog {
                compatible = "fsl,imx8qxp-sc-wdt", "fsl,imx-sc-wdt";
                timeout-sec = <60>;
            };

            thermal-sensor {
                compatible = "fsl,imx8qxp-sc-thermal", "fsl,imx-sc-thermal";
                #thermal-sensor-cells = <1>;
            };
        };
    };
