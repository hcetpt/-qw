# SPDX-许可证标识符: (GPL-2.0-only 或 BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/pci/fsl,layerscape-pcie.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: Freescale Layerscape PCIe 根复合体(RC)控制器

维护者:
  - Frank Li <Frank.Li@nxp.com>

描述:
  此 PCIe RC 控制器基于 Synopsys DesignWare PCIe IP。

  此控制器从重置配置词(RCW)获取其时钟，该配置词用于在芯片复位时描述 PLL 设置。
  根据可用的参考手册，Freescale PCIe 控制器寄存器集内没有特定的“版本”寄存器，
  这使得无法确定底层 DesignWare PCIe 控制器的版本信息。
属性:
  compatible:
    枚举:
      - fsl,ls1021a-pcie
      - fsl,ls2080a-pcie
      - fsl,ls2085a-pcie
      - fsl,ls2088a-pcie
      - fsl,ls1088a-pcie
      - fsl,ls1046a-pcie
      - fsl,ls1043a-pcie
      - fsl,ls1012a-pcie
      - fsl,ls1028a-pcie
      - fsl,lx2160a-pcie

  reg:
    maxItems: 2

  reg-names:
    items:
      - 常量: regs
      - 常量: config

  fsl,pcie-scfg:
    $ref: /schemas/types.yaml#/definitions/phandle
    描述: 指向 SCFG 设备节点的 phandle。第二个条目是从 '0' 开始的物理 PCIe 控制器索引。这用于获取 SCFG PEXN 寄存器
big-endian:
    $ref: /schemas/types.yaml#/definitions/flag
    描述: 如果 PEX_LUT 和 PF 寄存器块采用大端格式，请指定此属性
dma-coherent: true

  msi-parent: true

  iommu-map: true

  interrupts:
    minItems: 1
    maxItems: 2

  interrupt-names:
    minItems: 1
    maxItems: 2

必需:
  - compatible
  - reg
  - reg-names
  - "#address-cells"
  - "#size-cells"
  - device_type
  - bus-range
  - ranges
  - interrupts
  - interrupt-names
  - "#interrupt-cells"
  - interrupt-map-mask
  - interrupt-map

allOf:
  - $ref: /schemas/pci/pci-bus.yaml#

  - 如果:
      属性:
        compatible:
          枚举:
            - fsl,ls1028a-pcie
            - fsl,ls1046a-pcie
            - fsl,ls1043a-pcie
            - fsl,ls1012a-pcie
    然后:
      属性:
        interrupts:
          maxItems: 2
        interrupt-names:
          items:
            - 常量: pme
            - 常量: aer

  - 如果:
      属性:
        compatible:
          枚举:
            - fsl,ls2080a-pcie
            - fsl,ls2085a-pcie
            - fsl,ls2088a-pcie
    然后:
      属性:
        interrupts:
          maxItems: 1
        interrupt-names:
          items:
            - 常量: intr

  - 如果:
      属性:
        compatible:
          枚举:
            - fsl,ls1088a-pcie
    然后:
      属性:
        interrupts:
          maxItems: 1
        interrupt-names:
          items:
            - 常量: aer

unevaluatedProperties: false

示例:
  - |
    #include <dt-bindings/interrupt-controller/arm-gic.h>

    soc {
      #address-cells = <2>;
      #size-cells = <2>;

      pcie@3400000 {
        compatible = "fsl,ls1088a-pcie";
        reg = <0x00 0x03400000 0x0 0x00100000>, /* 控制器寄存器 */
            <0x20 0x00000000 0x0 0x00002000>; /* 配置空间 */
        reg-names = "regs", "config";
        interrupts = <0 108 IRQ_TYPE_LEVEL_HIGH>; /* aer 中断 */
        interrupt-names = "aer";
        #address-cells = <3>;
        #size-cells = <2>;
        dma-coherent;
        device_type = "pci";
        bus-range = <0x0 0xff>;
        ranges = <0x81000000 0x0 0x00000000 0x20 0x00010000 0x0 0x00010000   /* 下游 I/O */
                 0x82000000 0x0 0x40000000 0x20 0x40000000 0x0 0x40000000>; /* 不可预取内存 */
        msi-parent = <&its>;
        #interrupt-cells = <1>;
        interrupt-map-mask = <0 0 0 7>;
        interrupt-map = <0000 0 0 1 &gic 0 0 0 109 IRQ_TYPE_LEVEL_HIGH>,
                        <0000 0 0 2 &gic 0 0 0 110 IRQ_TYPE_LEVEL_HIGH>,
                        <0000 0 0 3 &gic 0 0 0 111 IRQ_TYPE_LEVEL_HIGH>,
                        <0000 0 0 4 &gic 0 0 0 112 IRQ_TYPE_LEVEL_HIGH>;
        iommu-map = <0 &smmu 0 1>; /* 由引导加载程序修正 */
      };
    };
..
