# SPDX-许可证标识符: (GPL-2.0-only 或 BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/pci/fsl,imx6q-pcie-common.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: Freescale i.MX6 PCIe RC/EP 控制器

维护者:
  - Lucas Stach <l.stach@pengutronix.de>
  - Richard Zhu <hongxing.zhu@nxp.com>

描述:
  Freescale i.MX PCIe 根端口和终端控制器的通用属性
属性:
  clocks:
    minItems: 3
    maxItems: 4

  clock-names:
    minItems: 3
    maxItems: 4

  num-lanes:
    const: 1

  fsl,imx7d-pcie-phy:
    $ref: /schemas/types.yaml#/definitions/phandle
    描述: 指向 fsl,imx7d-pcie-phy 节点的 phandle。对于 imx7d-pcie、imx7d-pcie-ep、imx8mq-pcie 和 imx8mq-pcie-ep 额外需要的属性
功耗域:
    minItems: 1
    items:
      - 描述: 指向 DISPLAY 域的 phandle 对于 imx6sx-pcie、imx6sx-pcie-ep，指向 PCIE_PHY 功耗域对于 imx7d-pcie、imx7d-pcie-ep、imx8mq-pcie 和 imx8mq-pcie-ep
- 描述: 指向 PCIE_PHY 功耗域的 phandle 对于 imx6sx-pcie 和 imx6sx-pcie-ep
功耗域名称:
    minItems: 1
    items:
      - const: pcie
      - const: pcie_phy

  resets:
    minItems: 2
    maxItems: 3
    描述: 由 SRC IP 块暴露的与 PCIe 相关的复位线的 phandle。对 imx7d-pcie、imx7d-pcie-ep、imx8mq-pcie 和 imx8mq-pcie-ep 额外需要
复位名称:
    minItems: 2
    maxItems: 3

  fsl,tx-deemph-gen1:
    描述: 第一代 De-emphasis 值（可选必需）
$ref: /schemas/types.yaml#/definitions/uint32
    默认值: 0

  fsl,tx-deemph-gen2-3p5db:
    描述: 第二代 (3.5db) De-emphasis 值（可选必需）
$ref: /schemas/types.yaml#/definitions/uint32
    默认值: 0

  fsl,tx-deemph-gen2-6db:
    描述: 第二代 (6db) De-emphasis 值（可选必需）
$ref: /schemas/types.yaml#/definitions/uint32
    默认值: 20

  fsl,tx-swing-full:
    描述: 第二代 TX SWING FULL 值（可选必需）
$ref: /schemas/types.yaml#/definitions/uint32
    默认值: 127

  fsl,tx-swing-low:
    描述: TX 发射幅度 swing_low 值（可选必需）
This YAML configuration describes properties and constraints for various PCIe controllers in Freescale (now NXP) SoCs (System on Chips). Here's a translation into Chinese:

```yaml
# 定义引用：最大链路速度
$ref: /schemas/types.yaml#/definitions/uint32
default: 127

fsl,max-link-speed:
  description: 指定PCIe链路能力的代数（可选）
注意IMX6 LVDS时钟输出不满足Gen2抖动要求，因此对于Gen2能力，
需要使用符合Gen2标准的时钟发生器并进行配置
$ref: /schemas/types.yaml#/definitions/uint32
enum: [1, 2, 3, 4]
default: 1

phys:
  maxItems: 1

phy-names:
  const: pcie-phy

vpcie-supply:
  description: 应指定负责PCIe端口供电的电源管理器
初始化PCIe主机时将启用电源管理器，并在初始化过程中或关闭主机时禁用它（可选）

vph-supply:
  description: 应指定负责VPH之一的三个PCIe PHY电源的电源管理器。
此电源管理器可以由1.8V和3.3V电压供应（可选）

required:
  - clocks
  - clock-names
  - num-lanes

allOf:
  - if:
      properties:
        compatible:
          contains:
            enum:
              - fsl,imx6sx-pcie
              - fsl,imx6sx-pcie-ep
    then:
      properties:
        clock-names:
          items:
            - {}
            - {}
            - const: pcie_phy
            - const: pcie_inbound_axi
        power-domains:
          minItems: 2
        power-domain-names:
          minItems: 2

  - if:
      properties:
        compatible:
          contains:
            enum:
              - fsl,imx8mq-pcie
              - fsl,imx8mq-pcie-ep
    then:
      properties:
        clock-names:
          items:
            - {}
            - {}
            - const: pcie_phy
            - const: pcie_aux

  - if:
      properties:
        compatible:
          contains:
            enum:
              - fsl,imx6q-pcie
              - fsl,imx6qp-pcie
              - fsl,imx7d-pcie
              - fsl,imx6q-pcie-ep
              - fsl,imx6qp-pcie-ep
              - fsl,imx7d-pcie-ep
    then:
      properties:
        clock-names:
          maxItems: 3
          contains:
            const: pcie_phy

  - if:
      properties:
        compatible:
          contains:
            enum:
              - fsl,imx8mm-pcie
              - fsl,imx8mp-pcie
              - fsl,imx8mm-pcie-ep
              - fsl,imx8mp-pcie-ep
    then:
      properties:
        clock-names:
          maxItems: 3
          contains:
            const: pcie_aux
  - if:
      properties:
        compatible:
          contains:
            enum:
              - fsl,imx6q-pcie
              - fsl,imx6qp-pcie
              - fsl,imx6q-pcie-ep
              - fsl,imx6qp-pcie-ep
    then:
      properties:
        power-domains: false
        power-domain-names: false

  - if:
      not:
        properties:
          compatible:
            contains:
              enum:
                - fsl,imx6sx-pcie
                - fsl,imx6q-pcie
                - fsl,imx6qp-pcie
                - fsl,imx95-pcie
                - fsl,imx6sx-pcie-ep
                - fsl,imx6q-pcie-ep
                - fsl,imx6qp-pcie-ep
    then:
      properties:
        power-domains:
          maxItems: 1
        power-domain-names: false

  - if:
      properties:
        compatible:
          contains:
            enum:
              - fsl,imx6q-pcie
              - fsl,imx6sx-pcie
              - fsl,imx6qp-pcie
              - fsl,imx7d-pcie
              - fsl,imx8mq-pcie
              - fsl,imx6q-pcie-ep
              - fsl,imx6sx-pcie-ep
              - fsl,imx6qp-pcie-ep
              - fsl,imx7d-pcie-ep
              - fsl,imx8mq-pcie-ep
    then:
      properties:
        resets:
          minItems: 3
        reset-names:
          items:
            - const: pciephy
            - const: apps
            - const: turnoff
    else:
      properties:
        resets:
          maxItems: 2
        reset-names:
          items:
            - const: apps
            - const: turnoff

additionalProperties: true
```

请注意，这段配置描述了不同SoC中PCIe控制器的各种属性和约束条件，包括兼容性、时钟名称、重置信号等。这些配置用于指导硬件初始化和驱动开发。
