# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/pci/fsl,imx6q-pcie.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Freescale i.MX6 PCIe 主控制器

maintainers:
  - Lucas Stach <l.stach@pengutronix.de>
  - Richard Zhu <hongxing.zhu@nxp.com>

description: |+
  此 PCIe 主控制器基于 Synopsys DesignWare PCIe IP，
  因此继承了在 snps,dw-pcie.yaml 中定义的所有通用属性。
  控制器实例是双模式的，它们可以工作在根端口模式或终端模式，
  但一次只能使用其中一种模式。
  有关终端模式设备树绑定的详细信息，请参见 fsl,imx6q-pcie-ep.yaml。

properties:
  compatible:
    enum:
      - fsl,imx6q-pcie
      - fsl,imx6sx-pcie
      - fsl,imx6qp-pcie
      - fsl,imx7d-pcie
      - fsl,imx8mq-pcie
      - fsl,imx8mm-pcie
      - fsl,imx8mp-pcie
      - fsl,imx95-pcie

  clocks:
    minItems: 3
    items:
      - description: PCIe 桥接时钟
      - description: PCIe 总线时钟
      - description: PCIe PHY 时钟
      - description: 对于 imx6sx-pcie、imx6sx-pcie-ep、imx8mq-pcie 和 imx8mq-pcie-ep 需要的额外时钟条目
clock-names:
    minItems: 3
    maxItems: 4

  interrupts:
    items:
      - description: 内置的 MSI 控制器
interrupt-names:
    items:
      - const: msi

  reset-gpio:
    description: 应指定用于控制 PCI 总线设备复位信号的 GPIO。它不识别极性，并默认为低电平有效复位序列（L=复位状态，H=运行状态）（可选）
reset-gpio-active-high:
    description: 如果存在，则使用在 "reset-gpio" 属性中指定的 GPIO 的复位序列将被反转（H=复位状态，L=运行状态）（可选）
这段文本定义了一个设备树节点的配置模板，用于描述Freescale i.MX 系列处理器中的PCIe控制器。下面是翻译成中文的内容：

类型: 布尔值

必须包含:
  - 兼容性（compatible）
  - 地址范围（reg）
  - 地址范围名称（reg-names）
  - 地址单元数（#address-cells）
  - 大小单元数（#size-cells）
  - 设备类型（device_type）
  - 总线范围（bus-range）
  - 范围映射（ranges）
  - 中断（interrupts）
  - 中断名称（interrupt-names）
  - 中断单元数（#interrupt-cells）
  - 中断映射掩码（interrupt-map-mask）
  - 中断映射（interrupt-map）

所有选项中都应包括:
  - 引用文件：`/schemas/pci/snps,dw-pcie.yaml`
  - 引用文件：`/schemas/pci/fsl,imx6q-pcie-common.yaml`

对于特定兼容性的条件:
  - 如果兼容性是 `fsl,imx6q-pcie`, `fsl,imx6sx-pcie`, `fsl,imx6qp-pcie`, `fsl,imx7d-pcie`, `fsl,imx8mq-pcie`, `fsl,imx8mm-pcie`, 或 `fsl,imx8mp-pcie`:
    - 地址范围（reg）最多可以有2项
    - 地址范围名称（reg-names）为 "dbi" 和 "config"

  - 如果兼容性是 `fsl,imx95-pcie`:
    - 地址范围（reg）至少要有4项且最多可以有4项
    - 地址范围名称（reg-names）为 "dbi", "config", "atu", 和 "app"

  - 如果兼容性是 `fsl,imx6sx-pcie`:
    - 时钟（clocks）至少要有4项
    - 时钟名称（clock-names）为 "pcie", "pcie_bus", "pcie_phy", 和 "pcie_inbound_axi"

  - 如果兼容性是 `fsl,imx8mq-pcie` 或 `fsl,imx95-pcie`:
    - 时钟（clocks）至少要有4项
    - 时钟名称（clock-names）为 "pcie", "pcie_bus", "pcie_phy", 和 "pcie_aux"

  - 如果兼容性是 `fsl,imx6q-pcie`, `fsl,imx6qp-pcie`, 或 `fsl,imx7d-pcie`:
    - 时钟（clocks）最多可以有3项
    - 时钟名称（clock-names）为 "pcie", "pcie_bus", 和 "pcie_phy"

  - 如果兼容性是 `fsl,imx8mm-pcie` 或 `fsl,imx8mp-pcie`:
    - 时钟（clocks）最多可以有3项
    - 时钟名称（clock-names）为 "pcie", "pcie_bus", 和 "pcie_aux"

不允许未评估的属性。

示例:
  - |
    包含 <dt-bindings/clock/imx6qdl-clock.h>
    包含 <dt-bindings/interrupt-controller/arm-gic.h>

    pcie: pcie@1ffc000 {
        兼容性 = "fsl,imx6q-pcie";
        地址范围 = <0x01ffc000 0x04000>,
                  <0x01f00000 0x80000>;
        地址范围名称 = "dbi", "config";
        地址单元数 = <3>;
        大小单元数 = <2>;
        设备类型 = "pci";
        总线范围 = <0x00 0xff>;
        范围映射 = <0x81000000 0 0          0x01f80000 0 0x00010000>,
                   <0x82000000 0 0x01000000 0x01000000 0 0x00f00000>;
        车道数量 = <1>;
        中断 = <GIC_SPI 120 IRQ_TYPE_LEVEL_HIGH>;
        中断名称 = "msi";
        中断单元数 = <1>;
        中断映射掩码 = <0 0 0 0x7>;
        中断映射 = <0 0 0 1 &gpc GIC_SPI 123 IRQ_TYPE_LEVEL_HIGH>,
                   <0 0 0 2 &gpc GIC_SPI 122 IRQ_TYPE_LEVEL_HIGH>,
                   <0 0 0 3 &gpc GIC_SPI 121 IRQ_TYPE_LEVEL_HIGH>,
                   <0 0 0 4 &gpc GIC_SPI 120 IRQ_TYPE_LEVEL_HIGH>;
        时钟 = <&clks IMX6QDL_CLK_PCIE_AXI>,
               <&clks IMX6QDL_CLK_LVDS1_GATE>,
               <&clks IMX6QDL_CLK_PCIE_REF_125M>;
        时钟名称 = "pcie", "pcie_bus", "pcie_phy";
    };
..
