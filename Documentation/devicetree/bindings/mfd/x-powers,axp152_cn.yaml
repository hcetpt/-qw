# SPDX-许可证标识符: GPL-2.0
%YAML 1.2
---
$id: http://devicetree.org/schemas/mfd/x-powers,axp152.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: X-Powers AXP PMIC

维护者:
  - 陈宇蔡 <wens@csie.org>

allOf:
  - 如果:
      属性:
        兼容性:
          包含:
            枚举:
              - x-powers,axp152
              - x-powers,axp202
              - x-powers,axp209

    那么:
      属性:
        调压器:
          属性:
            x-powers,dcdc-freq:
              最小值: 750
              最大值: 1875
              默认: 1500

    否则:
      属性:
        调压器:
          属性:
            x-powers,dcdc-freq:
              最小值: 1800
              最大值: 4050
              默认: 3000

  - 如果:
      属性:
        兼容性:
          包含:
            枚举:
              - x-powers,axp152
              - x-powers,axp202
              - x-powers,axp209

    那么:
      属性:
        x-powers,drive-vbus-en: false

  - 如果:
      不是:
        属性:
          兼容性:
            包含:
              常量: x-powers,axp806

    那么:
      属性:
        x-powers,self-working-mode: false
        x-powers,master-mode: false

  - 如果:
      不是:
        属性:
          兼容性:
            包含:
              枚举:
                - x-powers,axp15060
                - x-powers,axp305
                - x-powers,axp313a

    那么:
      必需:
        - 中断

  - 如果:
      属性:
        兼容性:
          包含:
            枚举:
              - x-powers,axp313a
              - x-powers,axp15060
              - x-powers,axp717

    那么:
      属性:
        x-powers,dcdc-freq: false

属性:
  兼容性:
    选项之一:
      - 枚举:
          - x-powers,axp152
          - x-powers,axp192
          - x-powers,axp202
          - x-powers,axp209
          - x-powers,axp221
          - x-powers,axp223
          - x-powers,axp313a
          - x-powers,axp717
          - x-powers,axp803
          - x-powers,axp806
          - x-powers,axp809
          - x-powers,axp813
          - x-powers,axp15060
      - 项目:
          - 常量: x-powers,axp228
          - 常量: x-powers,axp221
      - 项目:
          - 常量: x-powers,axp805
          - 常量: x-powers,axp806
      - 项目:
          - 常量: x-powers,axp305
          - 常量: x-powers,axp805
          - 常量: x-powers,axp806
      - 项目:
          - 常量: x-powers,axp818
          - 常量: x-powers,axp813

  reg:
    最大项数: 1

  中断:
    最大项数: 1

  中断控制器: true

  "#中断单元":
    常量: 1

  x-powers,drive-vbus-en:
    类型: 布尔值
    描述: >
      当N_VBUSEN引脚用作输出引脚来控制一个外部调压器以驱动OTG VBus，而非作为一个指示板子是否正在驱动OTG VBus的输入引脚时，设置此项。

  x-powers,self-working-mode:
    类型: 布尔值
    描述: >
      当PMIC通过MODESET引脚连接为自工作模式时，设置此项。

  x-powers,master-mode:
    类型: 布尔值
    描述: >
      当PMIC通过MODESET引脚连接为主模式时，设置此项。

  vin1-supply:
    描述: >
      如果存在的话，DCDC1电源供应节点。

  vin2-supply:
    描述: >
      如果存在的话，DCDC2电源供应节点。

  vin3-supply:
    描述: >
      如果存在的话，DCDC3电源供应节点。

  vin4-supply:
    描述: >
      如果存在的话，DCDC4电源供应节点。

  vin5-supply:
    描述: >
      如果存在的话，DCDC5电源供应节点。

  vin6-supply:
    描述: >
      如果存在的话，DCDC6电源供应节点。

  vin7-supply:
    描述: >
      如果存在的话，DCDC7电源供应节点。
vina-supply:
    description: >
      如果存在，则为 DCDCA 电源供应节点
vinb-supply:
    description: >
      如果存在，则为 DCDCB 电源供应节点
vinc-supply:
    description: >
      如果存在，则为 DCDCC 电源供应节点
vind-supply:
    description: >
      如果存在，则为 DCDCD 电源供应节点
vine-supply:
    description: >
      如果存在，则为 DCDCE 电源供应节点
acin-supply:
    description: >
      如果存在，则为 LDO1 电源供应节点
ldo24in-supply:
    description: >
      如果存在，则为 LDO2 和 LDO4 电源供应节点
ldo3in-supply:
    description: >
      如果存在，则为 LDO3 电源供应节点
ldo5in-supply:
    description: >
      如果存在，则为 LDO5 电源供应节点
aldoin-supply:
    description: >
      如果存在，则为 ALDO* 电源供应节点
以下是提供的英文描述翻译成中文：

bldoin-supply:
    description: >
      如果存在，则为 BLDO* 电源供应节点
cldoin-supply:
    description: >
      如果存在，则为 CLDO* 电源供应节点
dldoin-supply:
    description: >
      如果存在，则为 DLDO* 电源供应节点
eldoin-supply:
    description: >
      如果存在，则为 ELDO* 电源供应节点
fldoin-supply:
    description: >
      如果存在，则为 FLDO* 电源供应节点
ips-supply:
    description: >
      如果存在，则为 LDO_IO0、LDO_IO1 和 RTC_LDO 电源供应节点
drivevbus-supply:
    description: >
      如果存在，则为 DRIVEVBUS 电源供应节点
swin-supply:
    description: >
      如果存在，则为 SW 电源供应节点
adc:
    $ref: /schemas/iio/adc/x-powers,axp209-adc.yaml#

  gpio:
    $ref: /schemas/gpio/x-powers,axp209-gpio.yaml#

  ac-power:
    $ref: /schemas/power/supply/x-powers,axp20x-ac-power-supply.yaml#

  battery-power:
    $ref: /schemas/power/supply/x-powers,axp20x-battery-power-supply.yaml#

  usb-power:
    $ref: /schemas/power/supply/x-powers,axp20x-usb-power-supply.yaml#

  regulators:
    type: object

    properties:
      x-powers,dcdc-freq:
        $ref: /schemas/types.yaml#/definitions/uint32
        description: >
          定义 DC-DC 的工作频率（单位：kHz）
patternProperties:
      "^(([a-f])?ldo[0-9]|dcdc[0-7a-e]|ldo(_|-)io(0|1)|(dc1)?sw|rtc(_|-)ldo|cpusldo|drivevbus|dc5ldo)$":
        $ref: /schemas/regulator/regulator.yaml#
        type: object
        unevaluatedProperties: false

        properties:
          regulator-ramp-delay:
            description: >
              对于 AXP209 上的 DCDC2 和 LDO3 调压器，仅 800 和 1600 是有效的值
The provided text describes device tree bindings for power management ICs (PMICs), specifically for X-Powers PMIC models AXP152 and AXP209. Below is a translation of the given text into simplified Chinese:

### `regulator-soft-start:` 
    描述: >
      仅对 LDO3 稳压器有效。

### `x-powers,dcdc-workmode:`
    $ref: /schemas/types.yaml#/definitions/uint32
    枚举: [0, 1]
    描述: >
      仅对 DCDC 稳压器有效。设置为 1 表示 PWM 模式，0 表示 AUTO (PWM/PFM) 模式。DCDC 稳压器工作在混合的 PWM/PFM 模式下，在轻负载时使用 PFM，在重负载时切换到 PWM。强制使用 PWM 模式以降低输出噪声为代价换取了轻负载下的效率。这可能适用于不受电池限制的高保真音频相关应用。

### additionalProperties: false

### required:
  - compatible
  - reg
  - "#interrupt-cells"
  - interrupt-controller

### additionalProperties: false

### 示例:

#### 示例 1:
```yaml
i2c {
    #address-cells = <1>;
    #size-cells = <0>;

    pmic@30 {
        compatible = "x-powers,axp152";
        reg = <0x30>;
        interrupts = <0>;
        interrupt-controller;
        #interrupt-cells = <1>;
    };
};
```

#### 示例 2:
```yaml
#include <dt-bindings/interrupt-controller/irq.h>

i2c {
    #address-cells = <1>;
    #size-cells = <0>;

    pmic@34 {
        compatible = "x-powers,axp209";
        reg = <0x34>;
        interrupt-parent = <&nmi_intc>;
        interrupts = <0 IRQ_TYPE_LEVEL_LOW>;
        interrupt-controller;
        #interrupt-cells = <1>;

        ac_power_supply: ac-power {
            compatible = "x-powers,axp202-ac-power-supply";
        };

        axp_adc: adc {
            compatible = "x-powers,axp209-adc";
            #io-channel-cells = <1>;
        };

        axp_gpio: gpio {
            compatible = "x-powers,axp209-gpio";
            gpio-controller;
            #gpio-cells = <2>;

            gpio0-adc-pin {
                pins = "GPIO0";
                function = "adc";
            };
        };

        battery_power_supply: battery-power {
            compatible = "x-powers,axp209-battery-power-supply";
        };

        regulators {
            /* Buck 稳压器的默认工作频率 */
            x-powers,dcdc-freq = <1500>;

            reg_dcdc2: dcdc2 {
                regulator-always-on;
                regulator-min-microvolt = <1000000>;
                regulator-max-microvolt = <1450000>;
                regulator-name = "vdd-cpu";
            };

            reg_dcdc3: dcdc3 {
                regulator-always-on;
                regulator-min-microvolt = <1000000>;
                regulator-max-microvolt = <1400000>;
                regulator-name = "vdd-int-dll";
            };

            reg_ldo1: ldo1 {
                /* LDO1 是一个固定输出稳压器 */
                regulator-always-on;
                regulator-min-microvolt = <1300000>;
                regulator-max-microvolt = <1300000>;
                regulator-name = "vdd-rtc";
            };

            reg_ldo2: ldo2 {
                regulator-always-on;
                regulator-min-microvolt = <3000000>;
                regulator-max-microvolt = <3000000>;
                regulator-name = "avcc";
            };

            reg_ldo3: ldo3 {
                regulator-name = "ldo3";
            };

            reg_ldo4: ldo4 {
                regulator-name = "ldo4";
            };

            reg_ldo5: ldo5 {
                regulator-name = "ldo5";
            };
        };

        usb_power_supply: usb-power {
            compatible = "x-powers,axp202-usb-power-supply";
        };
    };
};
```

以上是针对X-Powers PMIC型号AXP152和AXP209的设备树配置示例。
