# SPDX-许可证标识符: GPL-2.0-only
%YAML 1.2
---
$id: http://devicetree.org/schemas/i2c/i2c-mux-gpio.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

标题: 基于GPIO的I2C总线多路复用器

维护者:
  - Wolfram Sang <wsa@kernel.org>

描述: |
  此绑定描述了一个使用GPIO来路由I2C信号的I2C总线多路复用器。
+-----+  +-----+
                                  | 设备 |  | 设备 |
    +------------+                +-----+  +-----+
    | SoC        |                   |        |
    |            |          /--------+--------+
    |   +------+ |  +------+    子总线A，当GPIO值设置为0时
    |   | I2C  |-|--| 多路复用器  |
    |   +------+ |  +--+---+    子总线B，当GPIO值设置为1时
    |            |     |    \----------+--------+--------+
    |   +------+ |     |               |        |        |
    |   | GPIO |-|-----+            +-----+  +-----+  +-----+
    |   +------+ |                  | 设备 |  | 设备 |  | 设备 |
    +------------+                  +-----+  +-----+  +-----+

  对于每个I2C子节点，将创建一个I2C子总线。它们将根据设备树中的顺序进行编号。
每当访问子总线上设备时，将使用GPIO列表输出相关节点reg属性中设置的值，其中列表中的第一个GPIO持有最低有效位的值。
如果定义了空闲状态，使用idle-state（可选）属性，则在不访问子总线上的设备时，GPIO将按照空闲值设置。
如果没有定义空闲状态，则在不访问子总线上的设备时，硬件中将保留最近使用的值。
属性:
  compatible:
    常量: i2c-mux-gpio

  i2c-parent:
    描述: 这个多路复用器主端口连接的I2C总线的phandle
    $ref: /schemas/types.yaml#/definitions/phandle

  mux-gpios:
    描述: 用于控制多路复用器的GPIO列表
    最小项数: 1
    最大项数: 4  # 应该足够

  idle-state:
    描述: 空闲时设置给多路复用器的值。如果没有给出值，默认为上次使用的值
$ref: /schemas/types.yaml#/definitions/uint32

allOf:
  - $ref: i2c-mux.yaml

未评估属性: false

必需:
  - compatible
  - i2c-parent
  - mux-gpios

示例:
  - |
    i2cmux {
      compatible = "i2c-mux-gpio";
      #address-cells = <1>;
      #size-cells = <0>;
      mux-gpios = <&gpio1 22 0>, <&gpio1 23 0>;
      i2c-parent = <&i2c1>;

      i2c@1 {
        reg = <1>;
        #address-cells = <1>;
        #size-cells = <0>;

        ssd1307: oled@3c {
          compatible = "solomon,ssd1307fb-i2c";
          reg = <0x3c>;
          pwms = <&pwm 4 3000>;
          reset-gpios = <&gpio2 7 1>;
        };
      };

      i2c@3 {
        reg = <3>;
        #address-cells = <1>;
        #size-cells = <0>;

        pca9555: pca9555@20 {
          compatible = "nxp,pca9555";
          gpio-controller;
          #gpio-cells = <2>;
          reg = <0x20>;
        };
      };
    };
