# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/fpga/xlnx,fpga-selectmap.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Xilinx SelectMAP FPGA 接口

maintainers:
  - Charles Perry <charles.perry@savoirfairelinux.com>

description: |
  Xilinx 7 系列 FPGAs 支持一种通过名为 SelectMAP 接口的并行端口加载位流的方法。仅支持 x8 模式，其中数据在每个时钟上升沿以一个字节加载，每个字节的最高有效位（MSB）被呈现到 D0 引脚。
Datasheets:
    https://www.xilinx.com/support/documentation/user_guides/ug470_7Series_Config.pdf

allOf:
  - $ref: /schemas/memory-controllers/mc-peripheral-props.yaml#

properties:
  compatible:
    enum:
      - xlnx,fpga-xc7s-selectmap
      - xlnx,fpga-xc7a-selectmap
      - xlnx,fpga-xc7k-selectmap
      - xlnx,fpga-xc7v-selectmap

  reg:
    description:
      至少 1 字节的内存映射 IO
    maxItems: 1

  prog-gpios:
    description:
      配置引脚（在手册中称为 PROGRAM_B）
    maxItems: 1

  done-gpios:
    description:
      配置状态引脚（在手册中称为 DONE）
    maxItems: 1

  init-gpios:
    description:
      初始化状态和配置错误引脚（在手册中称为 INIT_B）
    maxItems: 1

  csi-gpios:
    description:
      芯片选择引脚（在手册中称为 CSI_B）
      如果总线控制器不提供芯片选择，则为可选 GPIO
    maxItems: 1

  rdwr-gpios:
    description:
      读/写选择引脚（在手册中称为 RDWR_B）
      如果总线控制器不提供此引脚，则为可选 GPIO
    maxItems: 1

required:
  - compatible
  - reg
  - prog-gpios
  - done-gpios
  - init-gpios

unevaluatedProperties: false

examples:
  - |
    #include <dt-bindings/gpio/gpio.h>
    fpga-mgr@8000000 {
      compatible = "xlnx,fpga-xc7s-selectmap";
      reg = <0x8000000 0x4>;
      prog-gpios = <&gpio5 5 GPIO_ACTIVE_LOW>;
      init-gpios = <&gpio5 8 GPIO_ACTIVE_LOW>;
      done-gpios = <&gpio2 30 GPIO_ACTIVE_HIGH>;
      csi-gpios = <&gpio3 19 GPIO_ACTIVE_LOW>;
      rdwr-gpios = <&gpio3 10 GPIO_ACTIVE_LOW>;
    };
