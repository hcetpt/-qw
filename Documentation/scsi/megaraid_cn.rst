SPDX 许可证标识符: GPL-2.0

=================================
MegaRAID 统一管理模块
=================================

概述
--------

LSI Logic 的不同类别的控制器接受并响应用户应用程序的方式相似。它们理解相同的固件控制命令。此外，应用程序也可以统一处理不同类别的控制器。因此，有一个单一的模块来与应用程序和所有低级驱动程序交互是合理的。优点显而易见，但为了完整性，还是列出如下：

	i. 避免低级驱动程序中的重复代码
ii. 减轻低级驱动程序导出字符设备节点及其相关处理的负担
iii. 在一个地方实现任何策略机制
iv. 应用程序只需要与一个模块交互，而不是多个低级驱动程序
目前这个模块（称为统一管理模块）仅用于发出 ioctl 命令。但此模块计划处理所有用户空间级别的交互。因此，任何 'proc' 或 'sysfs' 实现都将集中在这个通用模块中。
致谢
-------

::

	“在第三个模块中共享代码，即‘库模块’，是一个可接受的解决方案。modprobe 会自动加载依赖模块，所以用户运行 `modprobe driver1` 或 `modprobe driver2` 时会自动加载共享库模块。”

- Jeff Garzik (jgarzik@pobox.com)，2004年2月25日 LKML

::

	“正如 Jeff 所暗示的，如果你的新 MPT 基于 RAID 控制器与现有的 MegaRAID 驱动之间的用户空间<->驱动API是一致的，那么你可能需要一个小的辅助模块（如 lsiioctl 或其他更好的名称），由 mptraid 和 megaraid 自动加载，该模块负责动态注册 /dev/megaraid 节点。在这种情况下，mptraid 和 megaraid 将为每个发现的适配器向 lsiioctl 注册，而 lsiioctl 实际上将作为一个开关，将用户空间工具的 ioctl 重定向到适当的驱动程序。”

- Matt Domsch (Matt_Domsch@dell.com)，2004年2月25日 LKML

设计
------

统一管理模块实现在 megaraid_mm.[ch] 文件中。此模块作为低级 HBA 驱动程序的注册表。低级驱动程序（目前只有 megaraid）将每个控制器注册到统一模块。应用程序通过模块导出的字符设备节点与统一模块交互。

较低级别的驱动程序现在只理解一种新的改进后的 ioctl 数据包，称为 uioc_t。管理模块将旧应用程序中的旧 ioctl 数据包转换为 uioc_t。在驱动程序处理完 uioc_t 后，统一模块会将其转换回旧格式再返回给应用程序。

随着新应用程序的发展并取代旧的应用程序，旧的数据包格式将会被废弃。
通用模块为每个已注册的控制器分配一个 `uioc_t` 数据包。这很容易超过一个。但由于目前megaraid是唯一的低级驱动程序，且它只能处理一个ioctl，因此没有理由分配更多。但随着新的控制器类别被添加，这一点将会相应地进行调整。
