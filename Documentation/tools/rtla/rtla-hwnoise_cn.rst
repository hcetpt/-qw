SPDX 许可证标识符: GPL-2.0

================
rtla-hwnoise
================
------------------------------------------
检测和量化与硬件相关的噪声
------------------------------------------

:手册章节: 1

概要
========

**rtla hwnoise** [*选项*]

描述
===========

**rtla hwnoise** 收集了在 *interrupts disabled* 模式下运行的 *osnoise* 追踪器的周期性摘要。通过禁用中断，以及由此导致的线程调度，仅允许非屏蔽中断和与硬件相关的噪声。
该工具还允许配置 *osnoise* 追踪器并收集追踪器输出。

选项
=======
.. include:: common_osnoise_options.rst

.. include:: common_top_options.rst

.. include:: common_options.rst

示例
=======
在下面的示例中，**rtla hwnoise** 工具设置为在具有8个核心/16个线程并启用了超线程的系统上运行的CPU *1-7* 上运行。
该工具被设置为检测任何高于 *一微秒* 的噪声，运行 *十分钟* ，并在会话结束时显示报告摘要：

```
# rtla hwnoise -c 1-7 -T 1 -d 10m -q
                                          与硬件相关的噪声
  持续时间:   0 00:10:00 | 时间单位是微秒(us)
  CPU 周期       运行时间        噪声  % CPU 可用   最大噪声   单次最大         硬件         NMI
    1 #599       599000000          138    99.99997           3            3           4           74
    2 #599       599000000           85    99.99998           3            3           4           75
    3 #599       599000000           86    99.99998           4            3           6           75
    4 #599       599000000           81    99.99998           4            4           2           75
    5 #599       599000000           85    99.99998           2            2           2           75
    6 #599       599000000           76    99.99998           2            2           0           75
    7 #599       599000000           77    99.99998           3            3           0           75
```

第一列显示 *CPU*，第二列显示工具在会话期间运行了多少 *周期*。*运行时间* 是工具实际在CPU上运行的时间。*噪声* 列是工具观察到的所有噪声的总和，而 *% CPU 可用* 是 *运行时间* 和 *噪声* 之间的关系。
*最大噪声* 列是工具在单个周期内检测到的最大硬件噪声，而 *单次最大* 是看到的最大单个噪声。
*硬件* 和 *NMI* 列显示工具观察到的 *硬件* 和 *NMI* 噪声发生的总数。
例如，*CPU 3* 在 *1秒运行时间* 下运行了 *599* 个周期。整个执行过程中，CPU收到了 *86 us* 的噪声，留下了 *99.99997 %* 的CPU时间给应用程序。在最糟糕的单个周期中，CPU对应用程序造成了 *4 us* 的噪声，但肯定是由不止一个单一噪声引起的，因为 *单次最大* 噪声是 *3 us*。CPU有 *硬件噪声*，以 *每十分钟六次发生* 的频率。CPU也有 *NMI*，频率更高：大约 *每秒七个*。
理想情况下，该工具应该报告 *0* 与硬件相关的噪声。
例如，通过禁用超线程来消除硬件噪声，并禁用TSC看门狗来消除NMI（可以使用 **rtla hwnoise** 的追踪选项识别这一点），在相同的硬件上可以达到理想情况：

```
# rtla hwnoise -c 1-7 -T 1 -d 10m -q
                                          与硬件相关的噪声
  持续时间:   0 00:10:00 | 时间单位是微秒(us)
  CPU 周期       运行时间        噪声  % CPU 可用   最大噪声   单次最大         硬件         NMI
    1 #599       599000000            0   100.00000           0            0           0            0
    2 #599       599000000            0   100.00000           0            0           0            0
    3 #599       599000000            0   100.00000           0            0           0            0
    4 #599       599000000            0   100.00000           0            0           0            0
    5 #599       599000000            0   100.00000           0            0           0            0
    6 #599       599000000            0   100.00000           0            0           0            0
    7 #599       599000000            0   100.00000           0            0           0            0
```

参考
========

**rtla-osnoise**(1)

Osnoise追踪器文档: <https://www.kernel.org/doc/html/latest/trace/osnoise-tracer.html>

作者
======
由Daniel Bristot de Oliveira <bristot@kernel.org> 编写

.. include:: common_appendix.rst
