===========================
HPE iLO NMI 观察器驱动程序
===========================

适用于基于 iLO 的 ProLiant 服务器
==============================

最后审核日期：2018年8月20日

HPE iLO NMI 观察器驱动程序是一个内核模块，提供基本的观察器功能以及用于处理 iLO “向系统生成 NMI”虚拟按钮的功能。
文档中提到的所有 iLO 都意味着它同样适用于 iLO2 及其后续所有版本。

观察器功能像其他常见的观察器驱动一样被启用。也就是说，需要启动一个应用程序来启动观察器计时器。一个基本的应用程序存在于 `tools/testing/selftests/watchdog/` 中，名为 `watchdog-test.c`。只需编译 C 文件并启动它即可。如果系统进入不良状态并挂起，HPE ProLiant iLO 定时器寄存器将无法及时更新，从而触发硬件系统重置（也称为自动服务器恢复 (ASR)）事件。
`hpwdt` 驱动程序还具有以下模块参数：

 ============  ================================================================
 soft_margin   允许用户设置观察器定时器值
默认值为 30 秒
timeout       `soft_margin` 的别名
pretimeout    允许用户设置观察器预超时值
这是在超时前 NMI 发送到系统的秒数。将此值设置为零会禁用预超时 NMI
默认值为 9 秒
nowayout      基本观察器参数，不允许重启定时器或避免即将到来的 ASR
===============================================================================
默认值在编译内核时设置。如果设置为"Y"，则一旦看门狗启动后就无法禁用。

`kdumptimeout`  在接收到不可屏蔽中断（NMI）后调用panic之前应用的最小时限（秒）。(-1) 禁用看门狗。当该值大于0时，计时器将被重新编程，使用的是该值与当前时限值中较大的一个。

=============  ================================================================

**注意：**
       关于看门狗驱动程序的一般信息，包括对 `/dev/watchdog` 的 ioctl 接口，可以在 `Documentation/watchdog/watchdog-api.rst` 和 `Documentation/driver-api/ipmi.rst` 中找到。

由于 iLO 硬件的限制，如果启用，则 NMI 预时限只能设置为 9 秒。尝试将预时限设置为其他非零值可能会被舍入，甚至可能变为零。用户应在尝试设置预时限或时限后验证预时限值。

从 iLO 接收到 NMI 后，`hpwdt` 驱动程序将引发 panic。这样做的目的是允许收集崩溃转储。用户需要确保系统已经正确配置了 kdump。

Linux 内核在 panic 时的默认行为是打印内核墓碑并无限循环。这通常不是看门狗用户想要的结果。

对于希望了解更多内容的人，请参阅：
	- `Documentation/admin-guide/kdump/kdump.rst`
	- `Documentation/admin-guide/kernel-parameters.txt` （关于 `panic=`）
	- 您所使用的 Linux 发行版的具体文档

如果 `hpwdt` 没有接收到与过期计时器相关的 NMI，iLO 将会在超时后重置系统，除非计时器已被更新。

---

HPE iLO NMI 看门狗驱动程序及其文档最初由 Tom Mingarelli 开发。
