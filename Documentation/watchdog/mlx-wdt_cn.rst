=========================
Mellanox 看门狗驱动程序
=========================

用于基于 x86 的系统交换机
=============================

此驱动程序为各种 Mellanox
以太网和 InfiniBand 交换系统提供了看门狗功能。
Mellanox 看门狗设备是在可编程逻辑器件中实现的。
有两种类型的硬件看门狗实现方式：
类型 1:
  实际的硬件超时时间可以定义为 2 的幂毫秒。
例如，20 秒的超时时间将向上取整到 32768 毫秒。
最长的超时周期是 32 秒（32768 毫秒），
  不支持获取剩余时间。

类型 2:
  实际的硬件超时时间是以秒为单位定义的，并且与
  用户定义的超时时间相同。
最大超时时间为 255 秒。
支持获取剩余时间。

类型 3:
  与类型 2 相同，但具有扩展的最大超时周期。
最大超时时间为 65535 秒。
类型1硬件看门狗（HW）实现在旧系统中存在，
所有新系统都具有类型2硬件看门狗。
两种类型的硬件实现也有不同的寄存器映射。
类型3硬件看门狗实现在所有配备新型编程逻辑设备的Mellanox系统上可能存在。
它通过WD功能位来进行区分。
旧系统仍然只有一个主看门狗。
Mellanox系统可以拥有两个看门狗：主看门狗和辅助看门狗。
主看门狗和辅助看门狗设备可以在同一系统上同时启用。
在看门狗中可以定义几种操作：
系统重置、启动风扇全速运转以及增加寄存器计数器。
最后两种操作无需进行系统重置。
无需重置的操作是为辅助看门狗设备提供的，该设备是可选的。
看门狗可以在探测过程中启动，在这种情况下，用户空间应用程序打开看门狗设备之前，看门狗核心会先对其进行心跳检测。
看门狗可以以不可停止的方式初始化，即一旦启动后就不能停止。
此 mlx-wdt 驱动支持两种硬件看门狗实现方式。
看门狗驱动是由通用的 mlx_platform 驱动进行探测的。
Mlx_platform 驱动为 Mellanox 看门狗设备提供了一套适当的寄存器，标识名称（mlx-wdt-main 或 mlx-wdt-aux），初始超时时间，过期时执行的动作以及配置标志。
看门狗配置标志包括：nowayout 和 start_at_boot，硬件看门狗版本 - type1 或 type2。
在初始化过程中，驱动会检查前一次系统重启是否由看门狗执行。如果是，则会对这一事件做出通知。
对硬件寄存器的访问是通过一个通用的 regmap 接口完成的。
可编程逻辑设备寄存器采用小端字节序。
