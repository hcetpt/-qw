C RM-fixed

(*
 * 结果：从不
 *
 * 这个测试用例展示了传统的“小强旅馆”锁机制，
 * 即代码可以自由地进入临界区，在 Linux 内核中是不可行的。
*)

{
	int x;
	atomic_t y;
}

P0(int *x, atomic_t *y, spinlock_t *lck)
{
	int r2;

	spin_lock(lck);
	r2 = atomic_inc_return(y);
	WRITE_ONCE(*x, 1);
	spin_unlock(lck);
}

P1(int *x, atomic_t *y, spinlock_t *lck)
{
	int r0;
	int r1;
	int r2;

	r0 = READ_ONCE(*x);
	r1 = READ_ONCE(*x);
	spin_lock(lck);
	r2 = atomic_inc_return(y);
	spin_unlock(lck);
}

locations [x;0:r2;1:r0;1:r1;1:r2]
filter (1:r0=0 /\ 1:r1=1)
exists (1:r2=1)
