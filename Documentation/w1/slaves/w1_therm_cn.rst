核心驱动程序 w1_therm
======================

支持的芯片：

  * 基于 Maxim ds18*20 的温度传感器
* 基于 Maxim ds1825 的温度传感器
* GXCAS GX20MH01 温度传感器
* Maxim MAX31850 热电偶接口
作者: Evgeniy Polyakov <johnpol@2ka.mipt.ru>

描述
-----------

w1_therm 为 ds18*20、ds28ea00、GX20MH01 和 MAX31850 设备提供基本的温度转换功能。
支持的家庭代码：

====================	====
W1_THERM_DS18S20	0x10
W1_THERM_DS1822		0x22
W1_THERM_DS18B20	0x28
W1_THERM_DS1825		0x3B
W1_THERM_DS28EA00	0x42
====================	====

支持是通过 sysfs 入口 `w1_slave` 提供的。每次打开和读取序列将启动温度转换，然后提供两行 ASCII 输出。第一行包含读取的九个十六进制字节以及计算出的 CRC 值和匹配结果（YES 或 NO）。如果 CRC 匹配，返回的值将被保留。第二行显示保留的值以及以毫度摄氏度表示的温度，在 t= 后面。
或者，可以使用 `temperature` sysfs 读取温度，它仅返回以毫度摄氏度表示的温度。
可以通过在 w1_bus_master 级别向 `therm_bulk_read` 入口写入 `trigger` 来批量读取总线上的所有设备。这将向总线上的所有设备发送转换命令，并且如果检测到总线上的寄生供电设备（并且模块中启用了强上拉），它将在寄生供电设备所需的更长转换时间内使线路保持高电平。读取 `therm_bulk_read` 将返回 0 表示没有待处理的批量转换，-1 表示至少一个传感器仍在转换中，1 表示转换已完成但至少一个传感器值尚未读取。然后通过读取每个设备的 `temperature` 入口来访问结果温度，如果转换仍在进行中，则可能返回空。请注意，如果发送了批量读取命令，但未立即读取一个传感器，则下次访问该设备的 `temperature` 时将返回在发出批量读取命令时测量的温度（而非当前温度）。
如果需要，将在转换期间应用强上拉。
``conv_time`` 用于获取当前转换时间（读取），并调整它（写入）。温度转换时间取决于设备类型及其当前分辨率。默认的转换时间由驱动程序根据设备数据表设定。许多原始设备克隆的转换时间与数据表规格存在偏差。有三种选项：1）通过向 ``conv_time`` 写入毫秒值手动设置正确的转换时间；2）通过向 ``conv_time`` 写入 ``1`` 自动测量并设置转换时间；3）使用 ``features`` 启用轮询以完成转换。选项2和3在寄生电源模式下无法使用。要恢复到默认转换时间，请向 ``conv_time`` 写入 ``0``。
向 ``w1_slave`` 写入分辨率值（以位为单位）将改变传感器下次读数的精度。允许的分辨率由传感器定义。当传感器经历电源循环时，分辨率会被重置。
为了在EEPROM中存储当前分辨率，向 ``w1_slave`` 写入 ``0``。由于EEPROM的写入次数有限（>5万次），此命令应谨慎使用。
或者，如果传感器支持，可以使用每个设备上的专用 ``resolution`` 条目来读取或写入分辨率。
一些非原装DS18B20芯片仅固定在12位模式下，因此实际分辨率从芯片读回并验证。
注意：更改分辨率会使转换时间恢复到默认值。
只写入的sysfs条目 ``eeprom_cmd`` 是EEPROM操作的另一种选择。
写入 ``save`` 将设备RAM保存到EEPROM。写入 ``restore`` 将EEPROM数据恢复到设备RAM中。
``ext_power`` 条目允许检查每个设备的电源状态。如果设备处于寄生供电状态，则读取 ``0``；如果设备外部供电，则读取 ``1``。
Sysfs中的"alarms"允许读取或写入TH和TL（温度高和低）报警值。数值应为空格分隔，并在设备范围内（通常为-55摄氏度到125摄氏度）。数值为整数，因为它们存储在设备的8位寄存器中。最低值会自动设置为TL。一旦设置，报警值可以在主控级别进行查找。

模块参数strong_pullup可以设置为0以禁用强上拉，设置为1以启用自动检测，或者设置为2以强制启用强上拉。在自动检测的情况下，驱动程序将使用"READ POWER SUPPLY"命令来检查总线上是否有寄生供电设备。如果存在，它将激活主控的强上拉。在使用该命令检测寄生设备失败的情况下（似乎某些DS18S20会出现这种情况），可以强制启用强上拉。

如果启用了强上拉，在转换过程中，只要主控驱动支持强上拉（否则退回到上拉电阻），主控的强上拉将被驱动。DS18b20温度传感器规格表列出的最大电流消耗为1.5mA，并指出5k上拉电阻是不够的。强上拉设计用于提供所需的额外电流。

DS28EA00提供了额外的两个引脚，用于实现序列检测算法。此功能使您能够在无需预先了解总线排序的情况下确定芯片在1线总线上的物理位置。通过sysfs中的"w1_seq"提供了支持。文件将包含一行带有整数值的内容，表示从0开始的总线上的设备索引。

"features" sysfs条目控制每个设备的可选驱动程序设置。寄生模式下电源不足、线路噪声和转换时间不足可能导致转换失败。原始的DS18B20和一些克隆版本允许检测无效转换。向"features"写入位掩码"1"以启用转换成功的检查。如果转换后暂存区内存的第6字节为0xC，并且温度读数为85.00（上电值）或127.94（电源不足），则驱动程序将返回转换错误。位掩码"2"启用通过在转换开始后在总线上生成读周期来轮询转换完成（仅限正常供电）。在寄生电源模式下，此功能不可用。
特性位掩码可以进行组合（或操作）。更多细节请参阅
Documentation/ABI/testing/sysfs-driver-w1_therm

GX20MH01设备与DS18*20共享家族编号0x28。该设备通常
与DS18B20兼容。在配置寄存器中增加了最低的2^-5、2^-6温度
位；配置寄存器中的R2位支持13和14位分辨率。设备上电时处于14位分辨率模式。数据手册中规定的转换时间过低，需要增加。该设备支持驱动特性“1”和“2”
MAX31850设备与DS1825共享家族编号0x3B。该设备通常
与DS1825兼容。配置寄存器的高4位读取全为1，
表示为15，但设备始终运行在14位分辨率模式下。

简而言之，这段英文描述了两种热敏设备GX20MH01和MAX31850与它们各自兼容设备（DS18B20和DS1825）的相似之处以及不同之处。GX20MH01设备增加了额外的温度精度，并且默认以14位分辨率运行。而MAX31850设备虽然其配置寄存器的高四位显示为15，但实际上它一直工作在14位分辨率模式下。同时，GX20MH01设备还支持特定的驱动特性“1”和“2”。
