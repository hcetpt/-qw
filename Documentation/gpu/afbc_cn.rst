SPDX 许可证标识符: GPL-2.0+

===================================
Arm 帧缓冲压缩 (AFBC)
===================================

AFBC 是一种专有的无损图像压缩协议和格式。
它提供了细粒度的随机访问，并最小化了 IP 模块之间传输的数据量。
AFBC 可以通过使用在 drm_fourcc.h 中定义的 AFBC 格式修饰符来启用支持它的驱动程序。参见 DRM_FORMAT_MOD_ARM_AFBC(*)。
所有使用 AFBC 修饰符的用户必须遵循本文档中规定的使用指南，以确保跨不同的 AFBC 生产者和消费者的兼容性。

组件和顺序
=======================

AFBC 流可以包含多个组件——其中组件对应于一个颜色通道（例如 R、G、B、X、A、Y、Cb、Cr）。
编码器和解码器之间的输入/输出颜色通道分配必须一致，否则消费者将错误地解释解码后的数据。
此外，当使用无损颜色空间变换时（AFBC_FORMAT_MOD_YTR，这应该在 RGB 缓冲区上启用以获得最大的压缩效率），组件顺序必须为：

* 组件 0：R
* 组件 1：G
* 组件 2：B

组件顺序是通过 fourcc 代码在 fourcc:modifier 对中传递的。通常情况下，组件“0”被认为位于相应线性格式的最低有效位中。例如，COMP(bits)：

* DRM_FORMAT_ABGR8888

  * 组件 0：R(8)
  * 组件 1：G(8)
  * 组件 2：B(8)
  * 组件 3：A(8)

* DRM_FORMAT_BGR888

  * 组件 0：R(8)
  * 组件 1：G(8)
  * 组件 2：B(8)

* DRM_FORMAT_YUYV

  * 组件 0：Y(8)
  * 组件 1：Cb(8, 2x1 下采样)
  * 组件 2：Cr(8, 2x1 下采样)

在 AFBC 中，“X”组件与其他任何组件没有区别。因此，具有 fourcc DRM_FORMAT_XBGR8888 的 AFBC 缓冲区有 4 个组件，如下所示：

* DRM_FORMAT_XBGR8888

  * 组件 0：R(8)
  * 组件 1：G(8)
  * 组件 2：B(8)
  * 组件 3：X(8)

请注意，然而，包含“浪费”的“X”通道不利于压缩效率，因此建议避免使用包含“X”位的格式。如果编码器/解码器需要/期望第四个组件，则建议改用等效的带有 alpha 的格式，将所有 alpha 位设置为“1”。如果没有对第四个组件的要求，则可以使用不包括 alpha 的格式，例如 DRM_FORMAT_BGR888。

平面数量
================

通常在线性布局中是多平面的格式（例如 YUV 420），可以被编码成一个或多个 AFBC 平面。与组件顺序一样，编码器和解码器必须就平面数量达成一致才能正确解码缓冲区。fourcc 代码用于确定 AFBC 缓冲区中的编码平面数量，与线性（未修改的）格式的平面数量相匹配。
每个平面内的组件顺序也遵循 fourcc 代码：

例如：

* DRM_FORMAT_YUYV: nplanes = 1

  * 平面 0：

    * 组件 0：Y(8)
    * 组件 1：Cb(8, 2x1 下采样)
    * 组件 2：Cr(8, 2x1 下采样)

* DRM_FORMAT_NV12: nplanes = 2

  * 平面 0：

    * 组件 0：Y(8)

  * 平面 1：

    * 组件 0：Cb(8, 2x1 下采样)
    * 组件 1：Cr(8, 2x1 下采样)

跨设备互操作性
=============================

为了最大限度地提高跨设备的兼容性，下表定义了 AFBC 启用设备之间使用的规范格式。此处列出的格式在使用 AFBC 修饰符时必须严格按照指定的方式使用。未列出的格式应避免使用。
.. flat-table:: AFBC 格式

   * - Fourcc 代码
     - 描述
     - 平面/组件

   * - DRM_FORMAT_ABGR2101010
     - 10 位每组件 RGB，带 2 位 alpha
     - 平面 0：4 个组件
              * 组件 0：R(10)
              * 组件 1：G(10)
              * 组件 2：B(10)
              * 组件 3：A(2)

   * - DRM_FORMAT_ABGR8888
     - 8 位每组件 RGB，带 8 位 alpha
     - 平面 0：4 个组件
              * 组件 0：R(8)
              * 组件 1：G(8)
              * 组件 2：B(8)
              * 组件 3：A(8)

   * - DRM_FORMAT_BGR888
     - 8 位每组件 RGB
     - 平面 0：3 个组件
              * 组件 0：R(8)
              * 组件 1：G(8)
              * 组件 2：B(8)

   * - DRM_FORMAT_BGR565
     - 5/6 位每组件 RGB
     - 平面 0：3 个组件
              * 组件 0：R(5)
              * 组件 1：G(6)
              * 组件 2：B(5)

   * - DRM_FORMAT_ABGR1555
     - 5 位每组件 RGB，带 1 位 alpha
     - 平面 0：4 个组件
              * 组件 0：R(5)
              * 组件 1：G(5)
              * 组件 2：B(5)
              * 组件 3：A(1)

   * - DRM_FORMAT_VUY888
     - 8 位每组件 YCbCr 444，单平面
     - 平面 0：3 个组件
              * 组件 0：Y(8)
              * 组件 1：Cb(8)
              * 组件 2：Cr(8)

   * - DRM_FORMAT_VUY101010
     - 10 位每组件 YCbCr 444，单平面
     - 平面 0：3 个组件
              * 组件 0：Y(10)
              * 组件 1：Cb(10)
              * 组件 2：Cr(10)

   * - DRM_FORMAT_YUYV
     - 8 位每组件 YCbCr 422，单平面
     - 平面 0：3 个组件
              * 组件 0：Y(8)
              * 组件 1：Cb(8, 2x1 下采样)
              * 组件 2：Cr(8, 2x1 下采样)

   * - DRM_FORMAT_NV16
     - 8 位每组件 YCbCr 422，双平面
     - 平面 0：1 个组件
              * 组件 0：Y(8)
       平面 1：2 个组件
              * 组件 0：Cb(8, 2x1 下采样)
              * 组件 1：Cr(8, 2x1 下采样)

   * - DRM_FORMAT_Y210
     - 10 位每组件 YCbCr 422，单平面
     - 平面 0：3 个组件
              * 组件 0：Y(10)
              * 组件 1：Cb(10, 2x1 下采样)
              * 组件 2：Cr(10, 2x1 下采样)

   * - DRM_FORMAT_P210
     - 10 位每组件 YCbCr 422，双平面
     - 平面 0：1 个组件
              * 组件 0：Y(10)
       平面 1：2 个组件
              * 组件 0：Cb(10, 2x1 下采样)
              * 组件 1：Cr(10, 2x1 下采样)

   * - DRM_FORMAT_YUV420_8BIT
     - 8 位每组件 YCbCr 420，单平面
     - 平面 0：3 个组件
              * 组件 0：Y(8)
              * 组件 1：Cb(8, 2x2 下采样)
              * 组件 2：Cr(8, 2x2 下采样)

   * - DRM_FORMAT_YUV420_10BIT
     - 10 位每组件 YCbCr 420，单平面
     - 平面 0：3 个组件
              * 组件 0：Y(10)
              * 组件 1：Cb(10, 2x2 下采样)
              * 组件 2：Cr(10, 2x2 下采样)

   * - DRM_FORMAT_NV12
     - 8 位每组件 YCbCr 420，双平面
     - 平面 0：1 个组件
              * 组件 0：Y(8)
       平面 1：2 个组件
              * 组件 0：Cb(8, 2x2 下采样)
              * 组件 1：Cr(8, 2x2 下采样)

   * - DRM_FORMAT_P010
     - 10 位每组件 YCbCr 420，双平面
     - 平面 0：1 个组件
              * 组件 0：Y(10)
       平面 1：2 个组件
              * 组件 0：Cb(10, 2x2 下采样)
              * 组件 1：Cr(10, 2x2 下采样)
