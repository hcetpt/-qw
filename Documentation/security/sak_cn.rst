==============================
Linux 安全关注键 (SAK) 处理
==============================

:日期: 2001 年 3 月 18 日
:作者: Andrew Morton

操作系统中的安全关注键（Secure Attention Key，简称 SAK）是一种安全工具，它提供了针对特洛伊木马密码捕获程序的保护。这是一种无法被规避的方式来终止所有可能冒充登录应用程序的进程。用户需要学会在登录系统前输入这个键序列。

从个人电脑键盘来说，Linux 提供了两种类似但不同的方式来提供 SAK 功能。一种是 ALT-SYSRQ-K 序列。你不应该使用这个序列，因为它只有在内核编译时包含了 sysrq 支持的情况下才可用。
生成 SAK 的正确方法是使用 `loadkeys` 命令定义键序列。这无论内核是否编译了 sysrq 支持都会起作用。
SAK 在键盘处于原始模式时工作正常。这意味着一旦定义后，SAK 将会终止运行中的 X 服务器。如果系统处于运行级别 5，则 X 服务器将会重启。这就是你希望发生的情况。
你应该使用什么键序列呢？嗯，CTRL-ALT-DEL 用于重启机器。CTRL-ALT-BACKSPACE 对 X 服务器有特殊意义。我们将选择 CTRL-ALT-PAUSE。
在你的 rc.sysinit（或 rc.local）文件中添加以下命令：

```shell
echo "control alt keycode 101 = SAK" | /bin/loadkeys
```

就这样！只有超级用户可以重新编程 SAK 键。
.. note:: 

  1. 据说 Linux 的 SAK 不是真正意义上的 SAK，因为某些实现了 C2 级别安全性的系统要求的 SAK 更为严格。本作者并不知道具体原因。
  2. 在个人电脑键盘上，SAK 会终止所有打开了 `/dev/console` 的应用。
不幸的是，这包括了一些你实际上不希望被终止的应用。这是因为这些应用错误地保持着 `/dev/console` 的打开状态。一定要向你的 Linux 发行版厂商反馈这个问题！

你可以通过以下命令来识别会被 SAK 终止的进程：

```shell
# ls -l /proc/[0-9]*/fd/* | grep console
l-wx------    1 root     root           64 Mar 18 00:46 /proc/579/fd/0 -> /dev/console
```

然后：

```shell
# ps aux|grep 579
root       579  0.0  0.1  1088  436 ?        S    00:43   0:00 gpm -t ps/2
```

所以 `gpm` 将会被 SAK 终止。这是一个 gpm 的 bug。它应当关闭标准输入。你可以通过找到启动 gpm 的初始化脚本，并做如下修改来解决这个问题：

旧的：

```shell
daemon gpm
```

新的：

```shell
daemon gpm < /dev/null
```

Vixie cron 似乎也有同样的问题，需要进行相同的处理。
另外，一个著名的 Linux 发行版在其 rc.sysinit 和 rc 脚本中有以下三行代码：

```shell
exec 3<&0
exec 4>&1
exec 5>&2
```

这些命令导致 **所有** 由初始化脚本启动的守护进程都将文件描述符 3、4 和 5 与 `/dev/console` 相关联。因此 SAK 会将它们全部终止。一个解决方案是简单地删除这些行，但这可能会导致一些系统管理应用程序出现故障——请充分测试所有功能。
您没有提供需要翻译的文本。请提供需要翻译成中文的英文或其他语言的文本。
