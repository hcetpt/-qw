关于Linux -stable版本，你可能想知道的一切
=================================================

关于哪些补丁可以被接受，哪些不能被接受进入"-stable"树的规则如下：

- 补丁或其等效修复必须已经存在于Linux主线（上游）
- 补丁必须明显正确且经过测试
- 补丁不能超过100行代码，包括上下文
- 必须遵循
  :ref:`Documentation/process/submitting-patches.rst <submittingpatches>`
  的规定
- 补丁必须解决实际困扰用户的bug，或者仅仅添加设备ID
为了更详细地解释前者：

  - 它修复了如oops、挂起、数据损坏、真正的安全问题、硬件特性、构建错误（但不包括标记为CONFIG_BROKEN的问题），或一些“哦，这不好”的问题
- 分发内核用户报告的严重问题，如果它们修复了显著的性能或交互性问题，也可能被考虑
由于这些修复不像其他那样显而易见，且有更高的隐性回归风险，它们应该仅由分发内核维护者提交，并包含补充信息链接至Bugzilla条目（如果存在）以及关于用户可见影响的附加信息
- 不接受“这可能是个问题...”类型的事情，例如“理论上的竞态条件”，除非同时提供了如何利用该bug的解释
- 不接受对用户没有益处的“微不足道”的修复（如拼写更改、空白清理等）

以上是关于Linux稳定版补丁接受规则的详细说明。
向-stable树提交补丁的流程
----------------------------------------------------

.. note::

   安全补丁不应仅通过-stable审查流程处理，而应遵循
   :ref:`Documentation/process/security-bugs.rst <securitybugs>` 中的程序。
有三种方式可以向-stable树提交变更：

1. 在您提交主线合并的补丁描述中添加“稳定标签”
2. 请求稳定团队采纳已经合并到主线的补丁
3. 向稳定团队提交与已合并到主线的变更等效的补丁
下面的各节将详细介绍每种选项。
:ref:`option_1` 是**强烈**推荐的方式，它既最简单也是最常见的。
:ref:`option_2` 主要适用于在提交时未考虑回退的情况。
:ref:`option_3` 是对前两种方式的补充，适用于需要对已合并到主线的补丁进行调整以适应较老版本（例如，由于API变更）的情况。
当使用选项2或3时，您可以请求将您的变更包含在特定的稳定系列中。这样做时，请确保修复或其等效方案适用于所有受支持的新版本稳定树、已被提交或者已经存在于其中。这是为了避免用户在更新后可能遇到的回归问题，例如，如果为5.19-rc1合并的一个修复被回退到了5.10.y，但没有回退到5.15.y。
.. _option_1:

选项1
********

为了使您提交给主线合并的补丁能够自动被-stable树采纳，请在签名区域添加以下标签：

```
Cc: stable@vger.kernel.org
```

如果您是在修复未公开的安全漏洞，请改用 ``Cc: stable@kernel.org``：这可以减少通过 `git send-email` 不经意地将修复暴露给公众的风险，因为发送至该地址的邮件不会被投递到任何地方。
一旦补丁被合并到主线，无需作者或子系统维护者做任何其他操作，它就会被应用于-stable树。
为了向稳定团队发送额外的指示，请使用类似shell风格的内联注释来传递任意或预定义的备注：

* 指定用于选择性合并的额外补丁先决条件::

    抄送: <stable@vger.kernel.org> # 3.3.x: a1f84a3: 调度：检查是否空闲
    抄送: <stable@vger.kernel.org> # 3.3.x: 1b9508f: 调度：限制新空闲任务的速率
    抄送: <stable@vger.kernel.org> # 3.3.x: fd21073: 调度：修复亲和力逻辑
    抄送: <stable@vger.kernel.org> # 3.3.x
    签名确认: Ingo Molnar <mingo@elte.hu>

  标签序列的意义在于::

    git cherry-pick a1f84a3
    git cherry-pick 1b9508f
    git cherry-pick fd21073
    git cherry-pick <此提交>

  注意，对于补丁系列，你不必列出该系列中已存在的补丁作为先决条件。例如，如果你有以下补丁系列::

    补丁1
    补丁2

  其中补丁2依赖于补丁1，如果你已经标记补丁1为稳定版包含，则无需将补丁1列为补丁2的先决条件。
* 指出内核版本先决条件::

    抄送: <stable@vger.kernel.org> # 3.3.x

  标签的意义在于::

    git cherry-pick <此提交>

  对于每个从指定版本开始的“-stable”树
注意，如果稳定团队可以从Fixes:标签推导出适当版本，则此类标记是不必要的。
* 延迟补丁的选择::

    抄送: <stable@vger.kernel.org> # 在-rc3之后

* 指出已知问题::

    抄送: <stable@vger.kernel.org> # 参见补丁描述，需要对<= 6.3进行调整

此外，还有一个稳定的标签变体，你可以用来让稳定团队的反向移植工具（如AUTOSEL或查找包含'Fixes:'标签的提交的脚本）忽略一个更改::

     抄送: <stable+noautosel@kernel.org> # 原因写在这里，并且必须存在

.. _option_2:

选项2
******

如果补丁已经被合并到主线，向stable@vger.kernel.org发送一封电子邮件，包含补丁的主题、提交ID、你认为它应该被应用的原因以及你希望它被应用到的内核版本
.. _option_3:

选项3
******

在确认遵循上述规则后，将补丁发送给stable@vger.kernel.org，并提及你希望其被应用的内核版本。在这样做时，你必须在提交的变更日志中注明上游提交ID，位于提交文本上方的单独行，如下所示::

  提交 <sha1> 上游
或者可选地::

  [ 上游提交 <sha1> ]

如果提交的补丁与原始上游补丁有所不同（例如，因为它必须针对旧API进行调整），则必须在补丁描述中非常清楚地记录并说明理由。

提交后的跟进
------------------

当补丁被接受进入队列时，发件人将收到ACK，如果补丁被拒绝，则会收到NAK。根据稳定团队成员的日程安排，这个响应可能需要几天时间。
如果被接受，补丁将被添加到-stable队列中，以供其他开发者和相关子系统维护者审查。

审查周期
------------

- 当-stable维护者决定进行审查周期时，补丁将被发送给审查委员会，以及受影响区域的补丁维护者（除非提交者本身就是该区域的维护者），并抄送给linux-kernel邮件列表。
- 审查委员会有48小时的时间来ACK或NAK该补丁。
- 如果委员会成员拒绝了补丁，或者 linux-kernel 成员对补丁提出异议，指出了维护者和成员未曾意识到的问题，该补丁将从队列中移除。
- 已确认（ACKed）的补丁将作为候选版本（-rc）的一部分再次发布，供开发者和测试人员进行测试。
- 通常只发布一个 -rc 版本，但如果存在未解决的问题，某些补丁可能需要修改或删除，或者额外的补丁可能会加入队列。随后会发布并测试更多的 -rc 版本，直到没有发现任何问题为止。
- 对于 -rc 版本的反馈可以通过邮件列表发送带有 "Tested-by:" 的邮件来完成，并附上想要提供的任何测试信息。“Tested-by:” 标签将会被收集并添加到版本提交中。
- 在审查周期结束时，包含所有已排队和测试过的补丁的新 -stable 版本将被发布。
- 安全补丁将直接由安全内核团队提交到 -stable 分支，而不经过常规的审查流程。有关此程序的更多详情，请联系内核安全团队。
- 队列
-----

- 已完成版本和在开发中的版本的补丁队列可以在以下位置找到：

    https://git.kernel.org/pub/scm/linux/kernel/git/stable/stable-queue.git

- 所有稳定内核版本的最终和标记发布的分支可以在以下位置找到：

    https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git

- 所有稳定内核版本的候选版本可以在此处找到：

    https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable-rc.git/

  .. warning::
     -stable-rc 分支是稳定队列树的一个时间点快照，并且会频繁变化，因此会被经常重置基础。它仅应用于测试目的（例如，被持续集成系统使用）。
- 审查委员会
----------------

- 审查委员会由志愿承担此任务的一些内核开发者组成，还包括少数未志愿但被纳入其中的人。
