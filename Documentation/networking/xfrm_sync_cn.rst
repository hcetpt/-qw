.. SPDX-License-Identifier: GPL-2.0

====
XFRM
====

同步补丁的工作基于初始补丁提供者 Krisztian <hidden@balabit.hu> 和其他人的工作，以及来自 Jamal <hadi@cyberus.ca> 的额外补丁。
同步的最终目标是能够插入属性并生成事件，以便安全地将安全关联（SA）从一台机器迁移到另一台机器，实现高可用性（HA）目的。
同步SA的目的是使得接管机器在访问到SA时可以尽可能准确地处理SA。
我们已经有能力生成SA添加/删除/更新事件。
这些补丁增加了同步功能，并确保了准确的生命周期字节计数（以确保SA的正确衰减）和重放计数器，以避免在故障转移时发生重放攻击，尽量减少数据丢失。
通过这种方式，备份机可以尽可能实时地与活动成员保持一致。
由于上述项目在每次收到数据包时都会发生变化，因此可能会生成大量的事件。
为此，我们也增加了一个类似Nagle的算法来限制事件。也就是说，我们将设置阈值，比如“如果达到重放序列阈值或已过10秒，请通知我”。
这些阈值可以通过sysctls在整个系统范围内设置，或者按每个SA进行更新。
需要同步的项目包括：
- 生命周期字节计数
注意：如果假设故障转移机器是事先已知的，则生命周期时间限制并不重要，因为时间倒计时的衰减不是由数据包到达驱动的。
- 双向的重放序列

1) 消息结构
----------------------
nlmsghdr: aevent_id: optional-TLVs
