SPDX许可证标识符: GPL-2.0

=============================================================================
Linux 和 3Com EtherLink III 系列以太网卡（驱动程序版本 1.18c 及以上）
=============================================================================

此文件包含有关 3c509 驱动程序版本 1.18c 及更高版本的说明和注意事项。在使用该驱动程序之前，请务必阅读此文件。
发布 1.0

2002年2月28日

当前维护者（更正至）:
  David Ruggiero <jdr@farfalle.com>

介绍
============

以下是在 Linux 中使用 3Com EtherLink III 系列以太网卡的说明和信息。这些卡通常以其最广泛使用的型号，即 3Com 的 3c509 而为人所知。它们都是 10Mbps 的 ISA 总线卡，并不应与同样编号的 PCI 总线“3c905”系列（也称为“Vortex”或“Boomerang”）混淆。内核对 3c509 家族的支持由模块 3c509.c 提供，该模块支持以下所有型号：

 - 3c509（原始 ISA 卡）
 - 3c509B（ISA 卡的后续版本；支持全双工模式）
 - 3c589（PCMCIA 卡）
 - 3c589B（3c589 的后续版本；支持全双工模式）
 - 3c579（EISA 卡）

本文档的大部分内容借鉴自最初作者 Donald Becker 编写的指南。该文档的主副本，其中包含有关旧版驱动程序的注释，目前存放在 Scyld 网站：http://www.scyld.com/

特殊驱动功能
=======================

覆盖卡设置

该驱动程序允许在启动或加载时覆盖检测到的 IOADDR、IRQ 和收发器设置，尽管通常情况下除了启用全双工模式外（见下文），这一功能并不需要。以下是通过 LILO 参数实现此功能的语法示例：

    ether=10,0x310,3,0x3c509,eth0

这将为找到的第一个 3c509 卡配置 IRQ 10、基本 I/O 地址 0x310 和收发器类型 3（10base2）。标志“0x3c509”必须设置以避免与其他卡类型的冲突。当驱动程序作为模块加载时，只能覆盖 IRQ。例如，将两张卡分别设置为 IRQ 10 和 IRQ 11 可以使用 irq 模块选项：

   options 3c509 irq=10,11

全双工模式
================

版本 1.18c 的驱动程序增加了对 3c509B 全双工功能的支持。为了启用并成功使用全双工模式，必须满足三个条件：

(a) 您必须拥有一张硬件支持全双工操作的 Etherlink III 卡型号。目前，已知支持全双工的 3c509 家族成员只有 3c509B（ISA 总线）和 3c589B（PCMCIA 卡）。没有“B”型号标识的卡不支持全双工模式，包括原始 3c509（无“B”）、原始 3c589、3c529（MCA 总线）和 3c579（EISA 总线）。
(b) 您必须使用卡上的 10baseT 收发器（即 RJ-45 连接器），而不是其 AUI（粗缆）或 10base2（细缆/同轴电缆）接口。AUI 和 10base2 网络电缆物理上无法支持全双工操作。
(c) 最重要的是，您的 3c509B 必须连接到一个本身支持全双工的链路伙伴。这通常是两件事之一：一个支持全双工的以太网交换机（不是集线器），或者另一个系统上通过交叉电缆直接连接到 3c509B 的支持全双工的 NIC。

可以通过 `ethtool` 启用全双工模式。
.. 注意:: 

  关于全双工模式的重要警告

  请理解，3c509B 的硬件全双工支持比现代网络接口卡提供的支持要有限得多。虽然在网络的物理层上它完全支持全双工操作，但该卡设计于当前以太网自动协商（N-way）规范制定之前。这意味着 3c509B 家族在任何情况下都无法与链路伙伴进行全双工自动协商，无论如何初始化都不会自动协商。如果启用了 3c509B 的全双工模式，则其链路伙伴可能也需要独立地强制进入全双工模式；否则将会出现各种严重故障——至少会看到大量的数据包碰撞。这是极少数需要禁用自动协商并强制网络接口卡或交换机的双工模式的情况之一。

可用的收发器类型
===========================

对于版本 1.18c 及以上的驱动程序，可用的收发器类型如下：

== =========================================================================
0  从 EEPROM 配置中读取的收发器类型（通常是 10baseT）；强制半双工模式
1  AUI（粗缆 / DB15 连接器）
2  （未定义）
3  10base2（细缆 == 同轴电缆 / BNC 连接器）
4  10baseT（RJ-45 连接器）；强制半双工模式
8  从卡的 EEPROM 配置设置中读取收发器类型和双工模式
12 10baseT（RJ-45 连接器）；强制全双工模式
== =========================================================================

在驱动程序版本 1.18c 之前，仅支持收发器代码 0-4。请注意，新的收发器代码 8 和 12 是唯一可以启用全双工模式的代码，无论卡检测到的 EEPROM 设置如何。
这确保了仅仅从早期版本升级驱动程序永远不会自动在现有安装中启用全双工模式；必须始终通过这些代码之一显式启用才能激活。

可以使用 `ethtool` 更改收发器类型。

错误信息和常见问题
-------------------

### 错误信息
^^^^^^^^^^^^^^

**eth0: 中断中的无限循环，状态 2011**

这是“基本上无害”的消息，表示驱动程序在该中断周期中有太多工作。状态为 0x2011 表示接收数据包的速度快于它们可以从网卡中移除的速度。这种情况在正常操作中应该是罕见或不可能的。此错误报告的可能原因包括：

- 启用了“绿色”模式，当没有键盘活动时会减慢处理器速度。
- 其他设备或设备驱动程序占用总线或禁用中断。

检查 `/proc/interrupts` 文件以查看中断计数是否过多。定时器中断应该始终比其他中断递增得更快。

**没有接收到的数据包**
^^^^^^^^^^^^^^^^^^^

如果 3c509、3c562 或 3c589 能够成功发送数据包但从未接收数据包（如 `/proc/net/dev` 或 `ifconfig` 所报告），你可能遇到了中断线问题。检查 `/proc/interrupts` 以确认网卡实际生成了中断。如果中断计数没有增加，则可能是两个设备尝试使用相同的 ISA IRQ 线导致了物理冲突。常见的冲突是与 IRQ10 或 IRQ5 上的声卡发生冲突，最简单的解决方法是将 3c509 移动到不同的中断线上。如果设备接收数据包但 `ping` 不起作用，则你有一个路由问题。

**/proc/net/dev 中报告的 Tx Carrier 错误**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

如果 EtherLink III 显然在发送数据包，但 `/proc/net/dev` 中的 “Tx carrier errors” 字段与发送的数据包计数一样快速递增，你可能有一个未终止的网络或选择了不正确的媒体收发器。

**3c509B 卡在具有 ISA PnP BIOS 的机器上未被检测到**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

虽然更新后的驱动程序支持大多数 PnP BIOS 程序，但它并不支持所有程序。可以通过使用 3Com 提供的设置程序禁用 PnP 支持来修复这个问题。
3c509 网卡在超频机器上未被检测到

增加 `id_read_eeprom()` 中的延迟时间，从当前值 500 增加到一个非常高的值，例如 5000。

解码状态和错误信息
-------------------

主状态寄存器中的位定义如下：

=====	======================================
值       描述
=====	======================================
0x01     中断锁存
0x02     发送溢出或接收欠溢出
0x04     发送完成
0x08     发送 FIFO 有可用空间
0x10     接收到一个完整的接收数据包
0x20     开始接收到一个数据包
0x40     驱动程序请求中断
0x80     统计计数器接近满
=====	======================================

发送（Tx）状态字中的位定义如下：

=====	============================================
值       描述
=====	============================================
0x02     超时窗口碰撞
0x04     状态栈溢出（通常不可能）
0x08     16 次碰撞
0x10     发送欠溢出（PCI 总线带宽不足）
0x20     发送杂音
0x40     请求发送中断
0x80     状态有效（这应该始终设置）
=====	============================================

当发生发送错误时，驱动程序会产生一个状态消息，例如：

```
eth0: 发送错误，Tx 状态寄存器 82
```

通常在这里看到的两个值是：

0x82
^^^^

超时窗口碰撞。这通常发生在另一个以太网主机在一个半双工网络中错误地设置为全双工的情况下。

0x88
^^^^

16 次碰撞。这通常发生在网络异常繁忙或者另一个主机在碰撞后没有正确退避的情况下。如果这个错误与 0x82 错误混合出现，则是由于一个主机错误地设置为全双工（参见上面的内容）。
这两个错误都是由应该纠正的网络问题导致的，并不代表驱动程序故障。
修订历史（此文件）
============================
2002年2月28日 v1.0  DR   新建；大部分基于Becker原始的3c509文档
