SPDX 许可证标识符: GPL-2.0+

========================================================
Pensando® 以太网适配器系列的 Linux 驱动程序
========================================================

Pensando Linux 以太网驱动程序
版权所有 © 2019 Pensando Systems, Inc

内容
========

- 识别适配器
- 启用驱动程序
- 配置驱动程序
- 统计信息
- 支持

识别适配器
=======================

要查找是否安装了一个或多个 Pensando PCI 以太网设备，请检查 PCI 设备：

```shell
$ lspci -d 1dd8:
b5:00.0 以太网控制器: 设备 1dd8:1002
b6:00.0 以太网控制器: 设备 1dd8:1002
```

如果列出的设备如上所示，则 ionic.ko 驱动程序应能找到并配置这些设备以供使用。内核消息中应该有如下日志条目：

```shell
$ dmesg | grep ionic
ionic 0000:b5:00.0: 可用的 PCIe 带宽为 126.016 Gb/s (8.0 GT/s PCIe x16 链路)
ionic 0000:b5:00.0 enp181s0: 从 eth0 重命名
ionic 0000:b5:00.0 enp181s0: 链接已建立 - 100 Gbps
ionic 0000:b6:00.0: 可用的 PCIe 带宽为 126.016 Gb/s (8.0 GT/s PCIe x16 链路)
ionic 0000:b6:00.0 enp182s0: 从 eth0 重命名
ionic 0000:b6:00.0 enp182s0: 链接已建立 - 100 Gbps
```

可以通过 ethtool 或 devlink 工具获取驱动程序和固件版本信息：

```shell
$ ethtool -i enp181s0
driver: ionic
version: 5.7.0
firmware-version: 1.8.0-28
..
$ devlink dev info pci/0000:b5:00.0
pci/0000:b5:00.0:
  driver ionic
  serial_number FLM18420073
  versions:
      fixed:
        asic.id 0x0
        asic.rev 0x0
      running:
        fw 1.8.0-28
```

有关 devlink dev info 数据的更多信息，请参阅 Documentation/networking/devlink/ionic.rst

启用驱动程序
===================

通过标准内核配置系统使用 make 命令启用驱动程序：

```shell
make oldconfig/menuconfig/etc
```

驱动程序位于以下菜单结构中：

```
-> 设备驱动程序
  -> 网络设备支持 (NETDEVICES [=y])
    -> 以太网驱动程序支持
      -> Pensando 设备
        -> Pensando 以太网 IONIC 支持
```

配置驱动程序
======================

MTU
---

巨型帧支持的最大大小为 9194 字节

中断合并
--------------------

可以通过使用 "ethtool -C" 命令更改 rx-usecs 值来配置中断合并。rx-usecs 的范围是 0-190。tx-usecs 值反映了 rx-usecs 值，因为它们绑定在同一个中断上。

SR-IOV
------

目前提供最小的 SR-IOV 支持，并且可以通过设置 sysfs 'sriov_numvfs' 值来启用（如果您的固件配置支持的话）

XDP
---

XDP 支持包括基本功能，加上巨型帧、重定向和 ndo_xmit。目前不支持零复制套接字或硬件卸载。

统计信息
==========

基本硬件统计信息
--------------------

命令 `netstat -i`、`ip -s link show` 和 `ifconfig` 显示了直接从固件获取的有限统计信息。例如：

```shell
$ ip -s link show enp181s0
7: enp181s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 00:ae:cd:00:07:68 brd ff:ff:ff:ff:ff:ff
    RX: bytes  packets  errors  dropped overrun mcast
    414        5        0       0       0       0
    TX: bytes  packets  errors  dropped carrier collsns
    1384       18       0       0       0       0
```

ethtool -S
----------

通过 `ethtool -S` 命令显示的统计信息包括驱动程序计数器和固件计数器的组合，包括端口和队列特定值。驱动程序值是由驱动程序计算的计数器，而固件值是从端口硬件收集并通过驱动程序传递的，无需进一步解释。
### 驱动程序端口特定信息：

    发送数据包数：12
    发送字节数：964
    接收数据包数：5
    接收字节数：414
    发送 TSO 数量：0
    发送 TSO 字节数：0
    发送时不计算校验和的数据包数：12
    发送时计算校验和的数据包数：0
    接收时不计算校验和的数据包数：0
    接收时完整校验和的数据包数：3
    接收时校验和错误的数据包数：0
    XDP 丢弃数量：0
    XDP 中断数量：0
    XDP 通过数量：0
    XDP 发送数量：0
    XDP 重定向数量：0
    XDP 帧数量：0

### 驱动程序队列特定信息：

    队列 0 发送数据包数：3
    队列 0 发送字节数：294
    队列 0 清理次数：3
    队列 0 DMA 映射错误数量：0
    队列 0 线性化次数：0
    队列 0 分片数量：0
    队列 0 TSO 数量：0
    队列 0 TSO 字节数：0
    队列 0 硬件时间戳有效次数：0
    队列 0 硬件时间戳无效次数：0
    队列 0 不计算校验和的数据包数：3
    队列 0 计算校验和的数据包数：0
    队列 0 插入 VLAN 的数据包数：0
    队列 0 XDP 帧数量：0
    队列 0 接收数据包数：2
    队列 0 接收字节数：120
    队列 0 DMA 映射错误数量：0
    队列 0 分配错误数量：0
    队列 0 不计算校验和的数据包数：0
    队列 0 完整校验和的数据包数：0
    队列 0 校验和错误的数据包数：0
    队列 0 硬件时间戳有效次数：0
    队列 0 硬件时间戳无效次数：0
    队列 0 丢弃的数据包数：0
    队列 0 剥离 VLAN 的数据包数：0
    队列 0 XDP 丢弃数量：0
    队列 0 XDP 中断数量：0
    队列 0 XDP 通过数量：0
    队列 0 XDP 发送数量：0
    队列 0 XDP 重定向数量：0

### 固件端口特定信息：

    硬件发送丢弃数量：0
    硬件接收丢弃数量：0
    硬件接收溢出错误数量：0
    硬件接收丢失错误数量：0
    硬件发送中断错误数量：0
    接收帧数量（正常）：15
    接收帧数量（总计）：15
    接收帧数量（FCS 错误）：0
    接收帧数量（全部错误）：0
    接收字节数（正常）：1290
    接收字节数（总计）：1290
    单播接收帧数量：10
    组播接收帧数量：5
    广播接收帧数量：0
    暂停帧接收数量：0
    接收帧长度错误数量：0
    接收帧过小数量：0
    接收帧过大数量：0
    接收帧碎片数量：0
    接收帧闲聊数量：0
    接收帧优先级暂停数量：0
    接收帧被篡改 CRC 数量：0
    接收帧过长数量：0
    接收 VLAN 帧数量（正确）：3
    接收帧丢弃数量：0
    接收帧小于 64 字节数量：0
    接收 64 字节帧数量：4
    接收 65 到 127 字节帧数量：11
    接收 128 到 255 字节帧数量：0
    接收 256 到 511 字节帧数量：0
    接收 512 到 1023 字节帧数量：0
    接收 1024 到 1518 字节帧数量：0
    接收 1519 到 2047 字节帧数量：0
    接收 2048 到 4095 字节帧数量：0
    接收 4096 到 8191 字节帧数量：0
    接收 8192 到 9215 字节帧数量：0
    接收其他帧数量：0
    发送帧数量（正常）：31
    发送帧数量（总计）：31
    发送帧数量（错误）：0
    发送字节数（正常）：2614
    发送字节数（总计）：2614
    单播发送帧数量：8
    组播发送帧数量：21
    广播发送帧数量：2
    暂停帧发送数量：0
    优先级暂停帧发送数量：0
    VLAN 发送帧数量：0
    发送帧小于 64 字节数量：0
    发送 64 字节帧数量：4
    发送 65 到 127 字节帧数量：27
    发送 128 到 255 字节帧数量：0
    发送 256 到 511 字节帧数量：0
    发送 512 到 1023 字节帧数量：0
    发送 1024 到 1518 字节帧数量：0
    发送 1519 到 2047 字节帧数量：0
    发送 2048 到 4095 字节帧数量：0
    发送 4096 到 8191 字节帧数量：0
    发送 8192 到 9215 字节帧数量：0
    发送其他帧数量：0
    发送优先级 0 帧数量：0
    发送优先级 1 帧数量：0
    发送优先级 2 帧数量：0
    发送优先级 3 帧数量：0
    发送优先级 4 帧数量：0
    发送优先级 5 帧数量：0
    发送优先级 6 帧数量：0
    发送优先级 7 帧数量：0
    接收优先级 0 帧数量：0
    接收优先级 1 帧数量：0
    接收优先级 2 帧数量：0
    接收优先级 3 帧数量：0
    接收优先级 4 帧数量：0
    接收优先级 5 帧数量：0
    接收优先级 6 帧数量：0
    接收优先级 7 帧数量：0
    发送优先级暂停 0-1 微秒计数：0
    发送优先级暂停 1-1 微秒计数：0
    发送优先级暂停 2-1 微秒计数：0
    发送优先级暂停 3-1 微秒计数：0
    发送优先级暂停 4-1 微秒计数：0
    发送优先级暂停 5-1 微秒计数：0
    发送优先级暂停 6-1 微秒计数：0
    发送优先级暂停 7-1 微秒计数：0
    接收优先级暂停 0-1 微秒计数：0
    接收优先级暂停 1-1 微秒计数：0
    接收优先级暂停 2-1 微秒计数：0
    接收优先级暂停 3-1 微秒计数：0
    接收优先级暂停 4-1 微秒计数：0
    接收优先级暂停 5-1 微秒计数：0
    接收优先级暂停 6-1 微秒计数：0
    接收优先级暂停 7-1 微秒计数：0
    接收暂停 1 微秒计数：0
    发送帧截断数量：0

### 支持

#### 通用 Linux 网络支持

请使用 netdev 邮件列表，该列表由 Pensando 人员监控：

  netdev@vger.kernel.org

#### 更具体的驱动支持需求

请使用 Pensando 驱动支持电子邮件：

  drivers@pensando.io
