SPDX 许可证标识符: GPL-2.0+

========================================================
Pensando® 以太网适配器家族的 Linux 驱动程序
========================================================

Pensando Linux 以太网驱动程序
版权所有 (c) 2019 Pensando Systems, Inc

目录
========

- 识别适配器
- 启用驱动程序
- 配置驱动程序
- 统计信息
- 支持

识别适配器
=======================

要检查是否安装了一个或多个 Pensando PCI 以太网设备在主机上，可以运行如下命令::

  $ lspci -d 1dd8:
  b5:00.0 以太网控制器: 设备 1dd8:1002
  b6:00.0 以太网控制器: 设备 1dd8:1002

如果列出了这样的设备，则 ionic.ko 驱动程序应该能够找到并配置这些设备以供使用。内核消息中应有相应的日志条目，例如::

  $ dmesg | grep ionic
  ionic 0000:b5:00.0: 可用的 PCIe 带宽为 126.016 Gb/s (8.0 GT/s PCIe x16 链路)
  ionic 0000:b5:00.0 enp181s0: 已从 eth0 重命名
  ionic 0000:b5:00.0 enp181s0: 链接已建立 - 100 Gbps
  ionic 0000:b6:00.0: 可用的 PCIe 带宽为 126.016 Gb/s (8.0 GT/s PCIe x16 链路)
  ionic 0000:b6:00.0 enp182s0: 已从 eth0 重命名
  ionic 0000:b6:00.0 enp182s0: 链接已建立 - 100 Gbps

可以通过 ethtool 或 devlink 工具收集驱动程序和固件版本信息::

  $ ethtool -i enp181s0
  驱动程序: ionic
  版本: 5.7.0
  固件版本: 1.8.0-28
  ..
$ devlink dev info pci/0000:b5:00.0
  pci/0000:b5:00.0:
    驱动程序 ionic
    序列号 FLM18420073
    版本:
        固定:
          ASIC ID 0x0
          ASIC REV 0x0
        运行中:
          固件 1.8.0-28

更多关于 devlink dev info 数据的信息，请参阅 Documentation/networking/devlink/ionic.rst

启用驱动程序
===================

驱动程序通过标准的内核配置系统启用，使用 make 命令::

  make oldconfig/menuconfig/etc
驱动程序位于菜单结构中的位置为：

  -> 设备驱动程序
    -> 网络设备支持 (NETDEVICES [=y])
      -> 以太网驱动程序支持
        -> Pensando 设备
          -> Pensando 以太网 IONIC 支持

配置驱动程序
======================

MTU
---

支持巨型帧，最大大小为 9194 字节
中断聚合
--------------------

可以通过 "ethtool -C" 命令更改 rx-usecs 值来配置中断聚合。rx-usecs 的范围是 0-190。tx-usecs 值与 rx-usecs 值相关联，因为它们绑定在同一中断上。
SR-IOV
------

目前提供了最小化的 SR-IOV 支持，并且可以通过设置 sysfs 中的 'sriov_numvfs' 值启用（如果您的特定固件配置支持的话）
XDP
---

XDP 支持包括基本功能，加上巨型帧、重定向和 ndo_xmit。当前不支持零拷贝套接字或硬件卸载
统计信息
==========

基本硬件统计
--------------------

命令 `netstat -i`、`ip -s link show` 和 `ifconfig` 显示了一组有限的直接从固件获取的统计信息。例如::

  $ ip -s link show enp181s0
  7: enp181s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq 状态 UP 模式 DEFAULT 组 default qlen 1000
      链路/以太网 00:ae:cd:00:07:68 广播 ff:ff:ff:ff:ff:ff
      RX: 字节数 包数 错误数 丢弃数 超时数 多播数
      414        5        0       0       0       0
      TX: 字节数 包数 错误数 丢弃数 载波错误数 碰撞数
      1384       18       0       0       0       0

ethtool -S
----------

从 `ethtool -S` 命令显示的统计信息结合了驱动程序计数器和固件计数器，包括端口和队列特定值。驱动程序值是由驱动程序计算的计数器，而固件值是从端口硬件收集并通过驱动程序传递的，没有进一步的解释。
驱动程序端口特定统计信息：

     发送数据包数：12
     发送字节数：964
     接收数据包数：5
     接收字节数：414
     TSO（传输分段卸载）发送数据包数：0
     TSO 发送字节数：0
     未进行校验和的发送数据包数：12
     进行校验和的发送数据包数：0
     未进行校验和的接收数据包数：0
     完全校验和的接收数据包数：3
     校验和错误的接收数据包数：0
     XDP丢弃的数据包数：0
     XDP中止的数据包数：0
     XDP通过的数据包数：0
     XDP发送的数据包数：0
     XDP重定向的数据包数：0
     XDP处理的数据帧数：0

驱动程序队列特定统计信息：

     队列0发送数据包数：3
     队列0发送字节数：294
     队列0清理的数据包数：3
     队列0 DMA映射错误数：0
     队列0线性化操作数：0
     队列0碎片数：0
     队列0 TSO数据包数：0
     队列0 TSO字节数：0
     队列0有效的硬件时间戳数：0
     队列0无效的硬件时间戳数：0
     队列0未进行校验和的发送数据包数：3
     队列0进行校验和的发送数据包数：0
     队列0插入VLAN标签的数据包数：0
     队列0 XDP处理的数据帧数：0
     队列0接收数据包数：2
     队列0接收字节数：120
     队列0 DMA映射错误数：0
     队列0分配错误数：0
     队列0未进行校验和的接收数据包数：0
     队列0完全校验和的接收数据包数：0
     队列0校验和错误的接收数据包数：0
     队列0有效的硬件时间戳数：0
     队列0无效的硬件时间戳数：0
     队列0丢弃的数据包数：0
     队列0剥离VLAN标签的数据包数：0
     队列0 XDP丢弃的数据包数：0
     队列0 XDP中止的数据包数：0
     队列0 XDP通过的数据包数：0
     队列0 XDP发送的数据包数：0
     队列0 XDP重定向的数据包数：0

固件端口特定统计信息：

     硬件发送丢弃的数据包数：0
     硬件接收丢弃的数据包数：0
     硬件接收溢出错误数：0
     硬件接收丢失错误数：0
     硬件发送中止错误数：0
     正常接收的数据帧数：15
     所有接收的数据帧数：15
     FCS错误的接收数据帧数：0
     所有接收错误的数据帧数：0
     正常接收的字节数：1290
     所有接收的字节数：1290
     单播接收的数据帧数：10
     组播接收的数据帧数：5
     广播接收的数据帧数：0
     PAUSE帧接收的数据帧数：0
     长度错误的接收数据帧数：0
     小于最小长度的接收数据帧数：0
     超过最大长度的接收数据帧数：0
     分片的接收数据帧数：0
     噪声数据帧数：0
     PRI PAUSE帧接收的数据帧数：0
     被篡改CRC的接收数据帧数：0
     超长的接收数据帧数：0
     VLAN标签正确的接收数据帧数：3
     接收丢弃的数据帧数：0
     小于64字节的接收数据帧数：0
     64字节的接收数据帧数：4
     65至127字节的接收数据帧数：11
     128至255字节的接收数据帧数：0
     256至511字节的接收数据帧数：0
     512至1023字节的接收数据帧数：0
     1024至1518字节的接收数据帧数：0
     1519至2047字节的接收数据帧数：0
     2048至4095字节的接收数据帧数：0
     4096至8191字节的接收数据帧数：0
     8192至9215字节的接收数据帧数：0
     其他类型的接收数据帧数：0
     正常发送的数据帧数：31
     所有发送的数据帧数：31
     错误的发送数据帧数：0
     正常发送的字节数：2614
     总发送的字节数：2614
     单播发送的数据帧数：8
     组播发送的数据帧数：21
     广播发送的数据帧数：2
     PAUSE帧发送的数据帧数：0
     PRI PAUSE帧发送的数据帧数：0
     带有VLAN标签的发送数据帧数：0
     小于64字节的发送数据帧数：0
     64字节的发送数据帧数：4
     65至127字节的发送数据帧数：27
     128至255字节的发送数据帧数：0
     256至511字节的发送数据帧数：0
     512至1023字节的发送数据帧数：0
     1024至1518字节的发送数据帧数：0
     1519至2047字节的发送数据帧数：0
     2048至4095字节的发送数据帧数：0
     4096至8191字节的发送数据帧数：0
     8192至9215字节的发送数据帧数：0
     其他类型的发送数据帧数：0
     优先级为0的发送数据帧数：0
     优先级为1的发送数据帧数：0
     优先级为2的发送数据帧数：0
     优先级为3的发送数据帧数：0
     优先级为4的发送数据帧数：0
     优先级为5的发送数据帧数：0
     优先级为6的发送数据帧数：0
     优先级为7的发送数据帧数：0
     优先级为0的接收数据帧数：0
     优先级为1的接收数据帧数：0
     优先级为2的接收数据帧数：0
     优先级为3的接收数据帧数：0
     优先级为4的接收数据帧数：0
     优先级为5的接收数据帧数：0
     优先级为6的接收数据帧数：0
     优先级为7的接收数据帧数：0
     优先级0-1us范围内的TX PRI PAUSE计数：0
     优先级1-1us范围内的TX PRI PAUSE计数：0
     优先级2-1us范围内的TX PRI PAUSE计数：0
     优先级3-1us范围内的TX PRI PAUSE计数：0
     优先级4-1us范围内的TX PRI PAUSE计数：0
     优先级5-1us范围内的TX PRI PAUSE计数：0
     优先级6-1us范围内的TX PRI PAUSE计数：0
     优先级7-1us范围内的TX PRI PAUSE计数：0
     优先级0-1us范围内的RX PRI PAUSE计数：0
     优先级1-1us范围内的RX PRI PAUSE计数：0
     优先级2-1us范围内的RX PRI PAUSE计数：0
     优先级3-1us范围内的RX PRI PAUSE计数：0
     优先级4-1us范围内的RX PRI PAUSE计数：0
     优先级5-1us范围内的RX PRI PAUSE计数：0
     优先级6-1us范围内的RX PRI PAUSE计数：0
     优先级7-1us范围内的RX PRI PAUSE计数：0
     RX PAUSE 1us计数：0
     发送被截断的数据帧数：0

支持
====

对于一般Linux网络问题的支持，请使用netdev邮件列表，该列表由Pensando员工监控：

  netdev@vger.kernel.org

对于更具体的支持需求，请使用Pensando驱动程序支持电子邮件：

  drivers@pensando.io
