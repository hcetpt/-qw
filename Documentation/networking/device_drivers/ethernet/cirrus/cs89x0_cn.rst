### SPDX 许可证标识符: GPL-2.0

======================================
Cirrus Logic LAN CS8900/CS8920 以太网适配器
======================================

**注：**

本文档由Cirrus Logic为内核2.2.5版本提供。此版本由Andrew Morton为2.3.48版本更新。
然而，这仍然过时！此处需要进行重大清理。
Cirrus在其网站上提供了该驱动程序的副本，具体如下。通常情况下，您应该使用随您的Linux发行版提供的驱动程序版本。
Linux网络接口驱动程序版本2.00 (<kernel 2.3.48>)

**目录**

1.0 Cirrus Logic LAN CS8900/CS8920 以太网适配器
    1.1 产品概述
    1.2 驱动程序描述
        1.2.1 驱动程序名称
        1.2.2 驱动程序包中的文件
    1.3 系统要求
    1.4 许可信息

2.0 适配器安装和配置
    2.1 基于CS8900的适配器配置
    2.2 基于CS8920的适配器配置

3.0 作为模块加载驱动程序

4.0 编译驱动程序
    4.1 将驱动程序编译为可加载模块
    4.2 编译驱动程序以支持内存模式
    4.3 编译驱动程序以支持Rx DMA

5.0 测试与故障排除
    5.1 已知缺陷与限制
    5.2 测试适配器
        5.2.1 诊断自测
        5.2.2 诊断网络测试
    5.3 使用适配器的LED指示灯
    5.4 解决I/O冲突

6.0 技术支持
    6.1 联系Cirrus Logic的技术支持
    6.2 在联系技术支持前所需的信息
    6.3 获取最新驱动程序版本
    6.4 当前维护者
    6.5 内核启动参数

---

### 1. Cirrus Logic LAN CS8900/CS8920 以太网适配器

#### 1.1 产品概述

基于CS8900的ISA以太网适配器遵循IEEE 802.3标准，并在10 Mbps以太网网络中支持半双工或全双工操作，适用于ISA总线计算机。这些适配器设计用于16位ISA或EISA扩展槽，并有10BaseT仅或3媒体配置（10BaseT、10Base2以及AUI用于10Base-5或光纤网络）可供选择。
基于CS8920的适配器类似于基于CS8900的适配器，但增加了对即插即用（PnP）的支持和唤醒帧识别功能。因此，两种类型的适配器的配置过程有所不同。有关详细信息，请参阅“适配器配置”部分。

#### 1.2 驱动程序描述

Linux下的CS8900/CS8920以太网适配器驱动程序支持2.3.48及以上版本的内核。它可以被直接编译进内核或作为设备驱动模块在运行时加载。

##### 1.2.1 驱动程序名称: cs89x0

##### 1.2.2 驱动程序包中的文件:

Cirrus网站上的驱动程序包含以下文件：

| 文件名       | 描述                                                         |
|--------------|--------------------------------------------------------------|
| readme.txt   | 此文件                                                         |
| build        | 编译cs89x0.c的批处理文件                                     |
| cs89x0.c     | 驱动程序C代码                                                 |
| cs89x0.h     | 驱动程序头文件                                                |
| cs89x0.o     | 为2.2.5内核预编译的模块                                      |
| config/Config.in | 示例文件，用于将cs89x0驱动程序包含在内核中                 |
| config/Makefile  | 示例文件，用于将cs89x0驱动程序包含在内核中                 |
| config/Space.c   | 示例文件，用于将cs89x0驱动程序包含在内核中                 |
### 1.3. 系统要求
------------------------

以下硬件为必需：

   * 基于Cirrus Logic CS8900/20的以太网ISA适配器

   * IBM或兼容IBM的PC，需具备：
     * 80386或更高处理器
     * 在210h至370h之间至少有16字节连续的I/O空间可用
     * 一个可用的IRQ（对于CS8900为5、10、11或12；对于CS8920为3-7、9-15）
* 适用于您的网络拓扑结构的适当电缆（及AUI、10BASE-2连接器）

以下软件为必需：

* LINUX内核版本2.3.48或更高

   * CS8900/20配置工具（基于DOS）

   * 您的内核的LINUX内核源码（如果要在内核中编译）

   * GNU工具包（gcc和make）v2.6或以上版本（如果要在内核或模块中编译）

### 1.4. 许可信息
--------------------------

本程序为自由软件；您可以根据由自由软件基金会发布的GNU通用公共许可证第1版的条款重新发布和/或修改它。
本程序是希望对您有所帮助而发布的，但**没有任何形式的保证**；甚至没有隐含的适销性或适合特定目的的保证。请参见GNU通用公共许可证获取更多详细信息。
要获得GNU通用公共许可证的完整副本，请写信给美国马萨诸塞州剑桥市675号大街，邮编02139的自由软件基金会公司。

### 2. 适配器安装与配置
=========================================

基于CS8900和CS8920的适配器都可以通过存储在板载EEPROM中的参数进行配置。如果您想要改变适配器在EEPROM中的配置，必须使用基于DOS的CS8900/20配置工具。
当作为模块加载驱动时，您可以在命令行上指定许多适配器的配置参数来覆盖EEPROM的设置，或者在没有使用EEPROM的情况下进行接口配置。（基于CS8920的适配器必须使用EEPROM。）详情请参考第3.0节《作为模块加载驱动》。
由于CS8900/20配置工具是一个基于DOS的应用程序，因此您必须在基于DOS的系统中使用CS8900/20配置工具来安装和配置适配器，然后才能将其安装到目标LINUX系统中。（如果安装的是基于CS8900的适配器且默认配置可接受，则不需要此步骤。）

#### 2.1. 基于CS8900的适配器配置
---------------------------------------

Cirrus Logic出厂的基于CS8900的适配器已配置了以下“默认”设置：

  操作模式：      内存模式
  IRQ：           10
  基础I/O地址：    300
  内存基地址：    D0000
  优化：          DOS客户端
  传输模式：      半双工
  BootProm：      无
  媒体类型：      自动检测（三媒体卡）或
                 10BASE-T（仅10BASE-T适配器）

只有在与其他适配器存在冲突时才应更改默认配置设置。要更改适配器的配置，运行CS8900/20配置工具。

#### 2.2. 基于CS8920的适配器配置
---------------------------------------

基于CS8920的适配器从Cirrus Logic出厂时默认配置为即插即用（PnP）启用状态。然而，由于cs89x0驱动**不支持**PnP，您必须将CS8920适配器安装在基于DOS的PC中，并运行CS8900/20配置工具来禁用PnP并配置适配器，之后才能将其安装到目标Linux系统中。如果不这样做，适配器将处于非活动状态，驱动将无法与其通信。
:: 

	****************************************************************
	*                    基于CS8920的适配器：                    *
	*                                                              *
	* 基于CS8920的适配器默认启用了即插即用功能。                *
	* CS89X0驱动不支持即插即用。因此，您必须运行                  *
	* CS8900/20配置工具来禁用即插即用支持并激活适配器。          *
	****************************************************************


### 3. 作为模块加载驱动
=================================

如果驱动被编译为可加载模块，您可以使用'modprobe'命令加载驱动模块。适配器的许多配置参数可以作为加载命令的命令行参数指定。这一功能提供了覆盖EEPROM设置的方法，或在未使用EEPROM的情况下进行接口配置。
这段文本描述了如何使用特定参数加载`cs89x0`网络适配器驱动模块，并配置该适配器。下面是对原文的中文翻译：

示例：

    insmod cs89x0.o io=0x200 irq=0xA media=aui

此示例加载了模块并配置适配器使用IO端口的基本地址为200h、中断10以及AUI媒体连接方式。以下是在命令行中可用的配置选项：

  io=###               - 指定IO地址（200h-360h）
  irq=##               - 指定中断级别
  use_dma=1            - 启用DMA
  dma=#                - 指定DMA通道（驱动程序仅支持接收DMA）
  dmasize=# (16或64)   - DMA大小16K或64K。默认值设置为16
  media=rj45           - 指定媒体类型
   或 media=bnc
   或 media=aui
   或 media=auto
  duplex=full          - 强制指定半双工/全双工/自动协商模式
   或 duplex=half
   或 duplex=auto
  debug=#              - 调试级别（只有当驱动程序编译用于调试时才可用）

**注意事项：**

a) 如果存在EEPROM，则任何指定的命令行参数都会覆盖存储在EEPROM中的相应配置值。
b) “io”参数必须在命令行中指定。
c) 驱动程序的硬件探测例程设计为避免写入I/O空间，直到它知道所写的地址处有cs89x0卡。这可能会导致设备探测问题。为了避免这种行为，在`io=`模块参数后添加1。这实际上不会改变I/O地址，而是告诉驱动程序在尝试识别卡之前部分初始化硬件。如果你不确定所提供的地址处有cs89x0卡，这样做可能是危险的。例如，要扫描位于IO基址0x300的适配器，应指定一个IO地址为0x301。
d) “duplex=auto”参数仅适用于CS8920。
e) 如果不存在EEPROM，则所需的最小命令行配置为：
   io
   irq
   媒体类型（无自动检测）
f) 以下额外参数是CS89XX的默认值（没有EEPROM或命令行参数时使用的值）：
* DMA Burst = 启用
   * IOCHRDY启用 = 启用
   * UseSA = 启用
   * CS8900如果未在命令行中指定则默认为半双工
   * CS8920如果未在命令行中指定则默认为自动协商
   * 对于其他配置参数使用重置默认值
   * dma_mode = 0
g) 可以使用ifconfig设置适配器的以太网地址。
h) 许多Linux发行版使用'modprobe'命令来加载模块。这个程序使用'/etc/conf.modules'文件来确定加载驱动模块时传递给它的配置信息。上述所有配置选项都可以放在/etc/conf.modules文件中。例如：

     > cat /etc/conf.modules
     ..
在这个例子中，我们告诉模块系统本机的以太网驱动应该使用`cs89x0`驱动。我们要求`modprobe`在加载该驱动时传递`io`、`dma`和`use_dma`参数。
- i) Cirrus建议`cs89x0`使用ISA DMA通道5、6或7。你可能会发现其他DMA通道无法正常工作。
- j) `cs89x0`仅支持接收时的DMA操作。DMA模式显著提高了效率。对于一台400 MHz的Celeron机器，如果用大尺寸的ping包对其进行洪泛攻击，在非DMA模式下会消耗其82%的CPU能力；而在DMA模式下，这一数字减少到45%。
- k) 如果你的Linux内核编译时内置了即插即用支持，你可以通过以下命令找到关于`cs89x0`网卡的信息：

        cat /proc/isapnp

- l) 如果在DMA操作过程中遇到异常行为或网络数据损坏，你应该通过PC的BIOS来降低EISA总线的时钟速度。
- m) 如果`cs89x0`驱动直接编译到内核（非模块化），那么它的I/O地址将由ISA总线探测自动确定。中断请求（IRQ）号、媒体选项等信息将从卡上的EEPROM中读取。
- n) 如果`cs89x0`驱动直接编译到内核，可以通过提供内核一个启动选项`cs89x0_dma=N`来选择DMA模式，其中`N`是你希望使用的DMA通道号（5、6或7）。  
    内核启动选项可以在LILO命令行中指定：

        LILO 启动: linux cs89x0_dma=5

    或者它们可以被放置在`/etc/lilo.conf`文件中：

        image=/boot/bzImage-2.3.48
          append="cs89x0_dma=5"
          label=linux
          root=/dev/hda5
          read-only

    在这种模式下，DMA接收缓冲区大小固定为16 KB（不支持64 KB模式）。

4. 编译驱动
=============

`cs89x0`驱动既可以被直接编译进内核，也可以被编译成可加载的设备驱动模块。
仅需使用标准方法来配置驱动程序并编译内核。

4.1 编译驱动程序以支持接收 DMA
-------------------------------

DMA 的编译时可选性已在 2.3 版本的内核系列中移除。现在，DMA 支持无条件地成为驱动程序的一部分。它通过 'use_dma=1' 模块选项启用。

5. 测试与故障排除
==================

5.1 已知缺陷和限制
------------------

参阅作为此存档分发的 RELEASE.TXT 文件，以获取已知缺陷、驱动程序限制及变通方案的列表。

5.2 测试适配器
------------------

安装并配置好适配器后，可以使用 CS8900/20 设置实用工具的诊断选项来测试适配器及其网络连接的功能。使用诊断中的“自检”选项来测试您所分配的硬件配置下适配器的功能。您可以使用诊断中的“网络测试”来测试适配器通过以太网与其他装有基于 CS8900/20 适配器卡的 PC（也必须运行 CS8900/20 设置实用工具）通信的能力。
.. 注意::

     设置实用工具的诊断是为仅运行 DOS 的操作系统环境设计的。**不要**在 Windows 95、Windows NT、OS/2 或其他操作系统的 DOS 或命令提示符会话中运行诊断。

要对 CS8900/20 适配器运行诊断测试：

   1. 在 PC 上启动 DOS 并启动 CS8900/20 设置实用工具
2. 显示适配器的当前配置。按 ENTER 键进入主菜单
4. 从主菜单选择“诊断”（ALT-G）
* 选择“自检”来测试适配器的基本功能
* 选择“网络测试”来测试网络连接和布线
5.2.1. 诊断自检

诊断自检检查适配器的基本功能以及根据硬件配置分配的系统资源，确保其能够通过ISA总线进行通信。以下为执行的测试：

   * 输入输出寄存器读写测试

     输入输出寄存器读写测试确保CS8900/20能够在输入输出模式下被访问，并且输入输出基地址是正确的。
* 共享内存测试

     共享内存测试确保CS8900/20能够在内存模式下被访问，并且分配的内存地址范围不会与系统中的其他设备发生冲突。
* 中断测试

     中断测试确保没有与分配的IRQ信号发生冲突。
* EEPROM测试

     EEPROM测试确保可以读取EEPROM。
* 芯片RAM测试

     芯片RAM测试确保CS8900/20内部的4K内存正常工作。
* 内部环回测试

     内部环回测试确保适配器的发送器和接收器正常运行。如果此测试失败，请确保适配器的电缆已连接到网络（例如，检查LED活动）。
* 引导PROM测试

     引导PROM测试确保引导PROM存在并且可以被读取。失败表明由于硬件问题或引导PROM地址分配冲突导致未能成功读取引导PROM。（仅当适配器配置为使用引导PROM选项时，该测试适用。）

测试项失败可能表示在ISA总线上与其他设备之间存在系统资源冲突。在这种情况下，您应该使用手动设置选项来重新配置适配器，通过为失败的系统资源选择不同的值。

5.2.2. 诊断网络测试

诊断网络测试通过在网络上的两台不同PC中安装的两个CS8900/20适配器之间传输数据，验证有效的网络连接。（注意：不应在路由器之间的两个节点上运行诊断网络测试。）

此测试要求每台PC都安装有基于CS8900/20的适配器，并运行CS8900/20设置实用程序。第一台PC配置为响应者，另一台PC配置为主动者。一旦主动者启动，它将向响应者发送数据帧，而响应者将这些帧返回给主动者。
接收和发送的总帧数显示在发起者的显示屏上，同时还显示接收和发送正常的帧数以及出错的帧数。用户可以在任意时间在任一电脑上终止测试。
要设置诊断网络测试：

    1. 选择一台装有基于CS8900/20适配器并已知网络连接可用的电脑作为响应者。运行CS8900/20安装实用程序，并从主菜单中选择“诊断 -> 网络测试 -> 响应者”。按回车键启动响应者。
2. 返回到你想要测试的装有基于CS8900/20适配器的电脑，并启动CS8900/20安装实用程序。
3. 从主菜单中选择“诊断 -> 网络测试 -> 发起者”。按回车键开始测试。
你可以随时在发起者端停止测试，而让响应者继续运行。这样，你可以移动到其他电脑上进行测试，通过在另一台电脑上启动发起者，无需停止/启动响应者。
5.3. 使用适配器的LED灯
-----------------------------

2端口和3端口适配器在板子后端靠近10Base-T连接器的位置有两个可见的LED灯。
链路完整性LED：绿色LED持续亮起表示有效的10Base-T连接。（仅适用于10Base-T。对于10Base-2或AUI连接，绿色LED没有意义。）

TX/RX LED：每当适配器传输或接收数据时，黄色LED会短暂亮起。（在典型的网络环境中，黄色LED看起来像是闪烁的。）

5.4. 解决I/O冲突
-----------------------------

当两个或多个适配器使用相同的ISA资源（I/O地址、内存地址或IRQ）时，会发生I/O冲突。通常在安装或配置基于CS8900/20的适配器后，可以通过以下四种方式之一检测到I/O冲突：

    1. 系统无法正常启动（或者根本无法启动）
2. 驱动程序无法与适配器通信，报告“未找到适配器”的错误消息
3. 无法连接到网络，或者驱动程序无法加载
4. 如果您已将适配器配置为在内存模式下运行，但驱动程序在加载时报告它正在使用I/O模式，这表明存在内存地址冲突。
如果发生I/O冲突，请运行CS8900/20安装实用程序并执行诊断自检。通常，发生冲突的ISA资源会在自检中失败。如果是这样，请重新配置适配器，为发生冲突的资源选择另一个选项。再次运行诊断检查是否存在进一步的I/O冲突。
在某些情况下（例如PC无法启动），可能需要卸下适配器，并将其安装到另一台PC中以运行CS8900/20安装实用程序来重新配置。一旦在目标系统中重新安装，运行诊断自检以确保新配置没有冲突后再加载驱动程序。
手动配置适配器时，请记住下面表格所示典型的ISA系统资源使用情况：

I/O 地址     设备                        中断请求号      设备
 -----------     --------                      -------      --------
    200-20F       游戏I/O适配器                  3         COM2, 总线鼠标
    230-23F       总线鼠标                       4         COM1
    270-27F       LPT3: 第三个并行端口            5         LPT2
    2F0-2FF       COM2: 第二个串行端口            6         软盘控制器
    320-32F       固定磁盘控制器                 7         LPT1
                                         8         实时时钟
                                        9         EGA/VGA显示适配器
                                       12         鼠标 (PS/2)
内存地址   设备                           13         数学协处理器
 -----------   ---------------------           14         硬盘控制器
A000-BFFF    EGA图形适配器
A000-C7FF    VGA图形适配器
B000-BFFF    单色图形适配器
B800-BFFF    彩色图形适配器
E000-FFFF    AT BIOS


6. 技术支持
=============

6.1. 联系Cirrus Logic的技术支持
-----------------------------------

Cirrus Logic 的 CS89XX 技术应用支持可以通过以下方式联系：

电话：(800) 888-5016 （美国和加拿大境内）
       (512) 442-7555 （美国和加拿大境外）
传真：(512) 912-3871
电子邮件：ethernet@crystal.cirrus.com
网页：http://www.cirrus.com

6.2. 在联系技术支持前需要准备的信息
---------------------------------------

在联系Cirrus Logic寻求技术支持之前，请准备好尽可能多的以下信息：
1. 适配器类型（如 CRD8900、CDB8900、CDB8920 等）

2. 适配器配置

    * I/O基地址、内存基地址、启用I/O或内存模式、中断请求号、DMA通道
    * 插即用功能是否启用/禁用（仅适用于基于CS8920的适配器）
    * 配置为自动检测媒体类型还是特定媒体类型（如果是特定类型，则指明具体类型）
3. PC系统的配置

    * 是否为插即用系统（是/否）
    * BIOS（品牌和版本）
    * 系统的品牌和型号
    * CPU（类型和速度）
    * 系统RAM
    * SCSI适配器

4. 软件

    * CS89XX驱动及版本
    * 您的网络操作系统及版本
    * 您系统的操作系统版本
    * 所有协议支持文件的版本

5. 显示的任何错误消息

6.3 获取最新驱动版本
------------------------------

您可以从Cirrus Logic的网站获取最新的CS89XX驱动程序和支持软件。您也可以联系Cirrus Logic的技术支持（电子邮件：ethernet@crystal.cirrus.com），要求注册自动软件更新通知。
Cirrus Logic在其网页http://www.cirrus.com上维护着最新驱动程序和技术出版物。

6.4. 当前维护者
-----------------

2000年2月，该驱动程序的维护工作由Andrew Morton接管。
6.5 内核模块参数
----------------------------

为了在没有 cs89x0 EEPROM 的嵌入式环境中使用，已经实现了内核启动参数 `cs89x0_media=`。 使用方法如下：

``cs89x0_media=rj45``   
或
``cs89x0_media=aui``    
或
``cs89x0_media=bnc``
