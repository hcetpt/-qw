SPDX 许可证标识符: GPL-2.0+

=====================================================
Linux 驱动程序用于 Intel(R) 以太网网络连接
=====================================================

Intel 千兆位 Linux 驱动程序
版权所有 (c) 2008-2018 Intel Corporation
内容
========

- 识别您的适配器
- 命令行参数
- 额外配置
- 支持

识别您的适配器
========================
要了解如何识别您的适配器以及获取最新的 Intel 网络驱动程序，请访问 Intel 支持网站：
https://www.intel.com/support

命令行参数
=======================
如果驱动程序作为模块构建，则可以通过使用 modprobe 命令和以下语法输入这些可选参数来使用它们：

```
modprobe e1000e [<option>=<VAL1>,<VAL2>,...]
```

系统中由该驱动支持的每个网络端口都需要一个 `<VAL#>`。这些值将按照功能顺序应用于每个实例。例如：

```
modprobe e1000e InterruptThrottleRate=16000,16000
```

在这种情况下，系统中有两个由 e1000e 支持的网络端口。通常每个参数的默认值是推荐设置，除非另有说明。
注意：描述符描述了一个数据缓冲区及其相关属性。这些信息由硬件访问。

InterruptThrottleRate
---------------------
:有效范围: 0,1,3,4,100-100000
:默认值: 3

Interrupt Throttle Rate 控制每个中断向量每秒可以生成的中断数量。增加 ITR 会降低延迟，但会增加 CPU 利用率；不过在某些情况下可能会提高吞吐量。将 InterruptThrottleRate 设置为大于或等于 100 的值会使适配器每秒最多发送这么多中断，即使有更多的数据包到达。这减少了系统的中断负载，并且可以在高负载下降低 CPU 利用率，但会增加延迟，因为数据包处理得不那么快。
驱动程序之前的默认行为假设一个静态的 InterruptThrottleRate 值为 8000，为所有类型的流量提供了一个良好的回退值，但在小数据包性能和延迟方面有所欠缺。然而，硬件能够处理更多的小数据包，因此实现了一种自适应中断调节算法。
驱动程序有两种自适应模式（设置为1或3），根据接收到的流量动态调整`InterruptThrottleRate`值。在确定了上一时间段内传入流量的类型后，它将调整`InterruptThrottleRate`到适合该类型流量的适当值。

算法每隔一段时间将传入的流量分类。一旦确定了类别，`InterruptThrottleRate`值将被调整以最适合该类型的流量。定义了三个类别：
- “批量流量”，适用于大量正常大小的数据包；
- “低延迟”，适用于少量流量和/或显著比例的小数据包；
- “最低延迟”，适用于几乎完全是小数据包或极少量的流量。

- 0：关闭
  关闭任何中断节流功能，可能会改善小数据包的延迟。然而，由于更高的中断率导致的CPU利用率增加，这通常不适合处理大量吞吐量的流量。
- 1：动态模式
  此模式试图在保持非常低延迟的同时调节每个向量的中断。这有时会导致额外的CPU利用率。如果计划在对延迟敏感的环境中部署e1000e，应考虑此参数。
- 3：动态保守模式（默认）
  在动态保守模式下，对于“批量流量”类别的流量，`InterruptThrottleRate`值设置为4000。如果流量属于“低延迟”或“最低延迟”类别，则`InterruptThrottleRate`逐步增加到20000。此默认模式适用于大多数应用程序。
- 4：简化平衡模式
  在简化模式下，中断率基于TX和RX流量的比例。如果每秒字节数大致相等，中断率将降至每秒2000次中断。如果流量主要是发送或接收，则中断率可能高达每秒8000次。
- 100-100000：
  将`InterruptThrottleRate`设置为大于或等于100的值会将适配器编程为每秒最多发送这么多中断，即使有更多数据包到达也是如此。这减少了系统上的中断负载，并且在高负载下可以降低CPU利用率，但会增加延迟，因为数据包无法快速处理。

注意：`InterruptThrottleRate`优先于TxAbsIntDelay和RxAbsIntDelay参数。换句话说，最小化接收和/或发送绝对延迟并不会强制控制器生成超过`InterruptThrottleRate`允许数量的中断。

### RxIntDelay
**有效范围：** 0-65535（0=关闭）
**默认值：** 0

此值以1.024微秒为单位延迟接收中断的生成。如果针对特定网络流量正确调优，减少接收中断可以提高CPU效率。增加此值会增加帧接收的额外延迟，并可能导致TCP流量的吞吐量下降。如果系统报告接收丢失，可能是此值设置得太高，导致驱动程序耗尽可用的接收描述符。
**警告**：当将 `RxIntDelay` 设置为非零值时，适配器在某些网络条件下可能会挂起（停止传输）。如果发生这种情况，系统事件日志中会记录一条 `NETDEV WATCHDOG` 消息。此外，控制器会自动重置，恢复网络连接。为了避免这种挂起，请确保 `RxIntDelay` 设置为 0。

`RxAbsIntDelay`
--------------
:有效范围: 0-65535（0=关闭）
:默认值: 8

此值以 1.024 微秒为单位，限制了接收中断生成的延迟时间。这个值确保在接收到初始数据包后的设定时间内生成一个中断，只有当 `RxIntDelay` 非零时才有用。适当调整 `RxAbsIntDelay` 和 `RxIntDelay` 可能会在特定网络条件下提高流量吞吐量。

`TxIntDelay`
-----------
:有效范围: 0-65535（0=关闭）
:默认值: 8

此值以 1.024 微秒为单位，延迟了发送中断的生成时间。适当调整此值可以提高 CPU 效率，特别是在特定网络流量条件下。如果系统报告丢弃发送，则可能是此值设置得太高，导致驱动程序耗尽可用的发送描述符。

`TxAbsIntDelay`
--------------
:有效范围: 0-65535（0=关闭）
:默认值: 32

此值以 1.024 微秒为单位，限制了发送中断生成的延迟时间。只有当 `TxIntDelay` 非零时才有用。它确保在初始数据包发送后，在设定的时间内生成一个中断。适当调整 `TxAbsIntDelay` 和 `TxIntDelay` 可能在特定网络条件下提高流量吞吐量。

`copybreak`
---------
:有效范围: 0-xxxxxxx（0=关闭）
:默认值: 256

驱动程序在将所有小于或等于该大小的数据包传递给堆栈之前，将其复制到一个新的接收缓冲区。

此参数与其他参数不同，因为它是一个单个参数（而不是 1,1,1 等），适用于所有驱动程序实例，并且在运行时也可用，路径为 `/sys/module/e1000e/parameters/copybreak`。

要使用 `copybreak`，输入：

```
modprobe e1000e.ko copybreak=128
```

`SmartPowerDownEnable`
--------------------
:有效范围: 0,1
:默认值: 0（禁用）

允许 PHY 在低功耗状态下关闭。用户可以在支持的芯片组中关闭此参数。

`KumeranLockLoss`
---------------
:有效范围: 0,1
:默认值: 1（启用）

此修复措施在 ICH8 系统的初始硅片发布时跳过在关机时重置 PHY 的操作。

`IntMode`
-------
:有效范围: 0-2
:默认值: 0

| 值  | 中断模式       |
|-----|--------------|
| 0   | Legacy       |
| 1   | MSI          |
| 2   | MSI-X        |

`IntMode` 允许在加载时控制由驱动程序注册的中断类型。MSI-X 对多队列支持是必需的，某些内核和内核 `.config` 选项组合会强制使用较低级别的中断支持。
此命令将显示不同类型的中断的不同值：

  cat /proc/interrupts

CrcStripping
------------
:有效范围: 0,1
:默认值: 1（启用）

从接收到的数据包中剥离CRC，然后再将其发送到网络堆栈。如果您有一台启用了BMC但加载或启用驱动程序后无法接收IPMI流量的机器，请尝试禁用此功能。
WriteProtectNVM
---------------
:有效范围: 0,1
:默认值: 1（启用）

如果设置为1，则配置硬件忽略ICHx NVM中的GbE区域的所有写入/擦除周期（以防止NVM意外损坏）。可以通过在初始驱动程序加载时将参数设置为0来禁用此功能。
注意：通过将参数设置为零来启用NVM写入时，必须进行电源循环（完全关机再开机）。一旦NVM被锁定（即驱动程序加载时参数为1），除了电源循环外无法解锁。
Debug
-----
:有效范围: 0-16（0=无，...，16=全部）
:默认值: 0

此参数调整系统日志中显示的调试消息级别。

附加功能和配置
======================

巨型帧支持
------------
通过将最大传输单元（MTU）更改为大于默认值1500的值来启用巨型帧支持。
使用ifconfig命令增加MTU大小。例如，输入以下内容，其中<x>是接口编号：

    ifconfig eth<x> mtu 9000 up

或者，可以使用ip命令如下：

    ip link set mtu 9000 dev eth<x>
    ip link set up dev eth<x>

此设置不会保存到重启。通过将'MTU=9000'添加到以下文件中可以使设置永久生效：

- 对于RHEL：/etc/sysconfig/network-scripts/ifcfg-eth<x>
- 对于SLES：/etc/sysconfig/network/<config_file>

注意：巨型帧的最大MTU设置为8996。这个值与最大巨型帧大小9018字节相一致。
注意：在10或100Mbps下使用巨型帧不受支持，并可能导致性能下降或链接丢失。
注意：以下适配器限制巨型帧大小的数据包的最大值为4088字节：

  - Intel(R) 82578DM 千兆网络连接
  - Intel(R) 82577LM 千兆网络连接

以下适配器不支持巨型帧：

  - Intel(R) PRO/1000 千兆服务器适配器
  - Intel(R) PRO/1000 PM 网络连接
  - Intel(R) 82562G 10/100 网络连接
  - Intel(R) 82562G-2 10/100 网络连接
  - Intel(R) 82562GT 10/100 网络连接
  - Intel(R) 82562GT-2 10/100 网络连接
  - Intel(R) 82562V 10/100 网络连接
  - Intel(R) 82562V-2 10/100 网络连接
  - Intel(R) 82566DC 千兆网络连接
  - Intel(R) 82566DC-2 千兆网络连接
  - Intel(R) 82566DM 千兆网络连接
  - Intel(R) 82566MC 千兆网络连接
  - Intel(R) 82566MM 千兆网络连接
  - Intel(R) 82567V-3 千兆网络连接
  - Intel(R) 82577LC 千兆网络连接
  - Intel(R) 82578DC 千兆网络连接

注意：如果系统上启用了MACSec，则不能在基于82579的网络设备上配置巨型帧。
ethtool
-------
该驱动程序利用ethtool接口进行驱动程序配置和诊断，以及显示统计信息。此功能需要最新版本的ethtool。可以从以下网址下载：

https://www.kernel.org/pub/software/network/ethtool/

注意：在验证某些部件（如82578）的启用/禁用测试时，使用ethtool时需要在测试之间增加几秒钟的时间间隔。

速度和双工配置
----------------
在解决速度和双工配置问题时，需要区分基于铜线的适配器和基于光纤的适配器。
在默认模式下，使用铜线连接的Intel® 以太网网络适配器会尝试与链路伙伴进行自动协商，以确定最佳设置。如果适配器无法通过自动协商与链路伙伴建立链接，您可能需要手动将适配器和链路伙伴配置为相同的设置，以便建立链接并传输数据包。这通常只在尝试与不支持自动协商或被强制为特定速度或双工模式的老式交换机建立链接时才需要。您的链路伙伴必须匹配您选择的设置。1 Gbps及以上的速度不能被强制。使用自动协商广告设置来手动设置1 Gbps及以上的设备。
速度、双工模式和自动协商广告设置是通过ethtool工具进行配置的。

注意：只有经验丰富的网络管理员才能手动强制速度和双工模式或更改自动协商广告设置。交换机上的设置必须始终与适配器设置匹配。如果您将适配器配置得与交换机不同，适配器性能可能会受到影响，甚至可能无法正常运行。

然而，使用光纤连接的Intel® 以太网网络适配器不会尝试与链路伙伴进行自动协商，因为这些适配器仅在全双工模式下运行，并且仅在其本机速度下工作。

启用Wake on LAN（WoL）
----------------------
WoL是通过ethtool工具进行配置的。
系统将在下次关机或重启时启用WoL。对于此驱动程序版本，为了启用WoL，e1000e驱动程序必须在系统关机或暂停之前加载。

注意：以下设备仅在端口A上支持Wake on LAN：
- Intel® PRO/1000 PT 双端口网络连接
- Intel® PRO/1000 PT 双端口服务器连接
- Intel® PRO/1000 PT 四端口服务器适配器
- Intel® PRO/1000 PF 双端口服务器适配器
- Intel® Gigabit PT 四端口服务器ExpressModule

支持
=====
有关一般信息，请访问Intel支持网站：
https://www.intel.com/support/

如果在支持内核上发布的源代码中发现了一个问题，并且使用的是支持的适配器，请将与此问题相关的确切信息发送到intel-wired-lan@lists.osuosl.org。
