SPDX 许可声明标识符：GPL-2.0+

==========================================================
Linux 基础驱动程序用于 Intel(R) 以太网连接
==========================================================

Intel 千兆位 Linux 驱动程序
版权所有 © 1999 - 2013 Intel Corporation
内容
========

- 识别您的适配器
- 命令行参数
- 速度和双工配置
- 额外的配置
- 支持

识别您的适配器
========================

有关如何识别您的适配器的更多信息，请访问以下适配器和驱动程序 ID 指南：

    http://support.intel.com/support/go/network/adapter/idguide.htm

对于最新的 Intel 网络驱动程序，请访问以下网站。在搜索栏中输入您的适配器名称或类型，或者使用左侧的网络链接来查找您的适配器：

    http://support.intel.com/support/go/network/adapter/home.htm

命令行参数
=======================

每个参数的默认值通常是推荐设置，除非另有说明。
注意：
    关于 AutoNeg、Duplex 和 Speed 参数的更多信息，请参阅本文档中的“速度和双工配置”部分。
    关于 InterruptThrottleRate、RxIntDelay、TxIntDelay、RxAbsIntDelay 和 TxAbsIntDelay 参数的更多信息，请参阅以下应用笔记：
    http://www.intel.com/design/network/applnots/ap450.htm

AutoNeg
-------

（仅支持具有铜连接的适配器）

:有效范围:   0x01-0x0F, 0x20-0x2F
:默认值:   0x2F

此参数是一个位掩码，指定了适配器所宣传的速度和双工设置。当使用此参数时，Speed 和 Duplex 参数不应被指定。
注意：
    有关 AutoNeg 参数的更多信息，请参阅本说明文档中的“速度和双工”部分。

Duplex
------

（仅支持具有铜连接的适配器）

:有效范围:   0-2 （0=自动协商，1=半双工，2=全双工）
:默认值:   0

这定义了数据流动的方向。可以是一向或双向。如果 Duplex 和链路伙伴都设置为自动协商，则板卡会自动检测正确的双工模式。如果链路伙伴被强制（全双工或半双工），则 Duplex 默认为半双工。

FlowControl
-----------

:有效范围:   0-3 （0=无，1=仅接收，2=仅发送，3=接收与发送）
:默认值:   从 EEPROM 读取流控制设置

此参数控制对以太网 PAUSE 帧的自动生成（发送）和响应（接收）。

InterruptThrottleRate
---------------------

（不支持 Intel(R) 82542、82543 或 82544 基础的适配器）

:有效范围:
   0,1,3,4,100-100000 （0=关闭，1=动态，3=保守动态，4=简化平衡）
:默认值:   3

驱动程序可以限制适配器为传入的数据包每秒生成的中断数量。这是通过写入一个基于适配器每秒最大生成中断数量的值来实现的。
将 InterruptThrottleRate 设置为大于或等于 100 的值，会使适配器每秒最多发送这么多中断，即使有更多的数据包到达。这减少了系统的中断负载，并且在高负载下可以降低 CPU 利用率，但会增加延迟，因为数据包不会被迅速处理。
驱动程序之前的默认行为假定一个静态的 `InterruptThrottleRate` 值为 8000，这为所有类型的流量提供了一个良好的回退值，但在处理小数据包时性能和延迟表现不佳。然而，硬件实际上能够每秒处理更多的小数据包。因此，实现了一种自适应中断调节算法。从 7.3.x 版本开始，驱动程序有两种自适应模式（设置为 1 或 3），根据接收到的流量动态调整 `InterruptThrottleRate` 值。在确定了上一时间段内传入流量的类型后，它将调整 `InterruptThrottleRate` 到适合该类型流量的适当值。

该算法每隔一段时间将传入流量分类为不同的类别。一旦确定了类别，`InterruptThrottleRate` 值就会调整到最适合该流量类型的值。定义了三个类别：
- “大量流量”，用于大量的正常大小的数据包；
- “低延迟”，用于少量流量和/或一定比例的小数据包；
- “最低延迟”，用于几乎完全是小数据包或极少量的流量。

在动态保守模式下，对于“大量流量”类别的流量，`InterruptThrottleRate` 值设置为 4000。如果流量属于“低延迟”或“最低延迟”类别，则 `InterruptThrottleRate` 将逐步增加至 20000。这种默认模式适用于大多数应用程序。

对于需要极低延迟的情况，例如集群或网格计算，当 `InterruptThrottleRate` 设置为模式 1 时，算法可以进一步减少延迟。在这种模式下，与模式 3 相同，对于“最低延迟”类别的流量，`InterruptThrottleRate` 将逐步增加至 70000。

在简化模式下，中断率基于发送（TX）和接收（RX）流量的比例。如果每秒字节数大致相等，中断率将降至每秒 2000 次中断。如果流量主要是发送或主要是接收，中断率可能高达 8000。

将 `InterruptThrottleRate` 设置为 0 会关闭任何中断调节，可能会改善小数据包的延迟，但通常不适合大量吞吐量的流量。

**注意：**
`InterruptThrottleRate` 的优先级高于 `TxAbsIntDelay` 和 `RxAbsIntDelay` 参数。换句话说，最小化接收和/或发送的绝对延迟不会迫使控制器生成超过 `InterruptThrottleRate` 允许数量的中断。

**警告：**
如果您使用的是 Intel® PRO/1000 CT 网络连接（控制器 82547），将 `InterruptThrottleRate` 设置为大于 75000 的值，在某些网络条件下可能导致适配器停止传输。如果发生这种情况，系统事件日志中会记录一条 NETDEV WATCHDOG 消息，并且控制器会自动重置以恢复网络连接。为了避免潜在的挂起问题，请确保 `InterruptThrottleRate` 不超过 75000 并且不设置为 0。
**注意：**
当使用默认设置加载e1000驱动程序且同时使用多个适配器时，CPU利用率可能会非线性增加。为了在不影响整体吞吐量的情况下限制CPU利用率，我们建议您按照以下方式加载驱动程序：

```shell
modprobe e1000 InterruptThrottleRate=3000,3000,3000
```

这将为驱动程序的第一个、第二个和第三个实例设置中断节流率（InterruptThrottleRate）为每秒3000次中断。2000到3000次中断/秒的范围适用于大多数系统，并且是一个好的起点，但最佳值将取决于具体平台。如果CPU利用率不是问题，则可以使用RX_POLLING（NAPI）和默认驱动程序设置。

**RxDescriptors（接收描述符）**

- **有效范围：**
  - 对于基于82542和82543的适配器：48-256
  - 对于所有其他支持的适配器：48-4096
- **默认值：** 256

此值指定由驱动程序分配的接收缓冲区描述符的数量。增加此值允许驱动程序缓存更多的传入数据包，代价是增加了系统内存的使用。每个描述符为16字节。为每个描述符分配一个接收缓冲区，其大小可以是2048、4096、8192或16384字节，具体取决于MTU设置。最大MTU大小为16110。

**注意：**
MTU指定帧大小。仅在需要巨型帧时才需要设置。根据可用系统资源，请求更多接收描述符可能被拒绝。在这种情况下，请使用较低的数值。

**RxIntDelay（接收中断延迟）**

- **有效范围：** 0-65535（0表示关闭）
- **默认值：** 0

此值以1.024微秒为单位延迟生成接收中断。如果适当调整，接收中断减少可以提高CPU效率。增加此值会增加帧接收的额外延迟，并可能导致TCP流量的吞吐量降低。如果系统报告接收丢包，可能是此值设置得过高，导致驱动程序缺少可用的接收描述符。

**警告：**
当将RxIntDelay设置为非零值时，在某些网络条件下适配器可能会挂起（停止传输）。如果发生这种情况，会在系统事件日志中记录NETDEV WATCHDOG消息。此外，控制器会自动重置，恢复网络连接。为了消除挂起的可能性，请确保RxIntDelay设置为0。

**RxAbsIntDelay（绝对接收中断延迟）**

（此参数仅适用于82540、82545及以后的适配器。）

- **有效范围：** 0-65535（0表示关闭）
- **默认值：** 128

此值以1.024微秒为单位限制生成接收中断的延迟。仅当RxIntDelay非零时才有用，此值确保在接收到初始数据包后在设定的时间内生成中断。适当调整与RxIntDelay配合使用，可以在特定网络条件下改善流量吞吐量。

**Speed（速度）**

（此参数仅适用于具有铜缆连接的适配器。）

- **有效设置：** 0, 10, 100, 1000
- **默认值：** 0（在所有支持的速度下进行自动协商）

Speed强制线路速度为指定的兆比特每秒（Mbps）值。如果未指定此参数或设置为0，并且链路伙伴设置为自动协商，则板卡将自动检测正确的速度。当Speed设置为10或100时，还应设置Duplex。

**TxDescriptors（发送描述符）**

- **有效范围：**
  - 对于基于82542和82543的适配器：48-256
  - 对于所有其他支持的适配器：48-4096
- **默认值：** 256

此值为驱动程序分配的发送描述符的数量。增加此值允许驱动程序排队更多的发送任务。每个描述符为16字节。
注释：
       根据可用的系统资源，请求更多的发送描述符可能会被拒绝。在这种情况下，
       请使用较少的数量。
TxIntDelay
----------
:有效范围:   0-65535（0=关闭）
:默认值:     8

此值以1.024微秒为单位延迟生成发送中断。如果针对特定网络流量适当调整，则可以提高CPU效率。如果系统报告发送丢失，可能是此值设置得过高，导致驱动程序耗尽可用的发送描述符。
TxAbsIntDelay
-------------
（此参数仅在82540、82545及之后的适配器上支持。）

:有效范围:   0-65535（0=关闭）
:默认值:     32

此值以1.024微秒为单位限制生成发送中断的延迟时间。只有当TxIntDelay非零时，此值才有用，它确保初始数据包发送后在设定的时间内生成一个中断。与TxIntDelay一起适当调整可以在特定网络条件下改善流量吞吐量。
XsumRX
------
（此参数不支持基于82542的适配器。）

:有效范围:   0-1
:默认值:     1

值为'1'表示驱动程序应启用IP校验和卸载功能，将接收的数据包（包括UDP和TCP）卸载到适配器硬件。
Copybreak
---------
:有效范围:   0-xxxxxxx（0=关闭）
:默认值:     256
:使用方法:   modprobe e1000.ko copybreak=128

驱动程序会将所有小于或等于该大小的数据包复制到新的接收缓冲区中，然后再将其传递给堆栈中的其他部分。
此参数与其他参数不同之处在于，它是一个单一参数（而不是1,1,1等），应用于所有驱动实例，并且在运行时也可以通过/sys/module/e1000/parameters/copybreak访问。
SmartPowerDownEnable
--------------------
:有效范围:   0-1
:默认值:     0（禁用）

允许物理层在低功耗状态下关闭。用户可以在支持的芯片组中关闭此参数。
速度和双工配置
==================

三个关键字用于控制速度和双工配置。这些关键字是Speed、Duplex和AutoNeg。
如果板卡使用光纤接口，则忽略这些关键字，光纤接口板仅以全双工1000Mbps的速度链接。
对于基于铜线的板卡，这些关键字的作用如下：

- 默认操作模式是自动协商。板卡会宣传其支持的所有速度和双工组合，并且如果链路伙伴设置为自动协商，则以最高的共同速度和双工模式链接。
- 如果 Speed = 1000，则启用有限的自动协商，并且仅宣传 1000 Mbps（1000BaseT 规范要求自动协商）。

- 如果 Speed = 10 或 100，则应同时设置 Speed 和 Duplex。自动协商被禁用，AutoNeg 参数将被忽略。合作伙伴也应被强制。
AutoNeg 参数用于需要对自动协商过程进行更多控制的情况。当您希望在自动协商过程中控制宣传哪些速度和双工组合时，应使用此参数。
该参数可以指定为十进制或十六进制值，如下表所示：
============== ====== ====== ======= ======= ====== ====== ======= ======
Bit 位置       7      6      5       4       3      2      1       0
十进制值       128    64     32      16      8      4      2       1
十六进制值     80     40     20      10      8      4      2       1
速度 (Mbps)    N/A    N/A    1000    N/A     100    100    10      10
双工模式                      全双工           全双工  半双工  全双工   半双工
============== ====== ====== ======= ======= ====== ====== ======= ======

使用 AutoNeg 的一些示例：

  modprobe e1000 AutoNeg=0x01 （限制自动协商到 10 半双工）
  modprobe e1000 AutoNeg=1 （与上面相同）
  modprobe e1000 AutoNeg=0x02 （限制自动协商到 10 全双工）
  modprobe e1000 AutoNeg=0x03 （限制自动协商到 10 半双工或 10 全双工）
  modprobe e1000 AutoNeg=0x04 （限制自动协商到 100 半双工）
  modprobe e1000 AutoNeg=0x05 （限制自动协商到 10 半双工或 100 半双工）
  modprobe e1000 AutoNeg=0x020 （限制自动协商到 1000 全双工）
  modprobe e1000 AutoNeg=32 （与上面相同）

请注意，使用此参数时，不应指定 Speed 和 Duplex。
如果强制链接伙伴为特定的速度和双工，则不应使用此参数。相反，使用前面提到的 Speed 和 Duplex 参数来强制适配器为相同的速度和双工。
附加配置
==========

巨型帧
-------

  巨型帧支持通过将 MTU 更改为大于默认值 1500 来启用。使用 ifconfig 命令增加 MTU 大小。
例如：
  
       ifconfig eth<x> mtu 9000 up

  此设置不会在重新启动后保存。如果您添加以下内容，可以使其永久生效：

       MTU=9000

  到文件 /etc/sysconfig/network-scripts/ifcfg-eth<x> 中。此示例适用于 Red Hat 发行版；其他发行版可能将此设置存储在不同位置。
注意事项：
  在某些巨型帧环境中可能会观察到吞吐量性能下降。如果出现这种情况，增大应用程序的套接字缓冲区大小和/或增大 /proc/sys/net/ipv4/tcp_*mem 的条目值可能会有所帮助。
请参阅特定应用程序手册和 /usr/src/linux*/Documentation/networking/ip-sysctl.txt 获取更多详细信息。
- 巨型帧的最大 MTU 设置为 16110。此值与最大巨型帧大小 16128 相匹配。
使用巨型帧（Jumbo frames）在10或100 Mbps的情况下不受支持，并可能导致性能下降或链路丢失。

基于Intel(R) 82542和82573V/E控制器的适配器不支持巨型帧。这些对应以下产品名称：

- Intel(R) PRO/1000 Gigabit Server Adapter
- Intel(R) PRO/1000 PM Network Connection

ethtool
-------

驱动程序利用ethtool接口进行配置和诊断，以及显示统计信息。此功能需要ethtool版本1.6或更高版本。
ethtool的最新发布版可以从以下网址获取：
https://www.kernel.org/pub/software/network/ethtool/

启用网络唤醒（Wake on LAN, WoL）
-------------------------------

WoL通过ethtool工具进行配置。
系统将在下次关机或重启时启用WoL。
对于此驱动程序版本，为了启用WoL，在系统关机或重启时必须加载e1000驱动程序。

支持
====

如需一般信息，请访问Intel支持网站：
http://support.intel.com

如果在受支持内核上使用受支持的适配器发现发布的源代码存在问题，请将与问题相关的确切信息发送至intel-wired-lan@lists.osuosl.org。
