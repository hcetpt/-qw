SPDX 许可声明标识符：GPL-2.0 以上

===========================================================================
Intel(R) 以太网 10 千兆 PCI Express 适配器的 Linux 基础驱动程序
===========================================================================

Intel 10 千兆 Linux 驱动程序
版权所有 © 1999-2018 Intel 公司
内容
========

- 识别您的适配器
- 命令行参数
- 额外配置
- 已知问题
- 支持

识别您的适配器
========================
该驱动程序兼容以下设备：

 * Intel(R) 以太网控制器 82598
 * Intel(R) 以太网控制器 82599
 * Intel(R) 以太网控制器 X520
 * Intel(R) 以太网控制器 X540
 * Intel(R) 以太网控制器 x550
 * Intel(R) 以太网控制器 X552
 * Intel(R) 以太网控制器 X553

有关如何识别您的适配器的信息以及最新的 Intel 网络驱动程序，请参阅 Intel 支持网站：
https://www.intel.com/support

带可插拔光模块的 SFP+ 设备
----------------------------------

基于 82599 的适配器
~~~~~~~~~~~~~~~~~~~~
注意事项：
- 如果您的基于 82599 的 Intel(R) 网络适配器附带了 Intel 光模块或为 Intel(R) 以太网服务器适配器 X520-2，则仅支持 Intel 光模块和/或以下列出的直连电缆
- 当基于 82599 的 SFP+ 设备背靠背连接时，应通过 ethtool 设置相同的速率。如果混合设置速率，结果可能不同
+---------------+---------------------------------------+------------------+
| 供应商        | 类型                                  | 零件编号         |
+===============+=======================================+==================+
| SR 模块                                                              |
+---------------+---------------------------------------+------------------+
| Intel         | 双速 1G/10G SFP+ SR（带保释）          | FTLX8571D3BCV-IT |
+---------------+---------------------------------------+------------------+
| Intel         | 双速 1G/10G SFP+ SR（带保释）          | AFBR-703SDZ-IN2  |
+---------------+---------------------------------------+------------------+
| Intel         | 双速 1G/10G SFP+ SR（带保释）          | AFBR-703SDDZ-IN1 |
+---------------+---------------------------------------+------------------+
| LR 模块                                                              |
+---------------+---------------------------------------+------------------+
| Intel         | 双速 1G/10G SFP+ LR（带保释）          | FTLX1471D3BCV-IT |
+---------------+---------------------------------------+------------------+
| Intel         | 双速 1G/10G SFP+ LR（带保释）          | AFCT-701SDZ-IN2  |
+---------------+---------------------------------------+------------------+
| Intel         | 双速 1G/10G SFP+ LR（带保释）          | AFCT-701SDDZ-IN1 |
+---------------+---------------------------------------+------------------+

以下是经过部分测试的第三方 SFP+ 模块列表。并非所有模块都适用于所有设备
+---------------+---------------------------------------+------------------+
| 供应商        | 类型                                  | 零件编号         |
+===============+=======================================+==================+
| Finisar       | SFP+ SR（带保释），10G 单速率           | FTLX8571D3BCL    |
+---------------+---------------------------------------+------------------+
| Avago         | SFP+ SR（带保释），10G 单速率           | AFBR-700SDZ      |
+---------------+---------------------------------------+------------------+
| Finisar       | SFP+ LR（带保释），10G 单速率           | FTLX1471D3BCL    |
+---------------+---------------------------------------+------------------+
| Finisar       | 双速 1G/10G SFP+ SR（无保释）           | FTLX8571D3QCV-IT |
+---------------+---------------------------------------+------------------+
| Avago         | 双速 1G/10G SFP+ SR（无保释）           | AFBR-703SDZ-IN1  |
+---------------+---------------------------------------+------------------+
| Finisar       | 双速 1G/10G SFP+ LR（无保释）           | FTLX1471D3QCV-IT |
+---------------+---------------------------------------+------------------+
| Avago         | 双速 1G/10G SFP+ LR（无保释）           | AFCT-701SDZ-IN1  |
+---------------+---------------------------------------+------------------+
| Finisar       | 1000BASE-T SFP                         | FCLF8522P2BTL    |
+---------------+---------------------------------------+------------------+
| Avago         | 1000BASE-T                             | ABCU-5710RZ      |
+---------------+---------------------------------------+------------------+
| HP            | 1000BASE-SX SFP                        | 453153-001       |
+---------------+---------------------------------------+------------------+

基于 82599 的适配器支持所有符合 SFF-8431 v4.1 和 SFF-8472 v10.4 规范的被动和主动限幅直连电缆
当使用 `ifconfig ethX down` 时，SFP+ 的激光器关闭
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
“ifconfig ethX down” 将关闭基于 82599 的 SFP+ 光纤适配器的激光器
“ifconfig ethX up” 将开启激光器
或者，您也可以使用 “ip link set [down/up] dev ethX” 来关闭和开启激光器
基于 82599 的 QSFP+ 适配器
~~~~~~~~~~~~~~~~~~~~~~~~~~
注意事项：
- 如果您的基于 82599 的 Intel(R) 网络适配器附带了 Intel 光模块，则仅支持 Intel 光模块
### 基于82599的QSFP+适配器仅支持4x10 Gbps连接。不支持1x40 Gbps连接。QSFP+链路伙伴必须配置为4x10 Gbps。
- 基于82599的QSFP+适配器不支持自动链路速度检测。链路速度必须配置为10 Gbps或1 Gbps以匹配链路伙伴的速度能力。错误的速度配置将导致链路失败。

### Intel® Ethernet Converged Network Adapter X520-Q1仅支持以下列出的光模块和直连电缆：
+---------------+---------------------------------------+------------------+
| 供应商        | 类型                                  | 零件编号         |
+===============+=======================================+==================+
| Intel         | 双速率1G/10G QSFP+ SRL（双绞线）      | E10GQSFPSR       |
+---------------+---------------------------------------+------------------+

基于82599的QSFP+适配器支持所有符合SFF-8436 v4.1规范的被动和主动限幅QSFP+直连电缆。

### 基于82598的适配器
~~~~~~~~~~~~~~~
#### 注意：
- 支持可拆卸光模块的Intel® Ethernet网络适配器仅支持其原始模块类型（例如，Intel® 10 Gigabit SR Dual Port Express Module仅支持SR光模块）。如果插入不同类型的模块，驱动程序将不会加载。
- 不支持热插拔光模块。
- 仅支持单速10千兆模块。
- 主板上的LAN（LOM）可能支持DA、SR或LR模块。其他模块类型不受支持。请参阅系统文档获取详细信息。
以下是经过部分测试的SFP+模块和直连电缆列表。并非所有模块都适用于所有设备。
+---------------+---------------------------------------+------------------+
| 供应商        | 类型                                    | 零件编号           |
+---------------+---------------------------------------+------------------+
| Finisar       | SFP+ SR 固定，10G 单速率                | FTLX8571D3BCL    |
+---------------+---------------------------------------+------------------+
| Avago         | SFP+ SR 固定，10G 单速率                | AFBR-700SDZ      |
+---------------+---------------------------------------+------------------+
| Finisar       | SFP+ LR 固定，10G 单速率                | FTLX1471D3BCL    |
+---------------+---------------------------------------+------------------+

基于82598的适配器支持所有符合SFF-8431 v4.1和SFF-8472 v10.4规范的无源直连电缆。不支持有源直连电缆。
上述提及的第三方光模块和电缆仅用于突出第三方规格和潜在兼容性，并不代表Intel对任何第三方产品的推荐或背书或赞助。Intel并未推荐或推广任何第三方生产的产品，提及第三方仅供参考，以分享某些符合上述规格的光模块和电缆信息。可能还有其他制造商或供应商生产或供应具有类似或相同描述的光模块和电缆。
客户在购买第三方光模块和电缆时必须自行谨慎选择。客户全权负责评估产品和/或设备的适用性以及选择供应商购买任何产品。上述提及的光模块和电缆不受Intel保修或支持。Intel不对第三方产品的销售和/或使用承担任何责任，并且不提供任何明示或暗示的保证，与第三方产品的选择无关。
命令行参数
=============

max_vfs
-------
:有效范围: 1-63

此参数添加了SR-IOV的支持。它使驱动程序生成最多max_vfs数量的虚拟功能。
如果该值大于0，还将强制VMDq参数为1或更多。
注意：此参数仅在内核版本3.7.x及以下版本中使用。在内核版本3.8.x及以上版本中，请使用sysfs启用VF。另外，在Red Hat发行版中，此参数仅在版本6.6及更早版本中使用。对于版本6.7及更高版本，请使用sysfs。例如：

```
# echo $num_vf_enabled > /sys/class/net/$dev/device/sriov_numvfs // 启用VF
# echo 0 > /sys/class/net/$dev/device/sriov_numvfs               // 禁用VF
```

驱动程序的参数通过位置引用。因此，如果您有一个双端口适配器或系统中有多个适配器，并且希望每个端口有N个虚拟功能，则必须为每个端口指定一个数字，参数之间用逗号分隔。例如：

```
modprobe ixgbe max_vfs=4
```

这将在第一个端口上生成4个VF。

```
modprobe ixgbe max_vfs=2,4
```

这将在第一个端口上生成2个VF，在第二个端口上生成4个VF。
注意：加载带有这些参数的驱动程序时需要小心。
根据您的系统配置、插槽数量等，在所有情况下无法预测命令行上的位置。
注意：设备和驱动程序均不控制VF如何映射到配置空间。总线布局将因操作系统而异。在支持的操作系统中，您可以通过检查sysfs来找到映射关系。
注释：当启用 SR-IOV 模式或 VMDq 模式时，硬件 VLAN 过滤和 VLAN 标签剥离/插入将保持启用状态。请在添加新的 VLAN 过滤器之前移除旧的过滤器。例如，

::
  
  ip link set eth0 vf 0 vlan 100 // 为 VF 0 设置 VLAN 100
  ip link set eth0 vf 0 vlan 0   // 删除 VLAN 100
  ip link set eth0 vf 0 vlan 200 // 为 VF 0 设置新的 VLAN 200

在内核版本 3.6 中，驱动程序支持同时使用 max_vfs 和 DCB 功能，但需遵守以下限制。在内核版本 3.6 之前，驱动程序不支持 max_vfs 大于 0 并且同时启用 DCB 功能（利用优先流控制和扩展传输选择的多个流量类别）。

当启用 DCB 时，网络流量通过 NIC 中的多个流量类别（数据包缓冲区）进行传输和接收。流量根据优先级与特定类别关联，优先级值为 0 到 7，在 VLAN 标签中表示。当未启用 SR-IOV 时，每个流量类别与一组接收/发送描述符队列对相关联。给定流量类别的队列对数量取决于硬件配置。当启用 SR-IOV 时，描述符队列对被分组到池中。物理功能（PF）和每个虚拟功能（VF）分配了一个接收/发送描述符队列对池。当配置了多个流量类别（例如启用了 DCB）时，每个池包含来自每个流量类别的一个队列对。当硬件中配置了一个流量类别时，池包含来自该单个流量类别的多个队列对。

可以分配的 VF 数量取决于可以启用的流量类别的数量。每个启用的 VF 的可配置流量类别数量如下：
0 - 15 VF = 最多 8 个流量类别，具体取决于设备支持
16 - 31 VF = 最多 4 个流量类别
32 - 63 VF = 1 个流量类别

当配置了 VF 时，PF 也会分配一个池。PF 支持 DCB 功能，但每个流量类别仅使用一个队列对。当没有配置任何 VF 时，PF 可以支持每个流量类别的多个队列对。

allow_unsupported_sfp
---------------------
:有效范围: 0,1
:默认值: 0（禁用）

此参数允许 82599 基础适配器上使用不受支持且未经测试的 SFP+ 模块，只要模块类型已知于驱动程序

debug
-----
:有效范围: 0-16 (0=无,...,16=全部)
:默认值: 0

此参数调整系统日志中显示的调试消息级别

附加功能和配置
======================

流量控制
------------
可以通过 ethtool 配置 Ethernet 流量控制（IEEE 802.3x），以启用 ixgbe 接收和发送暂停帧。当启用发送时，如果接收数据包缓冲区超过预定义阈值，则生成暂停帧。当启用接收时，接收到暂停帧时，发送单元将停止指定的时间延迟。

注意：您必须有一个支持流量控制的链路伙伴。
流量控制默认启用。
使用 ethtool 更改流量控制设置。要启用或禁用 Rx 或 Tx 流量控制：

::
  
  ethtool -A eth? rx <on|off> tx <on|off>

注意：此命令仅在禁用自动协商时启用或禁用流量控制。如果启用了自动协商，此命令会更改与链路伙伴自动协商所使用的参数。
要启用或禁用自动协商：

::
  
  ethtool -s eth? autoneg <on|off>

注意：流量控制自动协商是链路自动协商的一部分。根据您的设备，您可能无法更改自动协商设置。
注意：对于进入1千兆模式的82598背板卡，默认的流控制行为被更改为关闭。在这些设备上的1千兆模式中启用流控制可能导致发送挂起。

Intel(R) 以太网流控制器
-------------------------------
Intel 以太网流控制器执行以下任务：

- 根据数据流将接收的数据包导向不同的队列
- 对平台中的流路由提供严格的控制
- 匹配数据流和CPU核心以实现流亲和性
- 支持多种参数以实现灵活的流分类和负载均衡（仅在SFP模式下）

注意：Intel 以太网流控制器掩码的工作方式与子网掩码相反。在以下命令中：

  #ethtool -N eth11 flow-type ip4 src-ip 172.4.1.2 m 255.0.0.0 dst-ip \
  172.21.1.1 m 255.128.0.0 action 31

写入过滤器的src-ip值将是0.4.1.2，而不是预期的172.0.0.0。类似地，写入过滤器的dst-ip值将是0.21.1.1，而不是172.0.0.0。

要启用或禁用Intel 以太网流控制器，请使用：

  # ethtool -K ethX ntuple <on|off>

当禁用ntuple过滤器时，所有用户编程的过滤器都会从驱动程序缓存和硬件中清除。重新启用ntuple时必须重新添加所有需要的过滤器。

要添加一个将数据包导向队列2的过滤器，请使用-U或-N开关：

  # ethtool -N ethX flow-type tcp4 src-ip 192.168.10.1 dst-ip \
  192.168.10.2 src-port 2000 dst-port 2001 action 2 [loc 1]

要查看当前存在的过滤器列表，请使用：

  # ethtool <-u|-n> ethX

侧边完美过滤器
------------------------
侧边完美过滤器用于定向符合指定特征的流量。它们通过ethtool的ntuple接口启用。要添加一个新的过滤器，请使用以下命令：

  ethtool -U <device> flow-type <type> src-ip <ip> dst-ip <ip> src-port <port> \
  dst-port <port> action <queue>

其中：
  <device> - 要编程的以太网设备
  <type> - 可以为ip4、tcp4、udp4或sctp4
  <ip> - 要匹配的IP地址
  <port> - 要匹配的端口号
  <queue> - 要导向的队列（-1表示丢弃匹配的流量）

要删除一个过滤器，请使用以下命令：

  ethtool -U <device> delete <N>

其中<N>是打印所有活动过滤器时显示的过滤器ID，并且也可能在添加过滤器时使用"loc <N>"指定。
以下示例匹配从192.168.0.1端口5300发送到192.168.0.5端口80的TCP流量，并将其发送到队列7：

  ethtool -U enp130s0 flow-type tcp4 src-ip 192.168.0.1 dst-ip 192.168.0.5 \
  src-port 5300 dst-port 80 action 7

对于每种flow-type，所有编程的过滤器都必须具有相同的匹配输入集。例如，发出以下两个命令是可以接受的：

  ethtool -U enp130s0 flow-type ip4 src-ip 192.168.0.1 src-port 5300 action 7
  ethtool -U enp130s0 flow-type ip4 src-ip 192.168.0.5 src-port 55 action 10

但是，发出以下两个命令是不可接受的，因为第一个指定了src-ip而第二个指定了dst-ip：

  ethtool -U enp130s0 flow-type ip4 src-ip 192.168.0.1 src-port 5300 action 7
  ethtool -U enp130s0 flow-type ip4 dst-ip 192.168.0.5 src-port 55 action 10

第二个命令将以错误失败。您可以在同一设备上使用相同的字段编程多个过滤器，但不能为两个TCP4过滤器编程不同的匹配字段。
ixgbe驱动不支持对字段的部分匹配，因此部分掩码字段也不受支持。
要创建将流量定向到特定虚拟功能（Virtual Function，VF）的过滤器，请使用“user-def”参数。指定user-def为一个64位值，其中低32位表示队列编号，接下来的8位表示哪个VF。请注意，0表示物理功能（Physical Function，PF），因此VF标识符从1开始。例如：

```
... user-def 0x800000002 ..
```

这表示将流量定向到虚拟功能7（8减1）中的队列2。
请注意，这些过滤器不会破坏内部路由规则，并且不会将原本不会发送到指定虚拟功能的流量进行路由。

### 超大帧（Jumbo Frames）
超大帧支持通过将最大传输单元（Maximum Transmission Unit，MTU）设置为大于默认值1500的值来启用。
可以使用ifconfig命令增加MTU大小。例如，输入以下命令，其中`<x>`是接口编号：

```
ifconfig eth<x> mtu 9000 up
```

或者，也可以使用ip命令如下：

```
ip link set mtu 9000 dev eth<x>
ip link set up dev eth<x>
```

此设置在重启后不会保存。可以通过在以下文件中添加`MTU=9000`来使设置永久生效：

```
/etc/sysconfig/network-scripts/ifcfg-eth<x> // 对于RHEL
/etc/sysconfig/network/<config_file> // 对于SLES
```

**注意：** 超大帧的最大MTU设置为9710。这个值与最大超大帧大小9728字节相吻合。

**注意：** 此驱动程序将尝试使用多个页面大小的缓冲区来接收每个超大帧。这有助于避免分配接收数据包时出现缓冲区饥饿问题。

**注意：** 对于基于82599的网络连接，如果要在虚拟功能（VF）中启用超大帧，则必须首先在物理功能（PF）中启用超大帧。VF的MTU设置不能大于PF的MTU。

### NBASE-T 支持
ixgbe驱动程序在某些设备上支持NBASE-T。然而，默认情况下会抑制NBASE-T速度的广告，以适应无法处理NBASE-T速度的故障网络交换机。可以使用ethtool命令在支持NBASE-T的设备上启用广告：

```
ethtool -s eth? advertise 0x1800000001028
```

在具有INTERFACES(5)的Linux系统中，可以在/etc/network/interfaces中将其指定为预启动命令，以便始终带有NBASE-T支持启动接口，例如：

```
iface eth? inet dhcp
       pre-up ethtool -s eth? advertise 0x1800000001028 || true
```

### 通用接收卸载（GRO）
该驱动程序支持内核中的软件实现GRO。通过将接收（Rx）流量合并为更大的数据块，GRO能够在高Rx负载下显著减少CPU利用率。GRO是对之前使用的LRO接口的改进。GRO能够合并除了TCP之外的其他协议。它也适用于对LRO有问题的配置，特别是桥接和iSCSI。

### 数据中心桥接（DCB）
**注意：**
内核假定TC0可用，并且如果TC0不可用，将禁用优先流控制（Priority Flow Control，PFC）。为了解决这个问题，在设置交换机上的DCB时，请确保启用TC0。
DCB 是一种在硬件中实现的配置服务质量（Quality of Service）的方法。它使用VLAN优先级标签（802.1p）来过滤流量，这意味着有8种不同的优先级可以用来过滤流量。它还启用了优先流控制（802.1Qbb），可以在网络压力期间限制或消除丢包的数量。带宽可以分配给这些优先级中的每一个，并且这种分配是在硬件级别上强制执行的（802.1Qaz）。适配器固件根据802.1AB和802.1Qaz标准实现了LLDP和DCBX协议代理。基于固件的DCBX代理仅在愿意模式下运行，并可以从具备DCBX功能的对等体接受设置。通过dcbtool/lldptool进行DCBX参数的软件配置不被支持。

ixgbe驱动实现了DCB netlink接口层，以便用户空间能够与驱动通信并查询端口的DCB配置。
---
该驱动利用ethtool接口进行驱动配置和诊断，以及显示统计信息。此功能需要最新版本的ethtool。请从以下网址下载：https://www.kernel.org/pub/software/network/ethtool/

FCoE
----
ixgbe驱动支持光纤通道（Fiber Channel）通过以太网（FCoE）和数据中心桥接（Data Center Bridging，DCB）。这段代码不会对常规驱动操作产生默认影响。配置DCB和FCoE不在本README的范围内。有关FCoE项目的更多信息，请访问http://www.open-fcoe.org/；对于DCB信息，请联系ixgbe-eedc@lists.sourceforge.net
MAC和VLAN防欺骗功能
------------------
当恶意驱动尝试发送伪造的数据包时，硬件会丢弃该数据包而不进行传输，并向PF驱动发送一个中断通知其存在欺骗尝试。当检测到伪造的数据包时，PF驱动将向系统日志发送以下消息（通过“dmesg”命令显示）：

  ixgbe ethX: ixgbe_spoof_check: n 个伪造数据包被检测到

其中，“x”是PF接口编号；“n”是检测到的伪造数据包数量。
注意：此功能可以针对特定虚拟功能（VF）禁用：

  ip link set <pf dev> vf <vf id> spoofchk {off|on}

IPsec卸载
-------------
ixgbe驱动支持IPsec硬件卸载。在使用“ip xfrm ...”创建安全关联时，可以使用‘offload’标签选项将IPsec SA注册到驱动程序中，从而提高安全通信的吞吐量。
卸载也支持ixgbe的VF，但VF必须设置为“可信”，并且需要启用支持：

  ethtool --set-priv-flags eth<x> vf-ipsec on
  ip link set eth<x> vf <y> trust on

已知问题/故障排除
============================

在64位Microsoft Windows Server 2012/R2客户操作系统中启用SR-IOV
---------------------------------------------------------------------
Linux KVM Hypervisor/VMM支持直接将PCIe设备分配给虚拟机。这包括传统的PCIe设备以及基于Intel Ethernet Controller XL710的SR-IOV功能设备。
支持
=====
获取一般信息，请访问Intel支持网站：
https://www.intel.com/support/

如果在受支持内核和受支持适配器上发布的源代码中发现问题，请将与此问题相关的确切信息发送至intel-wired-lan@lists.osuosl.org
当然，请提供您需要翻译的文本。
