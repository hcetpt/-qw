SPDX 许可证标识符: GPL-2.0

=============================================
AMD-TEE（AMD 的可信执行环境）
=============================================

AMD-TEE 驱动程序处理与 AMD 的可信执行环境（TEE）的通信。TEE 环境由 AMD 安全处理器提供。AMD 安全处理器（以前称为平台安全处理器或 PSP）是一个具有 ARM TrustZone 技术的专用处理器，并且配备了一个基于软件的可信执行环境（TEE），旨在支持第三方可信应用程序。此功能目前仅在 APU 中启用。

下图展示了 AMD-TEE 的高层次概述：

                                             |
    x86                                      |
                                             |
 用户空间            （内核空间）           |    AMD 安全处理器（PSP）
 ~~~~~~~~~~            ~~~~~~~~~~~~~~        |    ~~~~~~~~~~~~~~~~~~~~~~~~~~
                                             |
 +--------+                                  |       +-------------+
 | 客户端 |                                  |       | 可信应用   |
 +--------+                                  |       +-------------+
     /\                                      |             /\
     ||                                      |             ||
     ||                                      |             \/
     ||                                      |         +----------+
     ||                                      |         |   TEE    |
     ||                                      |         | 内部 API |
     \/                                      |         +----------+
 +---------+           +-----------+---------+         | AMD-TEE  |
 | TEE     |           | TEE       | AMD-TEE |         +----------+
 | 客户端  |           | 子系统    | 驱动程序 |         | AMD-TEE  |
 | API     |           |           |         |         | 可信操作系统|
 +---------+-----------+----+------+---------+---------+----------+
 | 通用 TEE API        |      | ASP     |      邮箱协议       |
 | IOCTL (TEE_IOC_*)   |      | 驱动程序 | 注册协议           |
 +--------------------------+      +---------+--------------------+

在最低层（x86），AMD 安全处理器（ASP）驱动程序使用 CPU 到 PSP 邮箱寄存器向 PSP 提交命令。命令缓冲区的格式对 ASP 驱动程序是不透明的。其作用是将命令提交给安全处理器并返回结果给 AMD-TEE 驱动程序。AMD-TEE 驱动程序和 AMD 安全处理器驱动程序之间的接口可以在 [1] 中找到。AMD-TEE 驱动程序为 TEE 处理打包命令缓冲区的有效载荷。不同 TEE 命令的命令缓冲区格式可以在 [2] 中找到。

AMD-TEE 可信操作系统是在 AMD 安全处理器上运行的固件。AMD-TEE 驱动程序注册到 TEE 子系统，并实现了以下驱动函数回调：

* get_version - 返回驱动实现 ID 和能力
* open - 设置驱动程序上下文数据结构
* release - 释放驱动程序资源
* open_session - 加载可信应用（TA）二进制文件并与其建立会话
* close_session - 关闭与已加载的TA的会话并卸载它
* invoke_func - 调用已加载的TA中的命令
cancel_req 驱动程序回调不被 AMD-TEE 支持
用户空间（客户端）可以使用 GlobalPlatform TEE 客户端 API [3] 与 AMD 的 TEE 进行通信。AMD 的 TEE 提供了一个安全环境，用于加载、打开会话、调用命令以及关闭与可信应用（TA）的会话。

参考文献
==========

[1] include/linux/psp-tee.h

[2] drivers/tee/amdtee/amdtee_if.h

[3] http://www.globalplatform.org/specificationsdevice.asp 查找 “TEE Client API Specification v1.0” 并点击下载
