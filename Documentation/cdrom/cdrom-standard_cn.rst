=======================
Linux CD-ROM 标准
=======================

:作者: David van Leeuwen <david@ElseWare.cistron.nl>
:日期: 1999年3月12日
:更新者: Erik Andersen (andersee@debian.org)
:更新者: Jens Axboe (axboe@image.dk)

简介
============

Linux 可能是支持最广泛硬件设备的类Unix操作系统。这可能归因于：

- Linux 现在支持的多种平台（例如，i386-PC、Sparc Sun等）上可用的大量硬件设备。
- 操作系统的开放设计，使任何人都可以为 Linux 编写驱动程序。
- 大量可供参考的源代码示例，以了解如何编写驱动程序。

Linux 的开放性以及各种可用的硬件使得 Linux 能够支持许多不同的硬件设备。不幸的是，正是这种开放性也让每个设备驱动程序的行为从一个设备到另一个设备大相径庭。这种行为差异对于 CD-ROM 设备尤其显著；特定驱动器对“标准”*ioctl()* 调用的响应从一个驱动程序到另一个驱动程序变化很大。为了避免让他们的驱动程序完全不一致，Linux CD-ROM 驱动程序的编写者通常通过理解、复制然后修改现有的驱动程序来创建新的驱动程序。不幸的是，这种做法并没有在整个 Linux CD-ROM 驱动程序中保持一致的行为。

本文档描述了一项旨在为所有不同 Linux CD-ROM 设备驱动程序建立统一行为的努力。本文档还定义了各种 *ioctl()* 调用以及低级 CD-ROM 设备驱动程序应该如何实现它们。目前（截至 Linux 2.1.\ *x* 开发内核），包括 IDE/ATAPI 和 SCSI 在内的多个低级 CD-ROM 设备驱动程序现在都使用这种统一接口。

当 CD-ROM 被开发时，CD-ROM 驱动器和计算机之间的接口并未在标准中指定。结果，开发了许多不同的 CD-ROM 接口。其中一些有自己的专有设计（如 Sony、Mitsumi、Panasonic、Philips），其他制造商采用了现有电气接口并更改其功能（如 CreativeLabs/SoundBlaster、Teac、Funai），或者仅仅将他们的驱动器适配到一种或多种已存在的电气接口（如 Aztech、Sanyo、Funai、Vertos、Longshine、Optics Storage 以及大多数“无名”制造商）。在新驱动器真正带来自己的接口或使用自己的命令集和流控制方案的情况下，要么必须编写单独的驱动程序，要么增强现有的驱动程序。历史已经为我们提供了对这些不同接口的 CD-ROM 支持。如今，几乎所有新的 CD-ROM 驱动器都是 IDE/ATAPI 或 SCSI，并且任何制造商创建新接口的可能性极小。甚至找到旧的专有接口的驱动器也变得困难起来。

当我（在 1.3.70 年代）查看当时通过 `cdrom.h` 表达的现有软件接口时，发现它是一组相当杂乱的命令和数据格式 [#f1]_。似乎许多软件接口的功能是为了适应特定驱动器的能力而随意添加的。更重要的是，大多数不同驱动程序中的“标准”命令的行为各不相同：例如，某些驱动程序会在 *open()* 调用发生时关闭托盘，而其他驱动程序则不会。一些驱动程序在打开设备时锁定门以防止文件系统不一致，而其他驱动程序则不这样做，以便允许软件弹出。毫无疑问，不同驱动器的功能确实存在差异，但即使两个驱动器具有相同的功能，它们的驱动程序行为通常也会有所不同。
.. [#f1]
   我记不清当时查看的是哪个内核版本，大概是 1.2.13 和 1.3.34 ——这是我间接参与的最新内核版本。

我决定开始讨论如何让所有的 Linux CD-ROM 驱动程序行为更加统一。我首先联系了 Linux 内核中许多 CD-ROM 驱动程序的开发者。他们的反馈鼓励我编写了本文档所描述的统一 CD-ROM 驱动程序。该统一 CD-ROM 驱动程序的实现位于文件 `cdrom.c` 中。此驱动程序旨在作为一个额外的软件层，位于每个 CD-ROM 驱动器的低级设备驱动程序之上。
