SPDX 许可证标识符: GPL-2.0

=====================
ACPI 视频扩展
=====================

此驱动程序实现了 ACPI 显示适配器扩展，用于主板上的集成显卡设备，如 ACPI 2.0 规范附录 B 所定义的那样。该驱动程序允许执行一些基本控制操作，例如定义视频 POST 设备、检索 EDID 信息或设置视频输出等。需要注意的是，这只是一个参考实现，可能适用于您的集成显卡设备，也可能不适用。

ACPI 视频驱动程序在背光控制方面做了以下三件事：
1. 导出一个 sysfs 接口供用户空间控制背光级别。
=================================================================================

如果 ACPI 表中有视频设备，并且内核命令行中没有 `acpi_backlight=vendor` 参数，则该驱动程序将注册一个背光设备并为其设置所需的背光操作结构以供 sysfs 接口控制。对于每个已注册的类设备，在 `/sys/class/backlight` 下将有一个名为 `acpi_videoX` 的目录。
背光 sysfs 接口的标准定义如下：
`Documentation/ABI/stable/sysfs-class-backlight`
ACPI 视频驱动程序具体实现的功能如下：

- `actual_brightness`：
  在读取时，控制方法 `_BQC` 将被评估以获取固件认为当前的亮度级别；
- `bl_power`：
  未实现，将设置当前亮度代替；
- `brightness`：
  在写入时，控制方法 `_BCM` 将运行以设置请求的亮度级别；
- `max_brightness`：
  从 `_BCL` 包中派生（见下文）；
- `type`：
  固件

注意，ACPI 视频背光驱动程序始终使用索引值来表示亮度 (`brightness`)、实际亮度 (`actual_brightness`) 和最大亮度 (`max_brightness`)。例如，如果我们有以下 `_BCL` 包：

```
Method (_BCL, 0, NotSerialized)
{
    Return (Package (0x0C)
    {
        0x64,
        0x32,
        0x0A,
        0x14,
        0x1E,
        0x28,
        0x32,
        0x3C,
        0x46,
        0x50,
        0x5A,
        0x64
    })
}
```

前两个级别是针对笔记本电脑在交流电源或电池供电下的情况，目前 Linux 不使用这些级别。剩余的十个级别是我们可以选择的支持级别。适用的索引值范围为 0（对应于 0x0A 亮度值）到 9（对应于 0x64 亮度值），包括这两个值。每个索引值被视为一个“亮度级别”指示器。因此，从用户空间的角度来看，可用的亮度级别范围是从 0 到 9（`max_brightness`）。

通知用户空间关于热键事件
====================================

热键事件报告通常有两种情况：

i) 对于某些笔记本电脑，当用户按下热键时，将生成一个扫描码并通过键盘驱动程序创建的输入设备作为键类型输入事件发送给用户空间。经过适当的重映射后，以下键码将出现在用户空间中：
```
EV_KEY, KEY_BRIGHTNESSUP
EV_KEY, KEY_BRIGHTNESSDOWN
```
等等。
在这种情况下，ACPI 视频驱动程序不需要做任何事情（实际上，它甚至不知道发生了这种情况）。
ii) 对于某些笔记本电脑，按下热键不会生成扫描码，而是固件会通知视频设备 ACPI 节点有关事件的信息。事件值在 ACPI 规范中定义。ACPI 视频驱动程序将根据接收到的通知值生成一个键类型输入事件，并通过其创建的输入设备将事件发送给用户空间：
```
=====		==================
事件		键码
=====		==================
0x86		KEY_BRIGHTNESSUP
0x87		KEY_BRIGHTNESSDOWN
```
等等。
现在这会产生与情况 i) 相同的效果。
一旦用户空间工具接收到此事件，就可以通过 sysfs 接口修改背光级别。
在内核中更改背光级别
====================================

这适用于第二节中所述的第二种情况所涵盖的机器。一旦驱动程序收到通知，它将相应地设置背光级别。这不会影响向用户空间发送事件，无论视频模块是否直接控制背光级别，这些事件始终会发送到用户空间。此行为可以通过模块参数 `brightness_switch_enabled` 进行控制，具体文档参见 `admin-guide/kernel-parameters.rst`。建议在图形用户界面启动并希望完全控制背光级别时禁用此行为。
