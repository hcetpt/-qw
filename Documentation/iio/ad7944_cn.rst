SPDX 许可证标识符：GPL-2.0-only

=============
AD7944 驱动程序
=============

这是 Analog Devices Inc. 的 AD7944 及类似设备的 ADC 驱动程序。模块名称为 ``ad7944``。

支持的设备
==========

此驱动程序支持以下芯片：

* `AD7944 <https://www.analog.com/AD7944>`_
* `AD7985 <https://www.analog.com/AD7985>`_
* `AD7986 <https://www.analog.com/AD7986>`_

支持的功能
==========

SPI 接线模式
------------

该驱动程序目前支持三种可能的 SPI 接线配置：
CS 模式，3 线制，无忙碌指示
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block::

                                         +-------------+
                    +--------------------| CS          |
                    v                    |             |
    VIO   +--------------------+         |     HOST    |
     |    |        CNV         |         |             |
     +--->| SDI   AD7944   SDO |-------->| SDI         |
          |        SCK         |         |             |
          +--------------------+         |             |
                    ^                    |             |
                    +--------------------| SCLK        |
                                         +-------------+

要在设备树中选择此模式，请将 ``adi,spi-mode`` 属性设置为 ``"single"`` 并省略 ``cnv-gpios`` 属性。
CS 模式，4 线制，无忙碌指示
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block::

                                         +-------------+
     +-----------------------------------| CS          |
     |                                   |             |
     |              +--------------------| GPIO        |
     |              v                    |             |
     |    +--------------------+         |     HOST    |
     |    |        CNV         |         |             |
     +--->| SDI   AD7944   SDO |-------->| SDI         |
          |        SCK         |         |             |
          +--------------------+         |             |
                    ^                    |             |
                    +--------------------| SCLK        |
                                         +-------------+

要在设备树中选择此模式，请省略 ``adi,spi-mode`` 属性并提供 ``cnv-gpios`` 属性。
链式模式，无忙碌指示
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block::

                                                                 +-------------+
                  +-------------------------+--------------------| CS          |
                  v                         v                    |             |
        +--------------------+    +--------------------+         |     HOST    |
        |        CNV         |    |        CNV         |         |             |
   +--->| SDI   AD7944   SDO |--->| SDI   AD7944   SDO |-------->| SDI         |
   |    |        SCK         |    |        SCK         |         |             |
  GND   +--------------------+    +--------------------+         |             |
                  ^                         ^                    |             |
                  +-------------------------+--------------------| SCLK        |
                                                                 +-------------+

要在设备树中选择此模式，请将 ``adi,spi-mode`` 属性设置为 ``"chain"``，添加 ``spi-cs-high`` 标志，添加 ``#daisy-chained-devices`` 属性，并省略 ``cnv-gpios`` 属性。

参考电压
---------

所有三种可能的参考电压源都支持：

- 内部参考
- 外部 1.2V 参考和内部缓冲器
- 外部参考

参考电压源由设备树确定。如果存在 ``ref-supply``，则使用外部参考。如果存在 ``refin-supply``，则使用内部缓冲器。如果两者都不存在，则使用内部参考。

未实现的功能
------------

- ``BUSY`` 指示
- ``TURBO`` 模式

设备属性
========

这个系列中有两种类型的 ADC：伪差分和全差分。ADC 类型不同，通道名称也不同。
伪差分 ADC
-----------

AD7944 和 AD7985 是伪差分 ADC，具有以下属性：

+---------------------------------------+--------------------------------------------------------------+
| 属性                                  | 描述                                                         |
+=======================================+==============================================================+
| ``in_voltage0_raw``                   | 原始 ADC 电压值（*IN+* 相对于地）。                          |
+---------------------------------------+--------------------------------------------------------------+
| ``in_voltage0_scale``                 | 将原始值转换为 mV 的比例因子。                               |
+---------------------------------------+--------------------------------------------------------------+

在“链式”模式下，额外的芯片会作为附加的电压输入通道出现，例如 ``in_voltage1_raw``。

全差分 ADC
-----------

AD7986 是全差分 ADC，具有以下属性：

+---------------------------------------+--------------------------------------------------------------+
| 属性                                  | 描述                                                         |
+=======================================+==============================================================+
| ``in_voltage0-voltage1_raw``          | 原始 ADC 电压值（*IN+* - *IN-*）。                            |
+---------------------------------------+--------------------------------------------------------------+
| ``in_voltage0-voltage1_scale``        | 将原始值转换为 mV 的比例因子。                               |
+---------------------------------------+--------------------------------------------------------------+

在“链式”模式下，额外的芯片会作为附加的电压输入通道出现，例如 ``in_voltage2-voltage3_raw``。

设备缓冲区
==========

此驱动程序支持 IIO 触发的缓冲区。
请参阅 :doc:`iio_devbuf` 以获取更多信息。
