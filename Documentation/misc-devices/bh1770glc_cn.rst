```
SPDX 许可证标识符: GPL-2.0

=======================
内核驱动程序 bh1770glc
=======================

支持的芯片：

- ROHM BH1770GLC
- OSRAM SFH7770

数据手册：
非自由获取

作者：
Samu Onkalo <samu.p.onkalo@nokia.com>

描述
-----------
BH1770GLC 和 SFH7770 是环境光和接近传感器的组合。
ALS（环境光传感器）和接近传感器部分各自独立运行，但它们共享相同的 I2C 接口和中断逻辑。原则上，它们可以独立运行，但 ALS 的结果用于估计接近传感器的可靠性。
ALS 产生 16 位的勒克斯值。芯片包含中断逻辑来生成高低阈值中断。
接近传感器部分包含最多 3 个红外 LED 驱动器。芯片测量反射的红外光量并生成接近结果。分辨率是 8 位。驱动程序只支持一个通道。驱动程序使用 ALS 结果来估计接近结果的可靠性。因此，在需要接近检测时，ALS 始终在运行。
驱动程序使用阈值中断来避免轮询值的需求。
芯片中不存在接近低中断。这是通过使用延迟工作来模拟的。只要存在高于中断的接近阈值，延迟工作就会被推迟。因此，当接近水平低于阈值时，没有中断，延迟工作最终会运行。这被视为没有接近的指示。
当启用配置中的运行时电源管理框架时，芯片状态通过该框架进行控制。
校准比例因子用于隐藏不同芯片之间的差异。默认值设置为中性状态，意味着因子为 1.00。为了获得正确的值，需要一个校准过的光源作为参考。校准比例因子设置为使得测量结果接近预期的勒克斯值。

SYSFS
-----
chip_id
	只读 - 显示检测到的芯片类型和版本

power_state
	读写 - 启用/禁用芯片

	使用计数逻辑

	     - 1 启用芯片
	     - 0 禁用芯片

lux0_input
	只读 - 测量的勒克斯值

	     当发生阈值中断时调用 sysfs_notify

lux0_sensor_range
	只读 - lux0_input 的最大值

lux0_rate
	读写 - 测量速率（赫兹）

lux0_rate_avail
	只读 - 支持的测量速率

lux0_thresh_above_value
	读写 - 高电平阈值值

	     所有高于此值的结果
	     触发中断。65535（即传感器范围）禁用高阈值中断

lux0_thresh_below_value
	读写 - 低电平阈值值

	     所有低于此值的结果
	     触发中断。0 禁用低阈值中断
```
lux0_calibscale  
读写 - 校准值

默认设置为中性值  
输出结果将乘以 calibscale / calibscale_default 值

lux0_calibscale_default  
只读 - 中性校准值

prox0_raw  
只读 - 测得的接近值

当阈值中断发生时调用 sysfs_notify

prox0_sensor_range  
只读 - prox0_raw 的最大值

prox0_raw_en  
读写 - 启用/禁用接近功能

使用计数逻辑

- 1 启用接近功能
- 0 禁用接近功能

prox0_thresh_above_count  
读写 - 触发事件前所需的接近中断次数

prox0_rate_above  
读写 - 当级别高于阈值时的测量速率（赫兹）
即，当检测到接近功能开启时

prox0_rate_below  
读写 - 当级别低于阈值时的测量速率（赫兹）
即，当检测到接近功能关闭时

prox0_rate_avail  
只读 - 支持的接近测量速率（赫兹）

prox0_thresh_above0_value  
读写 - 触发接近事件的阈值水平
通过持久性过滤器（prox0_thresh_above_count）进行过滤

prox0_thresh_above1_value  
读写 - 立即触发事件的阈值水平
