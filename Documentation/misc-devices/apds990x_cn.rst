SPDX 许可证标识符: GPL-2.0

======================
内核驱动程序 apds990x
======================

支持的芯片:
Avago APDS990X

数据手册:
不公开获取

作者:
Samu Onkalo <samu.p.onkalo@nokia.com>

描述
-----------

APDS990x 是一个组合的环境光和接近传感器。环境光 (ALS) 和接近功能高度相关。在启用接近功能时，ALS 测量路径必须运行。
ALS 为两个通道生成原始测量值：Clear 通道（红外+可见光）和仅红外。然而，阈值比较仅使用 Clear 通道。硬件上的勒克斯值和阈值水平可能会根据光源的光谱有很大差异。
驱动程序进行必要的双向转换，以便用户只处理勒克斯值。勒克斯值是基于来自两个通道的信息计算得出的。硬件阈值水平是从给定的勒克斯值计算出来的，以匹配当前的照明类型。有时估计的不准确会导致错误中断，但这并不会造成损害。
ALS 包含四个不同的增益步骤。驱动程序自动选择合适的增益步骤。每次测量后，都会评估结果的可靠性，并在必要时触发新的测量。
平台数据可以提供已调优的转换公式值（如果已知）。否则，将使用纯传感器默认值。
接近功能较为简单，无需复杂的转换，直接产生可用的值。
驱动程序使用 pm_runtime 框架控制芯片的操作状态。电压调节器基于芯片操作状态进行控制。

SYSFS
-----

**chip_id**
    只读 - 显示检测到的芯片类型和版本

**power_state**
    读写 - 启用/禁用芯片。使用计数逻辑

            1 启用芯片
            0 禁用芯片
**lux0_input**
    只读 - 测量得到的勒克斯值

            当阈值中断发生时会调用 sysfs_notify

**lux0_sensor_range**
    只读 - lux0_input 的最大值
实际上永远不会达到，因为传感器在此之前往往会饱和。实际的最大值根据光谱等不同而变化。

- `lux0_rate`
  - 读写 - 测量速率（赫兹Hz）

- `lux0_rate_avail`
  - 只读 - 支持的测量速率

- `lux0_calibscale`
  - 读写 - 校准值
  默认设置为中性值
  输出结果乘以 `calibscale / calibscale_default` 的值

- `lux0_calibscale_default`
  - 只读 - 中性校准值

- `lux0_thresh_above_value`
  - 读写 - 高电平阈值
  所有高于此值的结果会触发中断。65535（即传感器范围）禁用高电平中断

- `lux0_thresh_below_value`
  - 读写 - 低电平阈值
  所有低于此值的结果会触发中断。0 禁用低电平中断

- `prox0_raw`
  - 只读 - 测得的接近值

  当阈值中断发生时调用 `sysfs_notify`

- `prox0_sensor_range`
  - 只读 - `prox0_raw` 的最大值（1023）

- `prox0_raw_en`
  - 读写 - 启用/禁用接近功能 - 使用计数逻辑
  - 1 启用接近功能
  - 0 禁用接近功能

- `prox0_reporting_mode`
  - 读写 - 触发/周期性
  在“触发”模式下，驱动程序报告两个可能的值：0 或 `prox0_sensor_range` 值。0 表示没有接近，1023 表示有接近。这会导致最少数量的中断。
在“周期性”模式下，驱动程序会报告所有高于 `prox0_thresh_above` 的值。这会导致更多的中断，但可以提供一个_大致_的距离估计。

`prox0_reporting_mode_avail`
	只读 - 可接受的 `prox0_reporting_mode` 值（触发、周期性）

`prox0_thresh_above_value`
	读写 - 触发接近事件的阈值级别
