=====================
空闲页面报告
=====================

空闲页面报告是一个API，通过该API，设备可以注册接收当前系统未使用的页面列表。在虚拟化情况下，这非常有用，因为客户机可以使用这些数据通知管理程序它不再使用内存中的某些页面。对于驱动程序（通常是气球驱动程序）来说，要使用此功能，它将分配并初始化一个`page_reporting_dev_info`结构体。结构体内部需要填充的是用于处理scatterlist的“report”函数指针。还必须保证每次调用该函数时能够处理至少`PAGE_REPORTING_CAPACITY`数量的scatterlist条目。调用`page_reporting_register`将在假设没有其他页面报告设备已经注册的情况下，将页面报告接口注册到报告框架中。

一旦注册，页面报告API将开始向驱动程序报告一批页面。API将在接口注册后2秒开始报告页面，并且在任何足够高阶的页面被释放后的2秒内继续这样做。报告的页面将存储在传递给报告函数的scatterlist中，最后一个条目的结束位将在`nent - 1`位置置位。

当页面正在由报告函数处理时，它们将无法被分配器访问。一旦报告函数完成，页面将返回到它们获取时的空闲区域。在移除正在使用空闲页面报告的驱动程序之前，必须调用`page_reporting_unregister`以移除当前正被空闲页面报告使用的`page_reporting_dev_info`结构体。这样做将阻止通过接口发出进一步的报告。如果另一个驱动程序或同一个驱动程序重新注册，则有可能从上一个驱动程序停止的地方继续报告空闲页面。
Alexander Duyck, 2019年12月4日
