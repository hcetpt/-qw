SPDX 许可证标识符: GPL-2.0

===============================
架构页表助手
===============================

通用内存管理（MM）期望带有内存管理单元（MMU）的架构提供用于创建、访问和修改不同级别页表项的助手函数，以支持不同的内存功能。这些页表助手需要在各个平台上遵循共同的语义。下表描述了预期的语义，并且可以在启动时通过 CONFIG_DEBUG_VM_PGTABLE 选项进行测试。这里的任何未来更改或调试测试都必须保持同步。

PTE 页表助手
======================

+---------------------------+--------------------------------------------------+
| pte_same                  | 测试两个 PTE 条目是否相同                       |
+---------------------------+--------------------------------------------------+
| pte_present               | 测试有效的映射 PTE                              |
+---------------------------+--------------------------------------------------+
| pte_young                 | 测试年轻的 PTE                                   |
+---------------------------+--------------------------------------------------+
| pte_dirty                 | 测试脏 PTE                                       |
+---------------------------+--------------------------------------------------+
| pte_write                 | 测试可写的 PTE                                   |
+---------------------------+--------------------------------------------------+
| pte_special               | 测试特殊的 PTE                                   |
+---------------------------+--------------------------------------------------+
| pte_protnone              | 测试 PROT_NONE 的 PTE                            |
+---------------------------+--------------------------------------------------+
| pte_devmap                | 测试 ZONE_DEVICE 映射的 PTE                      |
+---------------------------+--------------------------------------------------+
| pte_soft_dirty            | 测试软脏 PTE                                     |
+---------------------------+--------------------------------------------------+
| pte_swp_soft_dirty        | 测试被交换的软脏 PTE                             |
+---------------------------+--------------------------------------------------+
| pte_mkyoung               | 创建一个年轻的 PTE                               |
+---------------------------+--------------------------------------------------+
| pte_mkold                 | 创建一个旧的 PTE                                 |
+---------------------------+--------------------------------------------------+
| pte_mkdirty               | 创建一个脏 PTE                                   |
+---------------------------+--------------------------------------------------+
| pte_mkclean               | 创建一个干净的 PTE                               |
+---------------------------+--------------------------------------------------+
| pte_mkwrite               | 根据 VMA 指定的类型创建一个可写的 PTE           |
+---------------------------+--------------------------------------------------+
| pte_mkwrite_novma         | 创建一个常规类型的可写 PTE                       |
+---------------------------+--------------------------------------------------+
| pte_wrprotect             | 创建一个写保护的 PTE                             |
+---------------------------+--------------------------------------------------+
| pte_mkspecial             | 创建一个特殊的 PTE                               |
+---------------------------+--------------------------------------------------+
| pte_mkdevmap              | 创建一个 ZONE_DEVICE 映射的 PTE                  |
+---------------------------+--------------------------------------------------+
| pte_mksoft_dirty          | 创建一个软脏 PTE                                 |
+---------------------------+--------------------------------------------------+
| pte_clear_soft_dirty      | 清除一个软脏 PTE                                 |
+---------------------------+--------------------------------------------------+
| pte_swp_mksoft_dirty      | 创建一个被交换的软脏 PTE                         |
+---------------------------+--------------------------------------------------+
| pte_swp_clear_soft_dirty  | 清除一个被交换的软脏 PTE                         |
+---------------------------+--------------------------------------------------+
| pte_mknotpresent          | 使一个映射的 PTE 无效                            |
+---------------------------+--------------------------------------------------+
| ptep_clear                | 清除一个 PTE                                     |
+---------------------------+--------------------------------------------------+
| ptep_get_and_clear        | 清除并返回 PTE                                   |
+---------------------------+--------------------------------------------------+
| ptep_get_and_clear_full   | 清除并返回 PTE（批量 PTE 解映射）               |
+---------------------------+--------------------------------------------------+
| ptep_test_and_clear_young | 清除 PTE 中的年轻标志                            |
+---------------------------+--------------------------------------------------+
| ptep_set_wrprotect        | 转换为写保护的 PTE                               |
+---------------------------+--------------------------------------------------+
| ptep_set_access_flags     | 转换为更宽松的 PTE                               |
+---------------------------+--------------------------------------------------+

PMD 页表助手
======================

+---------------------------+--------------------------------------------------+
| pmd_same                  | 测试两个 PMD 条目是否相同                       |
+---------------------------+--------------------------------------------------+
| pmd_bad                   | 测试非表映射的 PMD                               |
+---------------------------+--------------------------------------------------+
| pmd_leaf                  | 测试叶映射的 PMD                                 |
+---------------------------+--------------------------------------------------+
| pmd_huge                  | 测试 HugeTLB 映射的 PMD                           |
+---------------------------+--------------------------------------------------+
| pmd_trans_huge            | 测试 PMD 上的透明大页（THP）                      |
+---------------------------+--------------------------------------------------+
| pmd_present               | 测试 pmd_page() 是否指向有效内存                 |
+---------------------------+--------------------------------------------------+
| pmd_young                 | 测试年轻的 PMD                                   |
+---------------------------+--------------------------------------------------+
| pmd_dirty                 | 测试脏 PMD                                       |
+---------------------------+--------------------------------------------------+
| pmd_write                 | 测试可写的 PMD                                   |
+---------------------------+--------------------------------------------------+
| pmd_special               | 测试特殊的 PMD                                   |
+---------------------------+--------------------------------------------------+
| pmd_protnone              | 测试 PROT_NONE 的 PMD                            |
+---------------------------+--------------------------------------------------+
| pmd_devmap                | 测试 ZONE_DEVICE 映射的 PMD                      |
+---------------------------+--------------------------------------------------+
| pmd_soft_dirty            | 测试软脏 PMD                                     |
+---------------------------+--------------------------------------------------+
| pmd_swp_soft_dirty        | 测试被交换的软脏 PMD                             |
+---------------------------+--------------------------------------------------+
| pmd_mkyoung               | 创建一个年轻的 PMD                               |
+---------------------------+--------------------------------------------------+
| pmd_mkold                 | 创建一个旧的 PMD                                 |
+---------------------------+--------------------------------------------------+
| pmd_mkdirty               | 创建一个脏 PMD                                   |
+---------------------------+--------------------------------------------------+
| pmd_mkclean               | 创建一个干净的 PMD                               |
+---------------------------+--------------------------------------------------+
| pmd_mkwrite               | 根据 VMA 指定的类型创建一个可写的 PMD           |
+---------------------------+--------------------------------------------------+
| pmd_mkwrite_novma         | 创建一个常规类型的可写 PMD                       |
+---------------------------+--------------------------------------------------+
| pmd_wrprotect             | 创建一个写保护的 PMD                             |
+---------------------------+--------------------------------------------------+
| pmd_mkspecial             | 创建一个特殊的 PMD                               |
+---------------------------+--------------------------------------------------+
| pmd_mkdevmap              | 创建一个 ZONE_DEVICE 映射的 PMD                  |
+---------------------------+--------------------------------------------------+
| pmd_mksoft_dirty          | 创建一个软脏 PMD                                 |
+---------------------------+--------------------------------------------------+
| pmd_clear_soft_dirty      | 清除一个软脏 PMD                                 |
+---------------------------+--------------------------------------------------+
| pmd_swp_mksoft_dirty      | 创建一个被交换的软脏 PMD                         |
+---------------------------+--------------------------------------------------+
| pmd_swp_clear_soft_dirty  | 清除一个被交换的软脏 PMD                         |
+---------------------------+--------------------------------------------------+
| pmd_mkinvalid             | 使当前的 PMD 无效；对于非当前 PMD 不调用 [1]      |
+---------------------------+--------------------------------------------------+
| pmd_set_huge              | 创建一个 PMD 大页映射                            |
+---------------------------+--------------------------------------------------+
| pmd_clear_huge            | 清除一个 PMD 大页映射                            |
+---------------------------+--------------------------------------------------+
| pmdp_get_and_clear        | 清除一个 PMD                                     |
+---------------------------+--------------------------------------------------+
| pmdp_get_and_clear_full   | 清除一个 PMD                                     |
+---------------------------+--------------------------------------------------+
| pmdp_test_and_clear_young | 清除 PMD 中的年轻标志                            |
+---------------------------+--------------------------------------------------+
| pmdp_set_wrprotect        | 转换为写保护的 PMD                               |
+---------------------------+--------------------------------------------------+
| pmdp_set_access_flags     | 转换为更宽松的 PMD                               |
+---------------------------+--------------------------------------------------+

PUD 页表助手
======================

+---------------------------+--------------------------------------------------+
| pud_same                  | 测试两个 PUD 条目是否相同                       |
+---------------------------+--------------------------------------------------+
| pud_bad                   | 测试非表映射的 PUD                               |
+---------------------------+--------------------------------------------------+
| pud_leaf                  | 测试叶映射的 PUD                                 |
+---------------------------+--------------------------------------------------+
| pud_huge                  | 测试 HugeTLB 映射的 PUD                           |
+---------------------------+--------------------------------------------------+
| pud_trans_huge            | 测试 PUD 上的透明大页（THP）                      |
+---------------------------+--------------------------------------------------+
| pud_present               | 测试有效的映射 PUD                               |
+---------------------------+--------------------------------------------------+
| pud_young                 | 测试年轻的 PUD                                   |
+---------------------------+--------------------------------------------------+
| pud_dirty                 | 测试脏 PUD                                       |
+---------------------------+--------------------------------------------------+
| pud_write                 | 测试可写的 PUD                                   |
+---------------------------+--------------------------------------------------+
| pud_devmap                | 测试 ZONE_DEVICE 映射的 PUD                      |
+---------------------------+--------------------------------------------------+
| pud_mkyoung               | 创建一个年轻的 PUD                               |
+---------------------------+--------------------------------------------------+
| pud_mkold                 | 创建一个旧的 PUD                                 |
+---------------------------+--------------------------------------------------+
| pud_mkdirty               | 创建一个脏 PUD                                   |
+---------------------------+--------------------------------------------------+
| pud_mkclean               | 创建一个干净的 PUD                               |
+---------------------------+--------------------------------------------------+
| pud_mkwrite               | 创建一个可写的 PUD                               |
+---------------------------+--------------------------------------------------+
| pud_wrprotect             | 创建一个写保护的 PUD                             |
+---------------------------+--------------------------------------------------+
| pud_mkdevmap              | 创建一个 ZONE_DEVICE 映射的 PUD                  |
+---------------------------+--------------------------------------------------+
| pud_mkinvalid             | 使当前的 PUD 无效；对于非当前 PUD 不调用 [1]      |
+---------------------------+--------------------------------------------------+
| pud_set_huge              | 创建一个 PUD 大页映射                            |
+---------------------------+--------------------------------------------------+
| pud_clear_huge            | 清除一个 PUD 大页映射                            |
+---------------------------+--------------------------------------------------+
| pudp_get_and_clear        | 清除一个 PUD                                     |
+---------------------------+--------------------------------------------------+
| pudp_get_and_clear_full   | 清除一个 PUD                                     |
+---------------------------+--------------------------------------------------+
| pudp_test_and_clear_young | 清除 PUD 中的年轻标志                            |
+---------------------------+--------------------------------------------------+
| pudp_set_wrprotect        | 转换为写保护的 PUD                               |
+---------------------------+--------------------------------------------------+
| pudp_set_access_flags     | 转换为更宽松的 PUD                               |
+---------------------------+--------------------------------------------------+

HugeTLB 页表助手
==========================

+---------------------------+--------------------------------------------------+
| pte_huge                  | 测试 HugeTLB                                      |
+---------------------------+--------------------------------------------------+
| arch_make_huge_pte        | 创建 HugeTLB                                      |
+---------------------------+--------------------------------------------------+
| huge_pte_dirty            | 测试脏 HugeTLB                                    |
+---------------------------+--------------------------------------------------+
| huge_pte_write            | 测试可写的 HugeTLB                                |
+---------------------------+--------------------------------------------------+
| huge_pte_mkdirty          | 创建一个脏 HugeTLB                                 |
+---------------------------+--------------------------------------------------+
| huge_pte_mkwrite          | 创建一个可写的 HugeTLB                             |
+---------------------------+--------------------------------------------------+
| huge_pte_wrprotect        | 创建一个写保护的 HugeTLB                           |
+---------------------------+--------------------------------------------------+
| huge_ptep_get_and_clear   | 清除 HugeTLB                                      |
+---------------------------+--------------------------------------------------+
| huge_ptep_set_wrprotect   | 转换为写保护的 HugeTLB                             |
+---------------------------+--------------------------------------------------+
| huge_ptep_set_access_flags | 转换为更宽松的 HugeTLB                           |
+---------------------------+--------------------------------------------------+

交换页表助手
========================

+---------------------------+--------------------------------------------------+
| __pte_to_swp_entry        | 从映射的 PTE 创建一个被交换的条目（架构）         |
+---------------------------+--------------------------------------------------+
| __swp_to_pte_entry        | 从被交换的条目（架构）创建一个映射的 PTE         |
+---------------------------+--------------------------------------------------+
| __pmd_to_swp_entry        | 从映射的 PMD 创建一个被交换的条目（架构）         |
+---------------------------+--------------------------------------------------+
| __swp_to_pmd_entry        | 从被交换的条目（架构）创建一个映射的 PMD         |
+---------------------------+--------------------------------------------------+
| is_migration_entry        | 测试迁移（读或写）的被交换条目                    |
+-------------------------------+----------------------------------------------+
| is_writable_migration_entry   | 测试写迁移的被交换条目                      |
+-------------------------------+----------------------------------------------+
| make_readable_migration_entry | 创建一个读迁移的被交换条目                    |
+-------------------------------+----------------------------------------------+
| make_writable_migration_entry | 创建一个写迁移的被交换条目                    |
+-------------------------------+----------------------------------------------+

[1] https://lore.kernel.org/linux-mm/20181017020930.GN30832@redhat.com/
